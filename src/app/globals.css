@tailwind base;
@tailwind components;
@tailwind utilities;

/* RR-179: Liquid Glass Mark All Read Button Styles - consolidated into @layer components below */

/* Global viewport constraints for mobile */
html,
body {
  overflow-x: hidden;
  width: 100%;
}

/* iOS PWA safe area handling - only for headers, not spacers */
.pwa-standalone header.pwa-safe-area-top {
  padding-top: env(safe-area-inset-top);
}

/* Safe area padding utility */
.pwa-standalone .pt-safe {
  padding-top: env(safe-area-inset-top);
}

/* Additional padding for article list in PWA mode */
.pwa-standalone .article-list-container {
  padding-top: 1rem; /* Extra padding to prevent cutoff */
}

/* Prevent horizontal scroll on mobile */
* {
  max-width: 100vw;
}

/* Fix for elements that might overflow */
.prose {
  word-wrap: break-word;
  overflow-wrap: break-word;
}

/* Ensure images don't overflow */
img {
  max-width: 100%;
  height: auto;
}

/* iOS Safari button click fix */
button {
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
  -webkit-touch-callout: none;
}

/* Ensure buttons are clickable on iOS */
button:not(:disabled) {
  cursor: pointer;
}

/* Disable hover states on touch devices to prevent iOS click delay */
@media (hover: none) and (pointer: coarse) {
  button:hover {
    background-color: transparent !important;
  }

  .hover\:bg-gray-100:hover {
    background-color: transparent !important;
  }

  .dark .hover\:bg-gray-800:hover {
    background-color: transparent !important;
  }
}

/* Fix for iOS Safari where buttons might not register clicks */
@supports (-webkit-touch-callout: none) {
  button {
    -webkit-user-select: none;
    user-select: none;
  }

  /* Force iOS to treat buttons as clickable */
  button:active {
    opacity: 0.8;
  }
}

/* RR-27: Visual differentiation for session-preserved articles */
.session-preserved-read {
  position: relative;
}

/* Visual indicator for auto-read articles preserved in session */
.session-preserved-read::before {
  content: "";
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 3px;
  background-color: rgb(59 130 246 / 0.5); /* blue-500 with opacity */
  border-radius: 0 2px 2px 0;
}

/* Hide scrollbars while maintaining scroll functionality */
@layer utilities {
  .scrollbar-hide {
    -ms-overflow-style: none; /* IE and Edge */
    scrollbar-width: none; /* Firefox */
  }

  .scrollbar-hide::-webkit-scrollbar {
    display: none; /* Chrome, Safari and Opera */
  }
}

/* Dark mode variant */
.dark .session-preserved-read::before {
  background-color: rgb(96 165 250 / 0.5); /* blue-400 with opacity */
}

/* Ensure preserved articles maintain proper opacity */
.session-preserved-read {
  opacity: 0.85 !important; /* Slightly more visible than regular read (0.7) */
}

@layer base {
  :root {
    --background: 0 0% 100%;
    --foreground: 240 10% 3.9%;
    --card: 0 0% 100%;
    --card-foreground: 240 10% 3.9%;
    --popover: 0 0% 100%;
    --popover-foreground: 240 10% 3.9%;
    --primary: 263 70% 50%; /* violet-500 */
    --primary-foreground: 0 0% 98%;
    --secondary: 265 20% 96%; /* violet-50 */
    --secondary-foreground: 265 12% 20%; /* violet-900 */
    --muted: 265 20% 96%; /* violet-50 */
    --muted-foreground: 265 12% 47%; /* violet-600 */
    --accent: 265 20% 96%; /* violet-50 */
    --accent-foreground: 265 12% 20%; /* violet-900 */
    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 0 0% 98%;
    --border: 265 20% 90%; /* violet-100 */
    --input: 265 20% 90%; /* violet-100 */
    --ring: 263 70% 50%; /* violet-500 */

    /* Counter colors - Light mode defaults */
    --counter-unselected-bg: hsl(var(--primary) / 0.1);
    --counter-unselected-text: hsl(var(--primary));
    --counter-selected-bg: hsl(var(--primary));
    --counter-selected-text: hsl(var(--primary-foreground));
    --chart-1: 12 76% 61%;
    --chart-2: 173 58% 39%;
    --chart-3: 197 37% 24%;
    --chart-4: 43 74% 66%;
    --chart-5: 27 87% 67%;
    --radius: 0.5rem;

    /* ========================================
     * RR-232: Tailwind Violet Palette - Reference Tokens
     * RGB values for direct usage in glass semantic tokens
     * ======================================== */

    --violet-50-rgb: 250, 248, 255; /* #faf8ff */
    --violet-100-rgb: 243, 240, 255; /* #f3f0ff */
    --violet-200-rgb: 233, 229, 255; /* #e9e5ff */
    --violet-300-rgb: 212, 197, 255; /* #d4c5ff */
    --violet-400-rgb: 183, 148, 246; /* #b794f6 */
    --violet-500-rgb: 139, 92, 246; /* #8b5cf6 */
    --violet-600-rgb: 124, 58, 237; /* #7c3aed */
    --violet-700-rgb: 109, 40, 217; /* #6d28d9 */
    --violet-800-rgb: 91, 33, 182; /* #5b21b6 */
    --violet-900-rgb: 76, 29, 149; /* #4c1d95 */
    --violet-950-rgb: 46, 16, 101; /* #2e1065 */

    /* HSL versions for other usage */
    --violet-50: 245 58% 98%; /* #faf8ff */
    --violet-100: 245 56% 95%; /* #f3f0ff */
    --violet-200: 245 54% 91%; /* #e9e5ff */
    --violet-300: 244 51% 82%; /* #d4c5ff */
    --violet-400: 243 47% 70%; /* #b794f6 */
    --violet-500: 243 47% 59%; /* #8b5cf6 */
    --violet-600: 243 52% 48%; /* #7c3aed */
    --violet-700: 242 54% 41%; /* #6d28d9 */
    --violet-800: 242 56% 33%; /* #5b21b6 */
    --violet-900: 242 59% 26%; /* #4c1d95 */
    --violet-950: 241 65% 16%; /* #2e1065 */
  }

  :root.dark {
    --background: 240 10% 3.9%;
    --foreground: 0 0% 98%;
    --card: 240 10% 3.9%;
    --card-foreground: 0 0% 98%;
    --popover: 240 10% 3.9%;
    --popover-foreground: 0 0% 98%;
    --primary: 263 70% 50%; /* violet-500 */
    --primary-foreground: 0 0% 98%;
    --secondary: 241 65% 16%; /* violet-950 */
    --secondary-foreground: 245 58% 98%; /* violet-50 */
    --muted: 241 65% 16%; /* violet-950 */
    --muted-foreground: 245 54% 91%; /* violet-200 */
    --accent: 241 65% 16%; /* violet-950 */
    --accent-foreground: 245 58% 98%; /* violet-50 */
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 0 0% 98%;
    --border: 242 56% 33%; /* violet-800 */
    --input: 242 56% 33%; /* violet-800 */
    --ring: 243 47% 70%; /* violet-400 */
    --chart-1: 220 70% 50%;
    --chart-2: 160 60% 45%;
    --chart-3: 30 80% 55%;
    --chart-4: 280 65% 60%;
    --chart-5: 340 75% 55%;

    /* Counter colors - Dark mode with updated OKLCH */
    --counter-unselected-bg: oklch(0.38 0.189 293.745);
    --counter-unselected-text: oklch(0.943 0.029 294.588);
    --counter-selected-bg: oklch(0.541 0.281 293.009);
    --counter-selected-text: oklch(0.969 0.016 293.756);

    /* ========================================
     * Master Liquid Glass System (iOS 26 based)
     * Single-source depth control for all glass components
     * ======================================== */

    /* Master depth shadow (3-layer Apple iOS 26 specification) */
    --glass-depth-shadow:
      0 8px 32px rgba(0, 0, 0, 0.12),
      /* Ambient shadow - matches inline styles */ 0 2px 8px rgba(0, 0, 0, 0.04),
      /* Key shadow */ inset 0 1px 1px rgba(255, 255, 255, 0.25); /* Glass highlight */

    /* Simplified shadow for inline style compatibility */
    --glass-shadow-ambient: 0 8px 32px rgba(0, 0, 0, 0.12);

    /* Secondary depth (75% intensity for toolbars) */
    --glass-depth-shadow-secondary:
      0 6px 24px rgba(0, 0, 0, 0.09),
      /* Reduced ambient */ 0 1px 6px rgba(0, 0, 0, 0.03),
      /* Reduced key */ inset 0 1px 1px rgba(255, 255, 255, 0.19); /* Reduced highlight */

    /* Master glass effects */
    --glass-blur-effect: blur(var(--glass-blur))
      saturate(var(--glass-saturation));
    --glass-border-style: 1px solid var(--glass-nav-border);
    --glass-surface: var(--glass-chip-bg);
    --glass-surface-hover: var(--glass-chip-indicator);
    --glass-border-radius-primary: 9999px; /* Fully rounded for primary controls */
    --glass-border-radius-secondary: 22px; /* Less rounded for clusters */
  }
}

@layer base {
  * {
    @apply border-border;
  }
  body {
    @apply bg-background text-foreground;
    font-feature-settings:
      "rlig" 1,
      "calt" 1;
    /* Allow body to scroll for Safari URL bar */
    min-height: 100vh;
    overflow-x: hidden;
  }
}

/* Typography optimizations for reading */
@layer utilities {
  .prose-reading {
    @apply prose prose-gray max-w-none dark:prose-invert;
    @apply prose-headings:font-semibold prose-headings:tracking-tight;
    @apply prose-p:text-base prose-p:leading-relaxed;
    @apply prose-a:text-primary prose-a:underline;
    @apply prose-img:rounded-lg prose-img:shadow-sm;
  }

  .article-content {
    @apply prose-reading;
    line-height: 1.6;
    font-size: 16px;
  }

  .article-list-item {
    @apply border-b border-border last:border-b-0;
    @apply transition-colors hover:bg-accent/50;
  }
}

/* Fix iOS double-tap issue for links in article content */
@layer base {
  /* Apply touch-action high up as recommended by UX expert */
  .prose {
    touch-action: manipulation;
  }

  .prose a {
    /* Basic link styling */
    cursor: pointer;
    -webkit-tap-highlight-color: transparent;
    /* Ensure touch-action is inherited */
    touch-action: manipulation;
  }

  /* Visual feedback on tap */
  .prose a:active {
    opacity: 0.7;
  }
}

/* iOS Scroll-to-Top Support */
@layer base {
  /* Main scrollable containers need native iOS scrolling */
  .ios-scroll-container {
    /* Use native momentum scrolling on iOS */
    -webkit-overflow-scrolling: touch;
    /* Ensure proper scroll behavior */
    overflow-y: auto;
    /* Prevent scroll chaining to parent */
    overscroll-behavior: contain;
    /* Ensure scrollbar is visible on desktop for independent scrolling */
    scrollbar-gutter: stable;
  }
}

/* Apple Liquid Glass Design */
@layer components {
  .liquid-glass-btn {
    /* Normalize button appearance to prevent UA default borders */
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;

    position: fixed;
    bottom: 80px; /* Increased to account for navigation footer */
    right: 24px;
    z-index: 50;
    width: 56px;
    height: 56px;
    display: flex;
    align-items: center;
    justify-content: center;

    /* Liquid glass effect (shared tokens with nav) */
    background: var(--glass-nav-bg);
    backdrop-filter: blur(var(--glass-blur)) saturate(180%);
    -webkit-backdrop-filter: blur(var(--glass-blur)) saturate(180%);

    /* Fully rounded for circular button */
    border-radius: 999px;

    /* Subtle border */
    border: 1px solid var(--glass-nav-border);

    /* Layered shadows for depth */
    box-shadow:
      0 8px 32px rgba(0, 0, 0, 0.12),
      0 1px 3px rgba(0, 0, 0, 0.04),
      inset 0 1px 1px rgba(255, 255, 255, 0.25);

    /* Icon color follows theme */
    color: hsl(var(--foreground));

    /* Smooth transitions */
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
    overflow: hidden;

    /* Prevent text selection */
    user-select: none;
    -webkit-user-select: none;

    /* Force GPU acceleration */
    transform: translateZ(0);
    will-change: transform;
  }

  /* Glossy highlight overlay */
  .liquid-glass-btn::before {
    content: "";
    position: absolute;
    inset: 0;
    pointer-events: none;
    background: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.35) 0%,
      rgba(255, 255, 255, 0.1) 40%,
      rgba(255, 255, 255, 0) 100%
    );
    opacity: 1;
    border-radius: inherit;
  }

  /* Hover state */
  @media (hover: hover) and (pointer: fine) {
    .liquid-glass-btn:hover {
      background: var(--glass-nav-bg-scrolled);
      transform: translateZ(0) scale(1.05);
      box-shadow:
        0 12px 48px rgba(0, 0, 0, 0.15),
        0 2px 4px rgba(0, 0, 0, 0.04),
        inset 0 1px 1px rgba(255, 255, 255, 0.35);
    }
  }

  /* Active/pressed state */
  .liquid-glass-btn:active {
    transform: translateZ(0) scale(0.98);
    box-shadow:
      0 4px 20px rgba(0, 0, 0, 0.1),
      0 1px 2px rgba(0, 0, 0, 0.04),
      inset 0 1px 1px rgba(255, 255, 255, 0.2);
  }

  /* Dark mode handled via CSS variables above */

  /* Icon inside button */
  .liquid-glass-btn svg {
    position: relative;
    z-index: 1;
  }

  /* Animation on appearance */
  @keyframes liquid-glass-fade-in {
    from {
      opacity: 0;
      transform: translateZ(0) scale(0.8) translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateZ(0) scale(1) translateY(0);
    }
  }

  .liquid-glass-btn {
    animation: liquid-glass-fade-in 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
}

/* Accessibility: Reduce transparency fallback for floating button */
html.reduce-transparency .liquid-glass-btn {
  -webkit-backdrop-filter: none;
  backdrop-filter: none;
  background: var(--opaque-nav-bg);
  box-shadow: none;
}

/* Session-preserved article styles for RR-27 */
@layer components {
  /* Visual differentiation for session-preserved read articles */
  .session-preserved-read {
    position: relative;
    opacity: 0.85 !important; /* Less faded than normal read articles */
  }

  /* Add visual indicator for session-preserved articles */
  .session-preserved-read::before {
    content: "";
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 3px;
    background-color: var(--muted-foreground);
    opacity: 0.5;
  }

  /* Dark mode adjustments */
  .dark .session-preserved-read::before {
    background-color: var(--muted-foreground);
    opacity: 0.4;
  }

  /* Hover state for session-preserved articles */
  .session-preserved-read:hover {
    opacity: 0.9 !important;
  }

  /* Add subtle animation when articles are preserved */
  @keyframes preserve-article {
    from {
      background-color: rgba(0, 0, 0, 0.05);
    }
    to {
      background-color: transparent;
    }
  }

  .session-preserved-read {
    animation: preserve-article 0.3s ease-out;
  }
}

/* ========================================
 * RR-231 FOUNDATION FINALIZATION
 * Complete component library & CSS cleanup
 * 
 * CHANGES MADE:
 * - Removed: .glass-segment* classes (replaced by GlassSegmentedControl)
 * - Removed: .glass-nav, .glass-footer, .glass-sidebar-info CSS classes
 * - Preserved: All --glass-* CSS variables for RR-232 violet tokens
 * - Added: Three-tier semantic token hierarchy
 * - Added: Component token compatibility layer
 * 
 * ARCHITECTURE: Reference → Semantic → Component tokens
 * PURPOSE: Clean foundation for Violet Theme Rollout (RR-232-234)
 * ======================================== */

/* Liquid Glass Navigation (iOS 26-inspired) */
@layer base {
  :root {
    /* ========================================
     * RR-231: Semantic Token System 
     * Reference → Semantic → Component hierarchy
     * Updated with Violet Theming (RR-232)
     * ======================================== */

    /* Reference Tokens - Physical properties */
    --glass-blur-base: 16px;
    --glass-blur-enhanced: 20px;
    --glass-saturation-base: 180%;
    --glass-saturation-reduced: 140%;

    /* Dimensional Standards - Semantic Height System */
    --size-48: 48px;
    --size-56: 56px;

    /* Semantic Height Tokens */
    --control-height-external: var(
      --size-56
    ); /* All external component heights */
    --control-height-internal: var(--size-48); /* Buttons inside containers */

    /* Computed Container Padding (centers 48px inside 56px) */
    --container-pad-block: calc(
      (var(--control-height-external) - var(--control-height-internal)) / 2
    ); /* 4px */

    /* Legacy Alias (maintains compatibility) */
    --glass-control-height: var(--control-height-external);

    /* Brand Color (Single Source) */
    --brand-accent-rgb: 139, 92, 246; /* violet-500 */

    /* Glass Opacity System (Single Source) */
    --glass-surface-opacity: 0.03;
    --glass-surface-hover-opacity: 0.08;
    --glass-surface-subtle-opacity: 0.02;
    --glass-border-opacity: 0.1;
    --glass-border-enhanced-opacity: 0.15;

    /* Motion Tokens */
    --motion-spring: cubic-bezier(0.34, 1.56, 0.64, 1);
    --motion-smooth: cubic-bezier(0.4, 0, 0.2, 1);
    --motion-ease-out: cubic-bezier(0.25, 0.46, 0.45, 0.94);

    /* ========================================
     * Legacy Alias Bridge - DO NOT USE IN NEW CODE
     * Maps old variables to new semantic tokens
     * ======================================== */

    /* Legacy glass variables → semantic tokens */
    --glass-blur: var(--glass-blur-base);
    --glass-saturation: var(--glass-saturation-base);
    --glass-nav-bg: var(--color-surface-glass);
    --glass-nav-bg-scrolled: var(--color-surface-glass-hover);
    --glass-nav-border: var(--color-border-glass);
    --opaque-nav-bg: var(--color-surface-opaque);
    --glass-chip-bg: var(--color-surface-glass);
    --glass-chip-indicator: var(--color-surface-glass-hover);
    --glass-adaptive-bg: var(--color-surface-glass-subtle);
    --glass-adaptive-border: var(--color-border-glass);
    --glass-enhanced-bg: var(--color-surface-glass);
    --glass-enhanced-border: var(--color-border-glass-enhanced);

    /* Legacy motion variables → semantic tokens */
    --spring-timing: var(--motion-spring);
    --ease-smooth: var(--motion-smooth);
    --ease-out: var(--motion-ease-out);
  }

  :root.dark {
    /* ========================================
     * RR-231: Dark Mode Semantic Tokens
     * Override light mode with dark-specific values
     * ======================================== */

    /* Dark Mode Adjustments - Only Override What Changes */
    --glass-blur-base: 20px; /* Enhanced blur for dark mode */
    --glass-saturation-base: 140%; /* Reduced saturation for dark mode */

    /* Glass Opacity Overrides (Single Source Changes) */
    --glass-surface-opacity: 0.05;
    --glass-surface-hover-opacity: 0.12;
    --glass-surface-subtle-opacity: 0.03;
    --glass-border-opacity: 0.15;
    --glass-border-enhanced-opacity: 0.25;

    /* ========================================
     * Legacy Alias Bridge Updates for Dark Mode
     * ======================================== */

    /* Update legacy variables to use dark semantic tokens */
    --glass-blur: var(--glass-blur-base);
    --glass-saturation: var(--glass-saturation-base);
    --glass-nav-bg: var(--color-surface-glass);
    --glass-nav-bg-scrolled: var(--color-surface-glass-hover);
    --glass-nav-border: var(--color-border-glass);
    --opaque-nav-bg: var(--color-surface-opaque);
    --glass-chip-bg: var(--color-surface-glass);
    --glass-chip-indicator: rgba(
      255,
      255,
      255,
      0.25
    ); /* Special case for indicator visibility */
    --glass-adaptive-bg: var(--color-surface-glass-subtle);
    --glass-adaptive-border: var(--color-border-glass);
    --glass-enhanced-bg: var(--color-surface-glass);
    --glass-enhanced-border: var(--color-border-glass-enhanced);
  }
}

@layer components {
  /* ========================================
   * Unified Liquid Glass Base Classes (iOS 26)
   * ======================================== */

  .liquid-glass-primary {
    /* Single-source glass implementation with fallbacks */
    background-color: rgb(
      var(--brand-accent-rgb, 139 92 246) / var(--glass-surface-opacity, 0.03)
    );
    border: 1px solid
      rgb(
        var(--brand-accent-rgb, 139 92 246) / var(--glass-border-opacity, 0.1)
      );
    border-radius: 9999px;
    box-shadow:
      0 8px 32px rgba(0, 0, 0, 0.12),
      0 2px 8px rgba(0, 0, 0, 0.04),
      inset 0 1px 1px rgba(255, 255, 255, 0.25);
    backdrop-filter: blur(var(--glass-blur-base, 16px))
      saturate(var(--glass-saturation-base, 180%));
    -webkit-backdrop-filter: blur(var(--glass-blur-base, 16px))
      saturate(var(--glass-saturation-base, 180%));
    transition: all 200ms var(--motion-smooth, cubic-bezier(0.4, 0, 0.2, 1));
  }

  .liquid-glass-primary:hover {
    background-color: rgb(
      var(--brand-accent-rgb, 139 92 246) /
        var(--glass-surface-hover-opacity, 0.08)
    );
  }

  .liquid-glass-secondary {
    /* Single-source glass implementation for containers/toolbars */
    background-color: rgb(
      var(--brand-accent-rgb, 139 92 246) / var(--glass-surface-opacity, 0.03)
    );
    border: 1px solid
      rgb(
        var(--brand-accent-rgb, 139 92 246) / var(--glass-border-opacity, 0.1)
      );
    border-radius: 22px; /* Less rounded for containers */
    box-shadow:
      0 6px 24px rgba(0, 0, 0, 0.09),
      0 1px 6px rgba(0, 0, 0, 0.03),
      inset 0 1px 1px rgba(255, 255, 255, 0.19);
    backdrop-filter: blur(var(--glass-blur-base, 16px))
      saturate(var(--glass-saturation-base, 180%));
    -webkit-backdrop-filter: blur(var(--glass-blur-base, 16px))
      saturate(var(--glass-saturation-base, 180%));
    transition: all 200ms var(--motion-smooth, cubic-bezier(0.4, 0, 0.2, 1));
  }

  .liquid-glass-secondary:hover {
    background-color: rgb(
      var(--brand-accent-rgb, 139 92 246) /
        var(--glass-surface-hover-opacity, 0.08)
    );
  }

  .glass-nav {
    /* Translucent background that lenses content underneath */
    -webkit-backdrop-filter: blur(var(--glass-blur))
      saturate(var(--glass-saturation));
    backdrop-filter: blur(var(--glass-blur)) saturate(var(--glass-saturation));
    background: var(--glass-nav-bg);
    border-bottom: 1px solid var(--glass-nav-border);
    transition:
      background-color 200ms var(--ease-smooth),
      box-shadow 200ms var(--ease-smooth);
    will-change: transform;
  }

  /* Glass toolbar container (clustered capsule) */
  .glass-toolbar {
    /* Inherit unified liquid glass styling */
    @apply liquid-glass-secondary;

    /* Semantic height - natural expansion like original */
    min-height: var(--control-height-external); /* 56px minimum for alignment */
    padding: 4px; /* Original padding restored */
    display: inline-flex;
    align-items: flex-start; /* Allow vertical expansion */
    flex-direction: column; /* Allow toolbar + dropdown stacking */
    gap: 4px;
    /* Add glossy overlay for enhanced depth */
    position: relative;
    overflow: visible; /* Allow dropdown to escape container */
    isolation: isolate; /* Prevent z-index conflicts */
    /* Performance */
    transform: translateZ(0);
    will-change: transform;
  }

  .glass-toolbar .toolbar-group {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-height: var(
      --control-height-internal
    ); /* 48px centered within container */
    gap: 4px;
    position: relative;
    z-index: 1;
  }

  .glass-toolbar .more-trigger {
    position: relative;
    z-index: 1;
    transition:
      opacity 160ms var(--ease-out),
      transform 160ms var(--ease-out),
      width 220ms var(--ease-out),
      margin 160ms var(--ease-out);
  }

  .glass-toolbar.menu-open .toolbar-group {
    opacity: 0;
    transform: scale(0.96);
    width: 0;
    margin-right: 0;
    pointer-events: none;
  }

  /* Toolbar pill button */
  .glass-toolbar-btn {
    /* Normalize button appearance to prevent UA default borders */
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;

    display: inline-flex;
    align-items: center;
    justify-content: center;
    height: 48px; /* Unified standard height */
    min-width: 48px;
    padding: 0 12px;
    border-radius: 9999px;
    color: hsl(var(--foreground));
    /* No individual glass effects - rely on container glass */
    background: transparent;
    border: none;
    transition:
      transform 160ms var(--ease-out),
      background-color 160ms var(--ease-out);
  }

  @media (hover: hover) and (pointer: fine) {
    .glass-toolbar-btn:hover {
      background: var(--glass-chip-indicator);
    }
  }
  .glass-toolbar-btn:active {
    transform: scale(0.98);
  }

  /* Circular icon button (e.g., back button) */
  .glass-icon-btn {
    /* Inherit unified liquid glass styling */
    @apply liquid-glass-primary;

    /* Normalize button appearance to prevent UA default borders */
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;

    width: var(--glass-control-height); /* Standardized */
    height: var(--glass-control-height); /* Standardized */
    display: inline-flex;
    align-items: center;
    justify-content: center;
    transition: transform 160ms var(--ease-out);
  }

  @media (hover: hover) and (pointer: fine) {
    .glass-icon-btn:hover {
      background: var(--glass-nav-bg-scrolled);
    }
  }
  .glass-icon-btn:active {
    transform: scale(0.96);
  } /* Changed to 0.96 per spec */

  /* Adaptive glass styling for dark/busy backgrounds */
  .glass-adaptive {
    background: var(--glass-adaptive-bg) !important;
    border: 1px solid var(--glass-adaptive-border) !important;
    backdrop-filter: blur(24px) saturate(120%) !important;
    -webkit-backdrop-filter: blur(24px) saturate(120%) !important;
  }

  /* Auto-adaptive class that can be applied based on content detection */
  .glass-auto-adaptive {
    transition: all 200ms var(--ease-smooth);
  }

  /* When applied, increases visibility for dark backgrounds */
  .glass-auto-adaptive.dark-content-behind {
    background: var(--glass-adaptive-bg);
    border-color: var(--glass-adaptive-border);
    backdrop-filter: blur(24px) saturate(120%);
    -webkit-backdrop-filter: blur(24px) saturate(120%);
  }

  /* Enhanced legibility when scrolling over busy content */
  .glass-enhanced-legibility {
    background: var(--glass-enhanced-bg) !important;
    border-color: var(--glass-enhanced-border) !important;
    backdrop-filter: blur(20px) saturate(160%) !important;
    -webkit-backdrop-filter: blur(20px) saturate(160%) !important;
  }

  /* Glass popover menu */
  .glass-popover {
    -webkit-backdrop-filter: blur(var(--glass-blur))
      saturate(var(--glass-saturation));
    backdrop-filter: blur(var(--glass-blur)) saturate(var(--glass-saturation));
    background: var(--glass-nav-bg);
    border: 1px solid var(--glass-nav-border);
    border-radius: 22px; /* Updated to 22px for consistency */
    box-shadow:
      0 24px 60px rgba(0, 0, 0, 0.25),
      0 4px 12px rgba(0, 0, 0, 0.12);
    overflow: hidden;
  }

  .glass-popover .menu-separator {
    height: 1px;
    background: rgba(255, 255, 255, 0.06);
  }

  .glass-nav.is-scrolled {
    background: var(--glass-nav-bg-scrolled);
    box-shadow: 0 3px 12px rgba(0, 0, 0, 0.08);
  }

  /* Bottom glass toolbar (article footer) */
  .glass-footer {
    -webkit-backdrop-filter: blur(var(--glass-blur)) saturate(140%);
    backdrop-filter: blur(var(--glass-blur)) saturate(140%);
    background: var(--glass-nav-bg);
    border-top: 1px solid var(--glass-nav-border);
    transition:
      background-color 200ms cubic-bezier(0.4, 0, 0.2, 1),
      box-shadow 200ms cubic-bezier(0.4, 0, 0.2, 1);
  }

  .glass-footer.is-scrolled {
    background: var(--glass-nav-bg-scrolled);
    box-shadow: 0 -3px 12px rgba(0, 0, 0, 0.08);
  }

  /* Sidebar bottom info bar */
  .glass-sidebar-info {
    -webkit-backdrop-filter: blur(var(--glass-blur)) saturate(140%);
    backdrop-filter: blur(var(--glass-blur)) saturate(140%);
    background: var(--glass-nav-bg);
    border-top: 1px solid var(--glass-nav-border);
    box-shadow: 0 -6px 16px rgba(0, 0, 0, 0.06);
  }
}

/* Hide more trigger entirely when menu is open */
.glass-toolbar.menu-open .more-trigger {
  opacity: 0;
  transform: scale(0.96);
  width: 0;
  margin-left: 0;
  pointer-events: none;
}

/* Touch and performance optimizations for glass buttons */
.glass-touch-optimized {
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  user-select: none;
  transform: translateZ(0);
  will-change: transform;
}

/* Enhanced liquid glass button styling */
.liquid-glass-enhanced {
  position: relative;
  overflow: hidden;
}

.liquid-glass-enhanced::before {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  background: linear-gradient(
    135deg,
    rgba(255, 255, 255, 0.35) 0%,
    rgba(255, 255, 255, 0.1) 40%,
    rgba(255, 255, 255, 0) 100%
  );
  opacity: 1;
  border-radius: inherit;
}

/* Enhanced glass toolbar with glossy overlay */
.glass-toolbar::before {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  background: linear-gradient(
    135deg,
    rgba(255, 255, 255, 0.35) 0%,
    rgba(255, 255, 255, 0.1) 40%,
    rgba(255, 255, 255, 0) 100%
  );
  opacity: 1;
  border-radius: inherit;
  z-index: 0; /* Behind toolbar content */
}

/* PWA top safe helpers for fixed elements */
.pwa-standalone .top-safe {
  top: env(safe-area-inset-top);
}
.pwa-standalone .top-safe-8 {
  top: calc(8px + env(safe-area-inset-top));
}
.pwa-standalone .top-safe-16 {
  top: calc(16px + env(safe-area-inset-top));
}
.pwa-standalone .top-safe-48 {
  top: calc(48px + env(safe-area-inset-top));
}

/* Article detail header PWA override */
.pwa-standalone .article-header-controls {
  top: calc(16px + env(safe-area-inset-top)) !important;
}

.article-header-controls.is-hidden {
  transform: translateY(calc(-100% - 24px));
  opacity: 0;
  pointer-events: none;
}

/* Accessibility: Reduce transparency fallback */
html.reduce-transparency .glass-nav {
  -webkit-backdrop-filter: none;
  backdrop-filter: none;
  background: var(--opaque-nav-bg);
  box-shadow: none;
}

html.reduce-transparency .glass-footer {
  -webkit-backdrop-filter: none;
  backdrop-filter: none;
  background: var(--opaque-nav-bg);
  box-shadow: none;
}

html.reduce-transparency .glass-sidebar-info {
  -webkit-backdrop-filter: none;
  backdrop-filter: none;
  background: var(--opaque-nav-bg);
  box-shadow: none;
}

/* Glass Segmented Control */
@layer components {
  .glass-segment {
    /* Inherit unified liquid glass styling */
    @apply liquid-glass-primary;

    /* Semantic height system - container with internal centering */
    height: var(--control-height-external);
    padding: var(
      --container-pad-block
    ); /* Centers 48px segments inside 56px container */

    /* Size tokens for internal segments */
    --segment-height: var(--control-height-internal); /* 48px */

    position: relative;
    display: inline-flex;
    align-items: center;
    gap: 0;
  }

  /* Compact variant for tight headers */
  .glass-segment-sm {
    /* Keep compact padding but meet 44px touch target */
    --segment-pad: 4px;
    --segment-height: 44px;
  }

  /* 3-option variant */
  .glass-segment-3 .glass-segment-indicator {
    width: calc((100% - (var(--segment-pad) * 2)) / 3);
  }
  .glass-segment-3 {
    display: inline-grid;
    grid-template-columns: repeat(3, 1fr);
    align-items: center;
  }

  .glass-segment-indicator {
    position: absolute;
    inset: var(--segment-pad);
    width: calc(50% - var(--segment-pad));
    background: var(--glass-chip-indicator);
    border-radius: 9999px;
    box-shadow:
      0 8px 32px rgba(0, 0, 0, 0.12),
      inset 0 1px 0 rgba(255, 255, 255, 0.5);
    transform: translateX(0%);
    transition: transform 200ms cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 0;
  }

  .glass-segment[data-value="all"] .glass-segment-indicator {
    transform: translateX(0%);
  }
  .glass-segment[data-value="unread"] .glass-segment-indicator {
    transform: translateX(100%);
  }
  .glass-segment[data-value="read"] .glass-segment-indicator {
    transform: translateX(200%);
  }

  .glass-segment-btn {
    position: relative;
    z-index: 1;
    min-width: 44px;
    height: var(--segment-height);
    padding: 0 12px;
    border-radius: 9999px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    color: hsl(var(--foreground));
    transition:
      color 150ms cubic-bezier(0.4, 0, 0.2, 1),
      transform 150ms cubic-bezier(0.2, 0.8, 0.2, 1);
  }

  .glass-segment [aria-pressed="true"] {
    color: hsl(var(--foreground));
    font-weight: 600;
  }

  .glass-segment-btn:active {
    transform: scale(0.98);
  }

  /* Mark All Read Button - Proper Variable System Implementation */
  .liquid-glass-mark-all-read {
    /* Foundation: Inherit unified liquid glass styling */
    @apply liquid-glass-primary;

    /* Normalize button appearance */
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;

    /* Layout - semantic height tokens */
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.375rem;
    padding: 0 16px;
    height: var(--control-height-external);
    min-width: var(--control-height-external);

    /* Typography - match segmented control weight */
    font-size: 0.875rem;
    font-weight: 500;
    text-align: center;
    white-space: nowrap;
    line-height: 1.2;

    /* Interactions */
    cursor: pointer;

    /* Performance */
    transform: translateZ(0);
  }

  .liquid-glass-mark-all-read:hover:not(:disabled) {
    background: var(--glass-surface-hover);
    transform: translateY(-1px);
  }

  .liquid-glass-mark-all-read:active:not(:disabled) {
    transform: scale(0.98);
  }

  /* Glass Icon Button - unified with other primary components */
  .glass-icon-button-liquid {
    @apply liquid-glass-primary;

    /* Icon button specific layout - semantic tokens */
    width: var(--control-height-external);
    height: var(--control-height-external);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;

    /* Ensure perfect circle */
    min-width: var(--control-height-external);
    min-height: var(--control-height-external);
    max-width: var(--control-height-external);
    max-height: var(--control-height-external);

    /* Normalize button appearance */
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;

    /* Performance */
    transform: translateZ(0);
    will-change: transform, background-color;
  }

  .glass-icon-button-liquid:hover:not(:disabled) {
    background-color: rgb(
      var(--brand-accent-rgb, 139 92 246) /
        var(--glass-surface-hover-opacity, 0.08)
    );
    transform: scale(1.05);
  }

  .glass-icon-button-liquid:active:not(:disabled) {
    transform: scale(0.98);
  }

  /* State-specific styling for Mark All Read */
  .liquid-glass-mark-all-read.state-normal {
    color: hsl(var(--primary));
  }

  .liquid-glass-mark-all-read.state-confirming {
    background: rgba(255, 182, 193, 0.2) !important;
    border-color: rgba(255, 182, 193, 0.5) !important;
    color: rgb(220, 53, 69) !important;
    animation: liquid-glass-pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }

  .liquid-glass-mark-all-read.state-loading {
    color: hsl(var(--primary));
  }

  .liquid-glass-mark-all-read.state-disabled,
  .liquid-glass-mark-all-read:disabled {
    color: hsl(var(--primary));
    opacity: 0.4;
    cursor: not-allowed;
    filter: grayscale(100%) contrast(1.3);
  }

  /* Pulse animation for confirming state */
  @keyframes liquid-glass-pulse {
    0%,
    100% {
      opacity: 1;
      transform: scale(1);
    }
    50% {
      opacity: 0.85;
      transform: scale(1.02);
    }
  }
}

/* Dark mode inherits from liquid-glass-primary - no additional overrides needed */

:root.dark .liquid-glass-mark-all-read.state-normal {
  color: oklch(0.702 0.183 293.541);
}

:root.dark .liquid-glass-mark-all-read.state-confirming {
  background: rgba(255, 182, 193, 0.15) !important;
  border-color: rgba(255, 182, 193, 0.4) !important;
  color: rgb(255, 123, 123) !important;
}

:root.dark .liquid-glass-mark-all-read.state-loading {
  color: oklch(0.702 0.183 293.541);
}

:root.dark .liquid-glass-mark-all-read.state-disabled,
:root.dark .liquid-glass-mark-all-read:disabled {
  opacity: 0.65;
  filter: grayscale(100%) contrast(1.6);
}

/* Segmented control transparency fallback */
html.reduce-transparency .glass-segment,
html.reduce-transparency .glass-segment-indicator {
  -webkit-backdrop-filter: none;
  backdrop-filter: none;
}
html.reduce-transparency .glass-segment {
  background: var(--opaque-nav-bg);
}
html.reduce-transparency .glass-segment-indicator {
  background: color-mix(in srgb, hsl(var(--foreground)) 6%, transparent);
}
