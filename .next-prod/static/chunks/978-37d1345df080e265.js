"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[978],{2381:function(e,t,a){a.d(t,{z:function(){return s}});var r=a(7437),i=a(2265),n=a(7053),o=a(535),l=a(3448);let d=(0,o.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),s=i.forwardRef((e,t)=>{let{className:a,variant:i,size:o,asChild:s=!1,...c}=e,u=s?n.g7:"button";return(0,r.jsx)(u,{className:(0,l.cn)(d({variant:i,size:o,className:a})),ref:t,type:c.type||"button",...c,style:{WebkitTapHighlightColor:"transparent",touchAction:"manipulation",...c.style}})});s.displayName="Button"},7205:function(e,t,a){a.d(t,{OQ:function(){return l}});var r=a(6580);let i="https://rgfxyraamghqnechkppg.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJnZnh5cmFhbWdocW5lY2hrcHBnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI2ODg5NzAsImV4cCI6MjA2ODI2NDk3MH0.hqoXq2YAs6cc96d0baVjZWVdmDW0qytCIHjA-YffSdk";if(!i||!n)throw Error("Missing Supabase environment variables");console.log("[Supabase] Initializing client...");let o=performance.now(),l=(0,r.eI)(i,n,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},db:{schema:"public"}});console.log("[Supabase] Client initialized in ".concat((performance.now()-o).toFixed(2),"ms"))},5669:function(e,t,a){a.r(t),a.d(t,{useArticleStore:function(){return l}});var r=a(3011),i=a(7205),n=a(3135);let o=()=>"unread",l=(0,r.U)((e,t)=>({articles:new Map,loadingArticles:!1,articlesError:null,summarizingArticles:new Set,selectedFeedId:null,selectedFolderId:null,selectedArticleId:null,readStatusFilter:o(),filter:"all",hasMore:!0,loadingMore:!1,loadArticles:async(a,r)=>{e({loadingArticles:!0,articlesError:null});try{let n=i.OQ.from("articles").select("\n          *,\n          feed:feeds(*)\n        ").order("published_at",{ascending:!1});if(a)n=n.eq("feed_id",a);else if(r){let{data:e}=await i.OQ.from("feeds").select("id").eq("folder_id",r),t=(null==e?void 0:e.map(e=>e.id))||[];t.length>0&&(n=n.in("feed_id",t))}let o=t().readStatusFilter;"unread"===o?n=n.eq("is_read",!1):"read"===o&&(n=n.eq("is_read",!0));let l=t().filter;"starred"===l&&(n=n.eq("is_starred",!0)),n=n.limit(50);let{data:d,error:s}=await n;if(s)throw s;let c=new Map;null==d||d.forEach(e=>{var t;c.set(e.id,{id:e.id,feedId:e.feed_id||"",title:e.title||"Untitled",content:e.content||"",url:e.url||"",tags:e.is_starred?["starred"]:[],publishedAt:new Date(e.published_at||Date.now()),authorName:e.author||"",isRead:e.is_read||!1,createdAt:new Date(e.created_at||Date.now()),updatedAt:new Date(e.updated_at||Date.now()),inoreaderItemId:e.inoreader_id,fullContentUrl:e.url,hasFullContent:e.has_full_content||!1,fullContent:e.full_content||void 0,summary:e.ai_summary||void 0,isPartial:!1,feedTitle:(null===(t=e.feed)||void 0===t?void 0:t.title)||""})}),e({articles:c,loadingArticles:!1,hasMore:50===((null==d?void 0:d.length)||0),selectedFeedId:a||null,selectedFolderId:r||null})}catch(t){console.error("Failed to load articles:",t),e({loadingArticles:!1,articlesError:"Failed to load articles: ".concat(t)})}},loadMoreArticles:async()=>{let{loadingMore:a,hasMore:r,articles:n,selectedFeedId:o,selectedFolderId:l,readStatusFilter:d,filter:s}=t();if(!a&&r){e({loadingMore:!0});try{var c;let t=Array.from(n.values()),a=null===(c=t[t.length-1])||void 0===c?void 0:c.publishedAt;if(!a){e({loadingMore:!1,hasMore:!1});return}let r=i.OQ.from("articles").select("\n          *,\n          feed:feeds(*)\n        ").order("published_at",{ascending:!1}).lt("published_at",a.toISOString());if(o)r=r.eq("feed_id",o);else if(l){let{data:e}=await i.OQ.from("feeds").select("id").eq("folder_id",l),t=(null==e?void 0:e.map(e=>e.id))||[];t.length>0&&(r=r.in("feed_id",t))}"unread"===d?r=r.eq("is_read",!1):"read"===d&&(r=r.eq("is_read",!0)),"starred"===s&&(r=r.eq("is_starred",!0)),r=r.limit(50);let{data:u,error:m}=await r;if(m)throw m;let f=new Map(n);null==u||u.forEach(e=>{var t;f.set(e.id,{id:e.id,feedId:e.feed_id||"",title:e.title||"Untitled",content:e.content||"",url:e.url||"",tags:e.is_starred?["starred"]:[],publishedAt:new Date(e.published_at||Date.now()),authorName:e.author||"",isRead:e.is_read||!1,createdAt:new Date(e.created_at||Date.now()),updatedAt:new Date(e.updated_at||Date.now()),inoreaderItemId:e.inoreader_id,fullContentUrl:e.url,hasFullContent:e.has_full_content||!1,fullContent:e.full_content||void 0,summary:e.ai_summary||void 0,isPartial:!1,feedTitle:(null===(t=e.feed)||void 0===t?void 0:t.title)||""})}),e({articles:f,loadingMore:!1,hasMore:50===((null==u?void 0:u.length)||0)})}catch(t){console.error("Failed to load more articles:",t),e({loadingMore:!1})}}},getArticle:async a=>{try{let{data:n,error:o}=await i.OQ.from("articles").select("*").eq("id",a).single();if(o)throw o;if(n){var r;let i={id:n.id,feedId:n.feed_id||"",title:n.title||"Untitled",content:n.content||"",url:n.url||"",tags:n.is_starred?["starred"]:[],publishedAt:new Date(n.published_at||Date.now()),authorName:n.author||"",isRead:n.is_read||!1,createdAt:new Date(n.created_at||Date.now()),updatedAt:new Date(n.updated_at||Date.now()),inoreaderItemId:n.inoreader_id,fullContentUrl:n.url,hasFullContent:n.has_full_content||!1,fullContent:n.full_content||void 0,summary:n.ai_summary||void 0,isPartial:!1,feedTitle:(null===(r=n.feed)||void 0===r?void 0:r.title)||""},{articles:o}=t(),l=new Map(o);return l.set(a,i),e({articles:l}),i}return null}catch(e){return console.error("Failed to get article:",e),null}},markAsRead:async a=>{try{let{articles:r}=t(),o=r.get(a);if(!o||o.isRead)return;let l=new Date().toISOString(),{error:d}=await i.OQ.from("articles").update({is_read:!0,last_local_update:l,updated_at:l}).eq("id",a);if(d)throw d;if(o.inoreaderItemId){let{error:e}=await i.OQ.rpc("add_to_sync_queue",{p_article_id:a,p_inoreader_id:o.inoreaderItemId,p_action_type:"read"});e&&console.error("Failed to add to sync queue:",e)}let s=new Map(r);s.set(a,{...o,isRead:!0}),e({articles:s}),window.__articleCountManager&&window.__articleCountManager.invalidateCache(o.feedId);let c=n.i.getState();navigator.onLine||c.addToQueue({type:"mark_read",articleId:a,maxRetries:3})}catch(e){console.error("Failed to mark as read:",e)}},markMultipleAsRead:async a=>{if(0!==a.length)try{let{articles:r}=t(),n=new Date().toISOString(),o=a.filter(e=>{let t=r.get(e);return t&&!t.isRead});if(0===o.length)return;let{error:l}=await i.OQ.from("articles").update({is_read:!0,last_local_update:n,updated_at:n}).in("id",o);if(l)throw l;let d=o.map(e=>{let t=r.get(e);return(null==t?void 0:t.inoreaderItemId)?{article_id:e,inoreader_id:t.inoreaderItemId,action_type:"read"}:null}).filter(Boolean);if(d.length>0){for(let e of d)if(e){let{error:t}=await i.OQ.rpc("add_to_sync_queue",{p_article_id:e.article_id,p_inoreader_id:e.inoreader_id,p_action_type:e.action_type});t&&console.error("Failed to add to sync queue:",t)}}let s=new Map(r);if(o.forEach(e=>{let t=r.get(e);t&&s.set(e,{...t,isRead:!0})}),e({articles:s}),window.__articleCountManager){let e=new Set;o.forEach(t=>{let a=r.get(t);a&&e.add(a.feedId)}),e.forEach(e=>{window.__articleCountManager.invalidateCache(e)})}console.log("Marked ".concat(o.length," articles as read"))}catch(e){console.error("Failed to mark multiple as read:",e)}},markAsUnread:async a=>{try{let{articles:r}=t(),o=r.get(a);if(!o||!o.isRead)return;let l=new Date().toISOString(),{error:d}=await i.OQ.from("articles").update({is_read:!1,last_local_update:l,updated_at:l}).eq("id",a);if(d)throw d;if(o.inoreaderItemId){let{error:e}=await i.OQ.rpc("add_to_sync_queue",{p_article_id:a,p_inoreader_id:o.inoreaderItemId,p_action_type:"unread"});e&&console.error("Failed to add to sync queue:",e)}let s=new Map(r);s.set(a,{...o,isRead:!1}),e({articles:s}),window.__articleCountManager&&window.__articleCountManager.invalidateCache(o.feedId);let c=n.i.getState();navigator.onLine||c.addToQueue({type:"mark_unread",articleId:a,maxRetries:3})}catch(e){console.error("Failed to mark as unread:",e)}},toggleStar:async a=>{try{let{articles:r}=t(),o=r.get(a);if(!o)return;let l=o.tags||[],d=l.includes("starred"),s=d?l.filter(e=>"starred"!==e):[...l,"starred"],c=new Date().toISOString(),{error:u}=await i.OQ.from("articles").update({is_starred:!d,last_local_update:c,updated_at:c}).eq("id",a);if(u)throw u;if(o.inoreaderItemId){let{error:e}=await i.OQ.rpc("add_to_sync_queue",{p_article_id:a,p_inoreader_id:o.inoreaderItemId,p_action_type:d?"unstar":"star"});e&&console.error("Failed to add to sync queue:",e)}let m=new Map(r);m.set(a,{...o,tags:s}),e({articles:m});let f=n.i.getState();navigator.onLine||f.addToQueue({type:d?"unstar":"star",articleId:a,maxRetries:3})}catch(e){console.error("Failed to toggle star:",e)}},generateSummary:async function(a){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{summarizingArticles:i}=t(),n=new Set(i);n.add(a),e({summarizingArticles:n});try{let i=await fetch("/reader/api/articles/".concat(a,"/summarize"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({regenerate:r})});if(!i.ok){let e=await i.json();throw Error(e.message||"Failed to generate summary")}let n=await i.json(),{articles:o}=t(),l=o.get(a);if(l){let t=new Map(o);t.set(a,{...l,summary:n.summary}),e({articles:t})}return{id:a,articleId:a,content:n.summary,wordCount:n.summary.split(" ").length,generatedAt:new Date,model:n.model||"claude-sonnet-4-20250514",isRegenerated:r}}catch(e){throw console.error("Failed to generate summary:",e),e}finally{let{summarizingArticles:r}=t(),i=new Set(r);i.delete(a),e({summarizingArticles:i})}},getSummary:async e=>{try{let{data:t,error:a}=await i.OQ.from("articles").select("ai_summary").eq("id",e).single();if(a)throw a;if(null==t?void 0:t.ai_summary)return{id:e,articleId:e,content:t.ai_summary,wordCount:t.ai_summary.split(" ").length,generatedAt:new Date,model:"claude-sonnet-4-20250514",isRegenerated:!1};return null}catch(e){return console.error("Failed to get summary:",e),null}},markAllAsRead:async a=>{try{let{articles:r}=t(),n=new Date().toISOString(),o=[];if(Array.from(r.entries()).forEach(e=>{let[t,r]=e;r.isRead||a&&r.feedId!==a||o.push(t)}),0===o.length){console.log("No unread articles to mark");return}let{error:l}=await i.OQ.from("articles").update({is_read:!0,last_local_update:n,updated_at:n}).in("id",o);if(l)throw l;for(let e of o){let t=r.get(e);if(null==t?void 0:t.inoreaderItemId){let{error:a}=await i.OQ.rpc("add_to_sync_queue",{p_article_id:e,p_inoreader_id:t.inoreaderItemId,p_action_type:"read"});a&&console.error("Failed to add to sync queue:",a)}}let d=new Map(r);o.forEach(e=>{let t=d.get(e);t&&d.set(e,{...t,isRead:!0})}),e({articles:d}),window.__articleCountManager&&window.__articleCountManager.invalidateCache(a),console.log("Marked ".concat(o.length," articles as read in local database and queued for sync"))}catch(e){throw console.error("Failed to mark all as read:",e),e}},refreshArticles:async()=>{let{selectedFeedId:e,selectedFolderId:a}=t();await t().loadArticles(e||void 0,a||void 0)},setSelectedFeed:t=>e({selectedFeedId:t,selectedFolderId:null}),setSelectedFolder:t=>e({selectedFolderId:t,selectedFeedId:null}),setSelectedArticle:t=>e({selectedArticleId:t}),setFilter:a=>{e({filter:a}),t().refreshArticles()},setReadStatusFilter:a=>{e({readStatusFilter:a}),localStorage.setItem("readStatusFilter",a),t().refreshArticles()},clearError:()=>e({articlesError:null}),getArticleCount:()=>{let{readStatusFilter:e}=t(),a=Array.from(t().articles.values()),r=a.length,i=a.filter(e=>!e.isRead).length;return"unread"===e?{total:i,unread:i}:"read"===e?{total:r-i,unread:0}:{total:r,unread:i}}}))},3135:function(e,t,a){a.d(t,{i:function(){return n}});var r=a(3011),i=a(6885);a(7205);let n=(0,r.U)()((0,i.tJ)((e,t)=>({lastSyncTime:null,isSyncing:!1,syncError:null,syncProgress:0,syncMessage:null,rateLimit:null,actionQueue:[],setLastSyncTime:t=>e({lastSyncTime:t}),setSyncing:t=>e({isSyncing:t}),setSyncError:t=>e({syncError:t}),setSyncProgress:t=>e({syncProgress:t}),setSyncMessage:t=>e({syncMessage:t}),setRateLimit:t=>e({rateLimit:t}),addToQueue:t=>{let a={...t,id:Math.random().toString(36).substr(2,9),timestamp:Date.now(),retryCount:0};e(e=>({actionQueue:[...e.actionQueue,a]}))},removeFromQueue:t=>{e(e=>({actionQueue:e.actionQueue.filter(e=>e.id!==t)}))},incrementRetryCount:t=>{e(e=>({actionQueue:e.actionQueue.map(e=>e.id===t?{...e,retryCount:e.retryCount+1}:e)}))},clearQueue:()=>e({actionQueue:[]}),processQueue:async()=>{let{actionQueue:e,removeFromQueue:a,incrementRetryCount:r}=t();if(0!==e.length&&navigator.onLine)for(let t of(console.log("Processing ".concat(e.length," queued actions")),e))try{a(t.id),console.log("Successfully processed action: ".concat(t.type," for article ").concat(t.articleId))}catch(e){console.error("Failed to process action ".concat(t.id,":"),e),t.retryCount<t.maxRetries?r(t.id):(console.warn("Max retries reached for action ".concat(t.id,", removing from queue")),a(t.id))}},performFullSync:async()=>{let{setSyncing:e,setSyncError:r,setLastSyncTime:i,setSyncProgress:n,setSyncMessage:o,setRateLimit:l,processQueue:d}=t();e(!0),r(null),n(0),o("Starting sync...");try{await d(),console.log("Starting server sync...");let e=Date.now(),t=await fetch("/reader/api/sync",{method:"POST",headers:{"Content-Type":"application/json"}});if(!t.ok){let e=await t.json();if(429===t.status&&"rate_limit_exceeded"===e.error){let t=e.limit?" (".concat(e.used,"/").concat(e.limit," calls used today)"):"";throw Error("API rate limit exceeded".concat(t,". Try again tomorrow."))}throw Error(e.message||"Failed to start sync")}let{syncId:r,rateLimit:s}=await t.json();console.log("Sync started with ID:",r),s&&(l(s),console.log("API usage: ".concat(s.used,"/").concat(s.limit," calls today")),s.used>=.8*s.limit&&console.warn("Warning: Approaching API rate limit (".concat(s.remaining," calls remaining)")));let c=!1,u=0;for(;!c&&u<60;){await new Promise(e=>setTimeout(e,2e3));let e=await fetch("/reader/api/sync/status/".concat(r));if(e.ok){let t=await e.json();if(console.log("Sync progress: ".concat(t.progress,"% - ").concat(t.message||"Processing...")),n(t.progress||0),o(t.message||"Processing..."),"completed"===t.status)c=!0,console.log("Sync completed successfully");else if("failed"===t.status)throw Error(t.error||"Sync failed")}u++}if(!c)throw Error("Sync timeout - took too long to complete");let m=await a.e(87).then(a.bind(a,9087)).then(e=>e.useFeedStore.getState()),f=await Promise.resolve().then(a.bind(a,5669)).then(e=>e.useArticleStore.getState());await Promise.all([m.loadFeedHierarchy(),f.refreshArticles()]);let g=Date.now();i(Date.now()),n(100),o("Sync completed!"),console.log("Server sync completed in ".concat(((g-e)/1e3).toFixed(1),"s")),setTimeout(()=>{n(0),o(null)},2e3)}catch(e){r(e instanceof Error?e.message:"Unknown sync error"),n(0),o(null),console.error("Sync failed:",e)}finally{e(!1)}}}),{name:"sync-store",partialize:e=>({lastSyncTime:e.lastSyncTime,actionQueue:e.actionQueue,rateLimit:e.rateLimit})}));window.addEventListener("online",()=>{console.log("Back online, processing queued actions..."),n.getState().processQueue()})},3448:function(e,t,a){a.d(t,{cn:function(){return n}});var r=a(1994),i=a(3335);function n(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,i.m6)((0,r.W)(t))}}}]);