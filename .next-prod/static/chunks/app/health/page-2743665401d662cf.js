(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[613],{5804:function(e,t,a){Promise.resolve().then(a.bind(a,7947))},7947:function(e,t,a){"use strict";a.d(t,{HealthDashboard:function(){return O}});var r=a(7437),s=a(2265),i=a(3011),n=a(6885),l=a(7777),o=a(6232),c=a(9394);class d{async getPreferences(e){try{let t;if(!(t=e?await l.db.userPreferences.where("userId").equals(e).first():await l.db.userPreferences.orderBy("id").reverse().first()))return null;let{id:a,userId:r,version:s,updatedAt:i,...n}=t;return n}catch(e){return console.error("Failed to get user preferences:",e),null}}async updatePreferences(e,t){try{let a=await (t?l.db.userPreferences.where("userId").equals(t).first():l.db.userPreferences.orderBy("id").reverse().first());if(a)await l.db.userPreferences.update(a.id,{...e,updatedAt:new Date,version:a.version+1});else{let a={theme:"system",syncFrequency:6,maxArticles:500,autoFetchFullContent:!1,enableNotifications:!1,fontSize:"medium",readingWidth:"medium",...e,userId:t,version:1,updatedAt:new Date};await l.db.userPreferences.add(a)}return!0}catch(e){return console.error("Failed to update user preferences:",e),!1}}async resetToDefaults(e){try{let t={theme:"system",syncFrequency:6,maxArticles:500,autoFetchFullContent:!1,enableNotifications:!1,fontSize:"medium",readingWidth:"medium"};return await this.updatePreferences(t,e),t}catch(e){throw console.error("Failed to reset preferences to defaults:",e),e}}async deletePreferences(e){try{if(e)return await l.db.userPreferences.where("userId").equals(e).delete()>0;return await l.db.userPreferences.clear(),!0}catch(e){return console.error("Failed to delete preferences:",e),!1}}async getPreferencesHistory(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;try{let a=l.db.userPreferences.orderBy("updatedAt").reverse();return e&&(a=a.and(t=>t.userId===e)),(await a.limit(t).toArray()).map(e=>{let{id:t,userId:a,version:r,updatedAt:s,...i}=e;return{preferences:i,version:r,updatedAt:s}})}catch(e){return console.error("Failed to get preferences history:",e),[]}}validatePreferences(e){return(!e.theme||!!["light","dark","system"].includes(e.theme))&&(!e.fontSize||!!["small","medium","large"].includes(e.fontSize))&&(!e.readingWidth||!!["narrow","medium","wide"].includes(e.readingWidth))&&(void 0===e.syncFrequency||!(e.syncFrequency<1)&&!(e.syncFrequency>24))&&(void 0===e.maxArticles||!(e.maxArticles<100)&&!(e.maxArticles>2e3))}async updatePreferencesWithValidation(e,t){return this.validatePreferences(e)?{success:await this.updatePreferences(e,t)}:{success:!1,error:"Invalid preferences values"}}}let u=new d;class h{async getTodaysUsage(){let e=new Date().toISOString().split("T")[0];try{let t=await l.db.apiUsage.where("date").equals(e).first();if(t)return{inoreaderCalls:t.inoreaderCalls,claudeCalls:t.claudeCalls,date:t.date,estimatedCost:t.estimatedCost};return{inoreaderCalls:0,claudeCalls:0,date:e,estimatedCost:0}}catch(t){return console.error("Failed to get today's usage:",t),{inoreaderCalls:0,claudeCalls:0,date:e,estimatedCost:0}}}async recordInoreaderCall(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=new Date().toISOString().split("T")[0];try{let a=await l.db.apiUsage.where("date").equals(t).first();a?await l.db.apiUsage.update(a.id,{inoreaderCalls:a.inoreaderCalls+1,estimatedCost:a.estimatedCost+e}):await l.db.apiUsage.add({date:t,inoreaderCalls:1,claudeCalls:0,estimatedCost:e})}catch(e){console.error("Failed to record Inoreader call:",e)}}async recordClaudeCall(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=new Date().toISOString().split("T")[0];try{let a=await l.db.apiUsage.where("date").equals(t).first();a?await l.db.apiUsage.update(a.id,{claudeCalls:a.claudeCalls+1,estimatedCost:a.estimatedCost+e}):await l.db.apiUsage.add({date:t,inoreaderCalls:0,claudeCalls:1,estimatedCost:e})}catch(e){console.error("Failed to record Claude call:",e)}}async getUsageHistory(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30,t=new Date;t.setDate(t.getDate()-e);let a=t.toISOString().split("T")[0];try{return(await l.db.apiUsage.where("date").aboveOrEqual(a).toArray()).map(e=>({inoreaderCalls:e.inoreaderCalls,claudeCalls:e.claudeCalls,date:e.date,estimatedCost:e.estimatedCost}))}catch(e){return console.error("Failed to get usage history:",e),[]}}async getWeeklyUsage(){let e=new Date,t=new Date(e);t.setDate(e.getDate()-e.getDay());let a=new Date(t);a.setDate(t.getDate()-7);let r=new Date(t);r.setDate(t.getDate()-1);try{let e=await l.db.apiUsage.where("date").aboveOrEqual(t.toISOString().split("T")[0]).toArray(),s=await l.db.apiUsage.where("date").between(a.toISOString().split("T")[0],r.toISOString().split("T")[0],!0,!0).toArray(),i=e=>({...e.reduce((e,t)=>({inoreaderCalls:e.inoreaderCalls+t.inoreaderCalls,claudeCalls:e.claudeCalls+t.claudeCalls,estimatedCost:e.estimatedCost+t.estimatedCost}),{inoreaderCalls:0,claudeCalls:0,estimatedCost:0}),date:"aggregated"});return{thisWeek:i(e),lastWeek:i(s)}}catch(e){return console.error("Failed to get weekly usage:",e),{thisWeek:{inoreaderCalls:0,claudeCalls:0,date:"aggregated",estimatedCost:0},lastWeek:{inoreaderCalls:0,claudeCalls:0,date:"aggregated",estimatedCost:0}}}}async getMonthlyTotal(){let e=new Date;e.setDate(e.getDate()-30);try{let t=await l.db.apiUsage.where("date").aboveOrEqual(e.toISOString().split("T")[0]).toArray(),a=t.reduce((e,t)=>({inoreaderCalls:e.inoreaderCalls+t.inoreaderCalls,claudeCalls:e.claudeCalls+t.claudeCalls,estimatedCost:e.estimatedCost+t.estimatedCost}),{inoreaderCalls:0,claudeCalls:0,estimatedCost:0}),r=t.length||1;return{...a,dailyAverage:{inoreaderCalls:Math.round(a.inoreaderCalls/r),claudeCalls:Math.round(a.claudeCalls/r),estimatedCost:Number((a.estimatedCost/r).toFixed(4))}}}catch(e){return console.error("Failed to get monthly usage:",e),{inoreaderCalls:0,claudeCalls:0,estimatedCost:0,dailyAverage:{inoreaderCalls:0,claudeCalls:0,estimatedCost:0}}}}async checkLimits(){let e=await this.getTodaysUsage(),t=await this.getMonthlyTotal();return{inoreader:{used:e.inoreaderCalls,limit:100,percentage:e.inoreaderCalls/100*100,isNearLimit:e.inoreaderCalls>=80},claude:{used:t.claudeCalls,estimatedCost:t.estimatedCost,monthlyBudget:5,isNearBudget:t.estimatedCost>=4}}}async clearOldUsage(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30,t=new Date;t.setDate(t.getDate()-e);let a=t.toISOString().split("T")[0];try{return await l.db.apiUsage.where("date").below(a).delete()}catch(e){return console.error("Failed to clear old usage:",e),0}}}let g=new h;(0,i.U)()((0,n.tJ)((e,t)=>({dbStatus:{isInitialized:!1,isHealthy:!0,version:1},preferences:null,preferencesLoading:!1,apiUsage:null,usageLoading:!1,initializeDatabase:async()=>{try{console.log("Initializing database..."),await l.db.open(),await c.DatabaseMigrations.initializeDefaultPreferences();let a=await c.DatabaseMigrations.validateDatabaseIntegrity(),r=await l.db.getVersion(),s=await o.storageManager.getStorageStats();return e({dbStatus:{isInitialized:!0,isHealthy:a.isValid,version:r,storageStats:s||void 0,lastError:a.isValid?void 0:a.issues.join("; ")}}),await t().loadPreferences(),await t().loadApiUsage(),console.log("Database initialized successfully"),!0}catch(a){console.error("Failed to initialize database:",a);let t=await c.DatabaseMigrations.handleCorruptedDatabase();return e({dbStatus:{isInitialized:t,isHealthy:!1,version:1,lastError:"Database initialization failed: ".concat(a)}}),t}},loadPreferences:async a=>{e({preferencesLoading:!0});try{let t=await u.getPreferences(a);e({preferences:t,preferencesLoading:!1})}catch(a){console.error("Failed to load preferences:",a),e({preferencesLoading:!1,dbStatus:{...t().dbStatus,lastError:"Failed to load preferences: ".concat(a)}})}},updatePreferences:async(a,r)=>{try{let s=await u.updatePreferencesWithValidation(a,r);if(s.success)return await t().loadPreferences(r),!0;return e({dbStatus:{...t().dbStatus,lastError:s.error||"Failed to update preferences"}}),!1}catch(a){return console.error("Failed to update preferences:",a),e({dbStatus:{...t().dbStatus,lastError:"Failed to update preferences: ".concat(a)}}),!1}},resetPreferences:async a=>{try{await u.resetToDefaults(a),await t().loadPreferences(a)}catch(a){console.error("Failed to reset preferences:",a),e({dbStatus:{...t().dbStatus,lastError:"Failed to reset preferences: ".concat(a)}})}},loadApiUsage:async()=>{e({usageLoading:!0});try{let t=await g.getTodaysUsage();e({apiUsage:t,usageLoading:!1})}catch(a){console.error("Failed to load API usage:",a),e({usageLoading:!1,dbStatus:{...t().dbStatus,lastError:"Failed to load API usage: ".concat(a)}})}},recordInoreaderCall:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;try{await g.recordInoreaderCall(e),await t().loadApiUsage()}catch(e){console.error("Failed to record Inoreader call:",e)}},recordClaudeCall:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;try{await g.recordClaudeCall(e),await t().loadApiUsage()}catch(e){console.error("Failed to record Claude call:",e)}},checkStorageHealth:async()=>{try{let a=await o.storageManager.checkStorageHealth(),r=await o.storageManager.getStorageStats();e({dbStatus:{...t().dbStatus,isHealthy:a.isHealthy,storageStats:r||void 0,lastError:a.warning}})}catch(a){console.error("Failed to check storage health:",a),e({dbStatus:{...t().dbStatus,lastError:"Storage health check failed: ".concat(a)}})}},performMaintenance:async()=>{try{console.log("Starting database maintenance...");let a=await o.storageManager.performMaintenanceCleanup();(a.articlesDeleted>0||a.apiRecordsDeleted>0)&&console.log("Maintenance completed: ".concat(a.articlesDeleted," articles, ").concat(a.apiRecordsDeleted," API records cleaned")),e({dbStatus:{...t().dbStatus,storageStats:a.stats||void 0}})}catch(a){console.error("Database maintenance failed:",a),e({dbStatus:{...t().dbStatus,lastError:"Maintenance failed: ".concat(a)}})}},clearAllData:async()=>{try{await l.db.clearAllData(),e({preferences:null,apiUsage:null,dbStatus:{isInitialized:!0,isHealthy:!0,version:1}}),await c.DatabaseMigrations.initializeDefaultPreferences(),await t().loadPreferences(),await t().loadApiUsage(),console.log("All data cleared successfully")}catch(a){console.error("Failed to clear data:",a),e({dbStatus:{...t().dbStatus,lastError:"Failed to clear data: ".concat(a)}})}},validateDatabase:async()=>{try{let a=await c.DatabaseMigrations.validateDatabaseIntegrity();return e({dbStatus:{...t().dbStatus,isHealthy:a.isValid,lastError:a.isValid?void 0:a.issues.join("; ")}}),a.isValid}catch(a){return console.error("Database validation failed:",a),e({dbStatus:{...t().dbStatus,lastError:"Validation failed: ".concat(a)}}),!1}},exportData:async()=>{try{let e={preferences:await u.getPreferences(),apiUsage:await g.getUsageHistory(30),dbInfo:await l.db.getStorageInfo(),exportedAt:new Date().toISOString()};return new Blob([JSON.stringify(e,null,2)],{type:"application/json"})}catch(e){return console.error("Failed to export data:",e),null}},setError:a=>{e({dbStatus:{...t().dbStatus,lastError:a}})},clearError:()=>{e({dbStatus:{...t().dbStatus,lastError:void 0}})}}),{name:"data-storage",partialize:e=>({dbStatus:{isInitialized:e.dbStatus.isInitialized,version:e.dbStatus.version}})})).getState().initializeDatabase().catch(console.error);class m{static getInstance(){return m.instance||(m.instance=new m),m.instance}async checkHealth(){Date.now(),this.totalChecks++;try{let[e,t,a,r,s]=await Promise.all([this.checkDatabase(),this.checkApis(),this.checkCache(),this.checkAuth(),this.checkNetwork()]),i=[e,t,a,r,s],n=this.calculateOverallStatus(i);return("unhealthy"===n||"degraded"===n)&&this.failedChecks++,{status:n,timestamp:new Date,services:i,metrics:this.getMetrics()}}catch(e){throw this.failedChecks++,this.lastError={service:"system",error:e instanceof Error?e.message:"Unknown error",timestamp:new Date},e}}async checkDatabase(){let e=[],t="healthy",a=await this.checkDatabaseConnection();e.push(a),"healthy"!==a.status&&(t="unhealthy");let r=await this.checkDatabaseStorage();e.push(r),"degraded"===r.status&&"healthy"===t&&(t="degraded");let s=await this.checkDatabaseIntegrity();return e.push(s),"healthy"!==s.status&&"healthy"===t&&(t="degraded"),{name:"database",displayName:"IndexedDB Database",status:t,lastCheck:new Date,message:this.getServiceMessage("database",t),checks:e}}async checkDatabaseConnection(){let e=Date.now();try{await l.db.articles.count();let t=Date.now()-e,a=await l.db.getStorageInfo();return{name:"connection",status:"healthy",message:"Database connection is active",duration:t,details:{connected:!0,tablesCount:8,recordCounts:(null==a?void 0:a.counts)||{},storageUsed:(null==a?void 0:a.usage)||0,storageQuota:(null==a?void 0:a.quota)||0}}}catch(t){return{name:"connection",status:"unhealthy",message:"Database connection failed",duration:Date.now()-e,error:t instanceof Error?t.message:"Unknown error"}}}async checkDatabaseStorage(){try{let e=await l.db.getStorageInfo();if(!e)return{name:"storage",status:"unknown",message:"Unable to determine storage usage"};let t=e.usage/e.quota*100,a="healthy",r="Storage usage: ".concat(t.toFixed(1),"%");return t>90?(a="unhealthy",r="Critical: Storage almost full (".concat(t.toFixed(1),"%)")):t>75&&(a="degraded",r="Warning: High storage usage (".concat(t.toFixed(1),"%)")),{name:"storage",status:a,message:r}}catch(e){return{name:"storage",status:"unknown",message:"Failed to check storage",error:e instanceof Error?e.message:"Unknown error"}}}async checkDatabaseIntegrity(){try{let e=await l.db.articles.toArray(),t=new Set((await l.db.feeds.toArray()).map(e=>e.id)),a=e.filter(e=>!t.has(e.feedId));if(a.length>0)return{name:"integrity",status:"degraded",message:"Found ".concat(a.length," orphaned articles"),details:{orphanedCount:a.length}};return{name:"integrity",status:"healthy",message:"No data integrity issues found"}}catch(e){return{name:"integrity",status:"unknown",message:"Failed to check data integrity",error:e instanceof Error?e.message:"Unknown error"}}}async checkApis(){let e=[];e.push(await this.checkInoreaderApi()),e.push(await this.checkClaudeApi());let t=e.map(e=>e.status),a="healthy";return t.includes("unhealthy")?a="unhealthy":t.includes("degraded")&&(a="degraded"),{name:"api",displayName:"External APIs",status:a,lastCheck:new Date,message:this.getServiceMessage("api",a),checks:e}}async checkInoreaderApi(){return{name:"inoreader",status:"unknown",message:"Inoreader API check disabled (server-side auth only)",duration:0,details:{endpoint:"N/A - Server-side only",responseTime:0,statusCode:0}}}async checkClaudeApi(){return{name:"claude",status:"unknown",message:"Claude API check disabled (server-side only)",duration:0,details:{endpoint:"N/A - Server-side only",responseTime:0,statusCode:0}}}async checkCache(){let e=[],t=await this.checkServiceWorkerCache();e.push(t);let a=this.checkLocalStorage();e.push(a);let r=this.calculateComponentStatus(e);return{name:"cache",displayName:"Caching System",status:r,lastCheck:new Date,message:this.getServiceMessage("cache",r),checks:e}}async checkServiceWorkerCache(){try{if(!("caches"in window))return{name:"service-worker",status:"unhealthy",message:"Service Worker caches not available"};let e=await caches.keys(),t=await this.getCacheStats();return{name:"service-worker",status:"healthy",message:"".concat(e.length," caches active"),details:{hitRate:t.hitRate,missRate:t.missRate,size:t.size,maxSize:t.maxSize,oldestEntry:t.oldestEntry}}}catch(e){return{name:"service-worker",status:"unknown",message:"Failed to check service worker cache",error:e instanceof Error?e.message:"Unknown error"}}}checkLocalStorage(){try{let e="__health_check__";localStorage.setItem(e,e),localStorage.removeItem(e);let t=this.getLocalStorageSize(),a="healthy",r="LocalStorage usage: ".concat((t/1024).toFixed(1),"KB");return t/10485760*100>90&&(a="degraded",r="High LocalStorage usage: ".concat((t/1024).toFixed(1),"KB")),{name:"local-storage",status:a,message:r}}catch(e){return{name:"local-storage",status:"unhealthy",message:"LocalStorage is not accessible",error:e instanceof Error?e.message:"Unknown error"}}}async checkAuth(){let e=[];e.push({name:"authentication",status:"unknown",message:"Auth check disabled (server-side only)",details:{authenticated:!1,tokenValid:!1,refreshAvailable:!1}});let t=this.calculateComponentStatus(e);return{name:"auth",displayName:"Authentication",status:t,lastCheck:new Date,message:this.getServiceMessage("auth",t),checks:e}}async checkNetwork(){var e,t,a;let r=[],s={name:"connectivity",status:"undefined"!=typeof navigator?navigator.onLine?"healthy":"unhealthy":"unknown",message:"undefined"!=typeof navigator?navigator.onLine?"Network is online":"Network is offline":"Network check not available server-side",details:"undefined"!=typeof navigator?{online:navigator.onLine,connectionType:null===(e=navigator.connection)||void 0===e?void 0:e.effectiveType,downlink:null===(t=navigator.connection)||void 0===t?void 0:t.downlink,rtt:null===(a=navigator.connection)||void 0===a?void 0:a.rtt}:void 0};if(r.push(s),"undefined"!=typeof navigator&&navigator.onLine){let e=await this.checkExternalConnectivity();r.push(e)}let i=this.calculateComponentStatus(r);return{name:"network",displayName:"Network Connectivity",status:i,lastCheck:new Date,message:this.getServiceMessage("network",i),checks:r}}async checkExternalConnectivity(){let e=Date.now();try{return await fetch("https://www.google.com/favicon.ico",{mode:"no-cors",signal:AbortSignal.timeout(5e3)}),{name:"external",status:"healthy",message:"External connectivity verified",duration:Date.now()-e}}catch(t){return{name:"external",status:"degraded",message:"External connectivity issues",duration:Date.now()-e,error:t instanceof Error?t.message:"Unknown error"}}}calculateOverallStatus(e){let t=e.map(e=>e.status);return t.includes("unhealthy")?"unhealthy":t.includes("degraded")?"degraded":t.includes("unknown")?"unknown":"healthy"}calculateComponentStatus(e){let t=e.map(e=>e.status);return t.every(e=>"healthy"===e)?"healthy":t.includes("unhealthy")?"unhealthy":t.includes("degraded")?"degraded":"unknown"}getServiceMessage(e,t){return({healthy:"".concat(e," is operating normally"),degraded:"".concat(e," is experiencing minor issues"),unhealthy:"".concat(e," is experiencing major issues"),unknown:"".concat(e," status cannot be determined")})[t]}trackResponseTime(e,t){this.checkHistory.has(e)||this.checkHistory.set(e,[]);let a=this.checkHistory.get(e);a.push(t),a.length>100&&a.shift()}getMetrics(){let e=Math.floor((Date.now()-this.startTime.getTime())/1e3),t=0,a=0;this.checkHistory.forEach(e=>{e.forEach(e=>{t+=e,a++})});let r=a>0?t/a:0;return{uptime:e,totalChecks:this.totalChecks,failedChecks:this.failedChecks,avgResponseTime:r,lastError:this.lastError}}async getCacheStats(){return{hitRate:.85,missRate:.15,size:52428800,maxSize:104857600,oldestEntry:new Date(Date.now()-6048e5)}}getLocalStorageSize(){let e=0;for(let t in localStorage)localStorage.hasOwnProperty(t)&&(e+=localStorage[t].length+t.length);return e}constructor(){this.totalChecks=0,this.failedChecks=0,this.checkHistory=new Map,this.config={enabled:!0,intervalMs:3e5,timeout:3e4,retries:3,alertOnFailure:!0},this.startTime=new Date}}let y=m.getInstance(),p=(0,i.U)()((0,n.tJ)((e,t)=>({currentHealth:null,isChecking:!1,lastCheckError:null,checkHistory:[],alerts:[],unreadAlertCount:0,autoCheckEnabled:!0,checkInterval:5,performHealthCheck:async()=>{e({isChecking:!0,lastCheckError:null});try{let a=await y.checkHealth();e({currentHealth:a,isChecking:!1});let r=t().checkHistory,s=[{id:"check-".concat(Date.now()),timestamp:a.timestamp,overall:a.status,services:a.services.map(e=>({name:e.name,status:e.status,duration:e.checks.reduce((e,t)=>e+(t.duration||0),0)})),alerts:[]},...r].slice(0,100);e({checkHistory:s});let i=function(e){let t=[],a=new Date;return"unhealthy"===e.status?t.push({id:"alert-".concat(Date.now(),"-system"),service:"system",severity:"critical",message:"System is experiencing critical issues",timestamp:a,acknowledged:!1,autoResolve:!0}):"degraded"===e.status&&t.push({id:"alert-".concat(Date.now(),"-system"),service:"system",severity:"warning",message:"System is experiencing degraded performance",timestamp:a,acknowledged:!1,autoResolve:!0}),e.services.forEach(e=>{"unhealthy"===e.status?t.push({id:"alert-".concat(Date.now(),"-").concat(e.name),service:e.name,severity:"error",message:"".concat(e.displayName," is not functioning properly"),timestamp:a,acknowledged:!1,autoResolve:!0}):"degraded"===e.status&&e.checks.forEach(r=>{("unhealthy"===r.status||"degraded"===r.status)&&t.push({id:"alert-".concat(Date.now(),"-").concat(e.name,"-").concat(r.name),service:e.name,component:r.name,severity:"unhealthy"===r.status?"error":"warning",message:r.message,timestamp:a,acknowledged:!1,autoResolve:!0})})}),e.metrics.avgResponseTime>5e3&&t.push({id:"alert-".concat(Date.now(),"-performance"),service:"system",severity:"warning",message:"High average response time: ".concat(Math.round(e.metrics.avgResponseTime),"ms"),timestamp:a,acknowledged:!1,autoResolve:!0}),e.metrics.failedChecks>.3*e.metrics.totalChecks&&t.push({id:"alert-".concat(Date.now(),"-reliability"),service:"system",severity:"error",message:"High failure rate: ".concat(Math.round(e.metrics.failedChecks/e.metrics.totalChecks*100),"%"),timestamp:a,acknowledged:!1,autoResolve:!1}),t}(a);i.length>0&&e(e=>({alerts:[...i,...e.alerts].slice(0,50),unreadAlertCount:e.unreadAlertCount+i.length}))}catch(t){console.error("Health check failed:",t),e({isChecking:!1,lastCheckError:t instanceof Error?t.message:"Health check failed"})}},clearError:()=>e({lastCheckError:null}),acknowledgeAlert:t=>{e(e=>({alerts:e.alerts.map(e=>e.id===t?{...e,acknowledged:!0}:e),unreadAlertCount:Math.max(0,e.unreadAlertCount-1)}))},dismissAlert:t=>{e(e=>({alerts:e.alerts.filter(e=>e.id!==t),unreadAlertCount:e.alerts.find(e=>e.id===t&&!e.acknowledged)?Math.max(0,e.unreadAlertCount-1):e.unreadAlertCount}))},clearAlerts:()=>e({alerts:[],unreadAlertCount:0}),setAutoCheck:t=>e({autoCheckEnabled:t}),setCheckInterval:t=>e({checkInterval:t}),getHealthTrend:()=>t().checkHistory.slice(0,10).map(e=>e.overall).reverse()}),{name:"health-storage",partialize:e=>({checkHistory:e.checkHistory.slice(0,20),autoCheckEnabled:e.autoCheckEnabled,checkInterval:e.checkInterval,alerts:e.alerts.filter(e=>!e.autoResolve)})}));var f=a(3448);function w(e){let{status:t,size:a="md",showLabel:s=!1,label:i,pulse:n=!0}=e,l={sm:"h-2 w-2",md:"h-3 w-3",lg:"h-4 w-4"};return(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("div",{className:"relative flex items-center justify-center",children:[(0,r.jsx)("div",{className:(0,f.cn)("rounded-full",l[a],{healthy:"bg-green-500",degraded:"bg-yellow-500",unhealthy:"bg-red-500",unknown:"bg-gray-400"}[t])}),n&&"unknown"!==t&&(0,r.jsx)("div",{className:(0,f.cn)("absolute rounded-full animate-ping",l[a],{healthy:"bg-green-400",degraded:"bg-yellow-400",unhealthy:"bg-red-400",unknown:"bg-gray-300"}[t],"opacity-75")})]}),s&&(0,r.jsx)("span",{className:"text-sm font-medium",children:i||({healthy:"Healthy",degraded:"Degraded",unhealthy:"Unhealthy",unknown:"Unknown"})[t]})]})}var b=a(2135),v=a(875),x=a(1723);function C(e){let{service:t}=e,[a,i]=(0,s.useState)(!1);return(0,r.jsxs)("div",{className:(0,f.cn)("rounded-lg border p-4 transition-colors",{healthy:"bg-green-50 dark:bg-green-950/20 border-green-200 dark:border-green-800",degraded:"bg-yellow-50 dark:bg-yellow-950/20 border-yellow-200 dark:border-yellow-800",unhealthy:"bg-red-50 dark:bg-red-950/20 border-red-200 dark:border-red-800",unknown:"bg-gray-50 dark:bg-gray-950/20 border-gray-200 dark:border-gray-800"}[t.status]),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>i(!a),children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(w,{status:t.status,size:"md"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold",children:t.displayName}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:t.message})]})]}),(0,r.jsx)("button",{className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-800 rounded",children:a?(0,r.jsx)(b.Z,{className:"h-4 w-4"}):(0,r.jsx)(v.Z,{className:"h-4 w-4"})})]}),a&&(0,r.jsx)("div",{className:"mt-4 space-y-3 border-t pt-3",children:t.checks.map((e,t)=>(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(w,{status:e.status,size:"sm",pulse:!1}),(0,r.jsx)("span",{className:"text-sm font-medium capitalize",children:e.name.replace(/-/g," ")})]}),e.duration&&(0,r.jsxs)("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[(0,r.jsx)(x.Z,{className:"h-3 w-3"}),e.duration,"ms"]})]}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground ml-5",children:e.message}),e.error&&(0,r.jsxs)("p",{className:"text-sm text-red-600 dark:text-red-400 ml-5",children:["Error: ",e.error]}),e.details&&(0,r.jsx)("div",{className:"ml-5 mt-2 space-y-1",children:Object.entries(e.details).map(e=>{let[t,a]=e;return(0,r.jsxs)("div",{className:"text-xs text-muted-foreground flex gap-2",children:[(0,r.jsxs)("span",{className:"font-medium capitalize",children:[t.replace(/([A-Z])/g," $1").trim(),":"]}),(0,r.jsx)("span",{children:k(a)})]},t)})})]},t))}),t.metadata&&(0,r.jsx)("div",{className:"mt-3 pt-3 border-t",children:(0,r.jsx)("div",{className:"grid grid-cols-2 gap-2 text-xs",children:Object.entries(t.metadata).map(e=>{let[t,a]=e;return(0,r.jsxs)("div",{children:[(0,r.jsxs)("span",{className:"text-muted-foreground capitalize",children:[t.replace(/([A-Z])/g," $1").trim(),":"]})," ",(0,r.jsx)("span",{className:"font-medium",children:k(a)})]},t)})})})]})}function k(e){return null==e?"N/A":"boolean"==typeof e?e?"Yes":"No":e instanceof Date?e.toLocaleString():"number"==typeof e?e>1e6?"".concat((e/1e6).toFixed(1),"MB"):e>1e3?"".concat((e/1e3).toFixed(1),"KB"):e.toString():"object"==typeof e?JSON.stringify(e):String(e)}var A=a(4401),S=a(525),D=a(9322);function N(e){let{metrics:t}=e,a=t.totalChecks>0?((t.totalChecks-t.failedChecks)/t.totalChecks*100).toFixed(1):"100.0";return(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,r.jsx)(j,{icon:(0,r.jsx)(x.Z,{className:"h-5 w-5"}),label:"Uptime",value:(e=>{let t=Math.floor(e/86400),a=Math.floor(e%86400/3600),r=Math.floor(e%3600/60);return t>0?"".concat(t,"d ").concat(a,"h ").concat(r,"m"):a>0?"".concat(a,"h ").concat(r,"m"):"".concat(r,"m")})(t.uptime),color:"blue"}),(0,r.jsx)(j,{icon:(0,r.jsx)(A.Z,{className:"h-5 w-5"}),label:"Success Rate",value:"".concat(a,"%"),color:parseFloat(a)>=95?"green":parseFloat(a)>=80?"yellow":"red"}),(0,r.jsx)(j,{icon:(0,r.jsx)(S.Z,{className:"h-5 w-5"}),label:"Avg Response Time",value:"".concat(Math.round(t.avgResponseTime),"ms"),color:t.avgResponseTime<1e3?"green":t.avgResponseTime<3e3?"yellow":"red"}),(0,r.jsx)(j,{icon:(0,r.jsx)(D.Z,{className:"h-5 w-5"}),label:"Failed Checks",value:t.failedChecks.toString(),color:0===t.failedChecks?"green":t.failedChecks<5?"yellow":"red"})]})}function j(e){let{icon:t,label:a,value:s,color:i}=e;return(0,r.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm",children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"p-2 rounded-lg ".concat({blue:"text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-950/20",green:"text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-950/20",yellow:"text-yellow-600 dark:text-yellow-400 bg-yellow-50 dark:bg-yellow-950/20",red:"text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-950/20"}[i]),children:t}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:a}),(0,r.jsx)("p",{className:"text-2xl font-bold",children:s})]})]})})}var I=a(3245),F=a(6865),E=a(4463),P=a(401),M=a(2489),T=a(2381);function U(){let{alerts:e,acknowledgeAlert:t,dismissAlert:a,clearAlerts:s}=p();if(0===e.length)return null;e.filter(e=>!e.acknowledged);let i=e.filter(e=>!e.resolvedAt);return 0===i.length?null:(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold",children:["Active Alerts (",i.length,")"]}),e.length>3&&(0,r.jsx)(T.z,{variant:"ghost",size:"sm",onClick:s,className:"text-muted-foreground",children:"Clear All"})]}),(0,r.jsxs)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:[i.slice(0,5).map(e=>(0,r.jsx)(z,{alert:e,onAcknowledge:()=>t(e.id),onDismiss:()=>a(e.id)},e.id)),i.length>5&&(0,r.jsxs)("p",{className:"text-sm text-muted-foreground text-center py-2",children:["And ",i.length-5," more alerts..."]})]})]})}function z(e){let{alert:t,onAcknowledge:a,onDismiss:s}=e,i={info:{icon:(0,r.jsx)(I.Z,{className:"h-4 w-4"}),bgColor:"bg-blue-50 dark:bg-blue-950/20 border-blue-200 dark:border-blue-800",textColor:"text-blue-800 dark:text-blue-200"},warning:{icon:(0,r.jsx)(F.Z,{className:"h-4 w-4"}),bgColor:"bg-yellow-50 dark:bg-yellow-950/20 border-yellow-200 dark:border-yellow-800",textColor:"text-yellow-800 dark:text-yellow-200"},error:{icon:(0,r.jsx)(D.Z,{className:"h-4 w-4"}),bgColor:"bg-red-50 dark:bg-red-950/20 border-red-200 dark:border-red-800",textColor:"text-red-800 dark:text-red-200"},critical:{icon:(0,r.jsx)(E.Z,{className:"h-4 w-4"}),bgColor:"bg-red-100 dark:bg-red-950/40 border-red-300 dark:border-red-700",textColor:"text-red-900 dark:text-red-100"}}[t.severity],n=function(e){let t=Math.floor((new Date().getTime()-new Date(e).getTime())/1e3);return t<60?"Just now":t<3600?"".concat(Math.floor(t/60)," minutes ago"):t<86400?"".concat(Math.floor(t/3600)," hours ago"):"".concat(Math.floor(t/86400)," days ago")}(t.timestamp);return(0,r.jsxs)("div",{className:(0,f.cn)("rounded-lg border p-3 flex items-start gap-3 transition-opacity",i.bgColor,t.acknowledged&&"opacity-60"),children:[(0,r.jsx)("div",{className:(0,f.cn)("mt-0.5",i.textColor),children:i.icon}),(0,r.jsx)("div",{className:"flex-1 min-w-0",children:(0,r.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("p",{className:(0,f.cn)("text-sm font-medium",i.textColor),children:[t.service,t.component&&" - ".concat(t.component)]}),(0,r.jsx)("p",{className:"text-sm mt-1",children:t.message}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:n})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[!t.acknowledged&&(0,r.jsx)(T.z,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:a,title:"Acknowledge",children:(0,r.jsx)(P.Z,{className:"h-3.5 w-3.5"})}),(0,r.jsx)(T.z,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:s,title:"Dismiss",children:(0,r.jsx)(M.Z,{className:"h-3.5 w-3.5"})})]})]})})]})}var H=a(7168);function O(){let{currentHealth:e,isChecking:t,lastCheckError:a,performHealthCheck:i,clearError:n,unreadAlertCount:l}=p();!function(){let{autoCheckEnabled:e,checkInterval:t,performHealthCheck:a}=p();e&&setInterval(async()=>{await a()},6e4*t)}(),(0,s.useEffect)(()=>{e||i()},[e,i]);let o=async()=>{await i()};return a?(0,r.jsxs)("div",{className:"p-6 bg-red-50 dark:bg-red-950/20 rounded-lg",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(F.Z,{className:"h-6 w-6 text-red-600"}),(0,r.jsx)("h2",{className:"text-xl font-semibold text-red-900 dark:text-red-100",children:"Health Check Error"})]}),(0,r.jsx)(T.z,{variant:"outline",size:"sm",onClick:n,className:"text-red-600 hover:text-red-700",children:"Dismiss"})]}),(0,r.jsx)("p",{className:"text-red-800 dark:text-red-200 mb-4",children:a}),(0,r.jsxs)(T.z,{onClick:o,disabled:t,size:"sm",children:[(0,r.jsx)(H.Z,{className:(0,f.cn)("h-4 w-4 mr-2",t&&"animate-spin")}),"Retry"]})]}):e?(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"System Health"}),(0,r.jsx)(w,{status:e.status,size:"lg",showLabel:!0}),l>0&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-yellow-600 dark:text-yellow-400",children:[(0,r.jsx)(F.Z,{className:"h-5 w-5"}),(0,r.jsxs)("span",{className:"text-sm font-medium",children:[l," new alert",l>1?"s":""]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Last checked: ",new Date(e.timestamp).toLocaleTimeString()]}),(0,r.jsxs)(T.z,{variant:"outline",size:"sm",onClick:o,disabled:t,children:[(0,r.jsx)(H.Z,{className:(0,f.cn)("h-4 w-4 mr-2",t&&"animate-spin")}),"Refresh"]})]})]}),(0,r.jsx)(U,{}),(0,r.jsx)(N,{metrics:e.metrics}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:e.services.map(e=>(0,r.jsx)(C,{service:e},e.name))}),(0,r.jsx)(R,{})]}):(0,r.jsx)("div",{className:"flex items-center justify-center p-12",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)(A.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4 animate-pulse"}),(0,r.jsx)("p",{className:"text-gray-500",children:"Loading health status..."})]})})}function R(){let{checkHistory:e,getHealthTrend:t}=p(),a=t();return a.length<2?null:(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Health Trend"}),(0,r.jsx)("div",{className:"flex items-center gap-2",children:a.map((e,t)=>(0,r.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,r.jsx)(w,{status:e,size:"sm",pulse:!1}),(0,r.jsx)("span",{className:"text-xs text-muted-foreground",children:0===t?"Oldest":t===a.length-1?"Latest":""})]},t))}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground mt-4",children:["Showing last ",a.length," health checks"]})]})}},2381:function(e,t,a){"use strict";a.d(t,{z:function(){return c}});var r=a(7437),s=a(2265),i=a(7053),n=a(535),l=a(3448);let o=(0,n.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),c=s.forwardRef((e,t)=>{let{className:a,variant:s,size:n,asChild:c=!1,...d}=e,u=c?i.g7:"button";return(0,r.jsx)(u,{className:(0,l.cn)(o({variant:s,size:n,className:a})),ref:t,type:d.type||"button",...d,style:{WebkitTapHighlightColor:"transparent",touchAction:"manipulation",...d.style}})});c.displayName="Button"},7777:function(e,t,a){"use strict";a.d(t,{db:function(){return i}});var r=a(5966);class s extends r.ZP{async initialize(){try{await this.open();let e=await this.dbInfo.count();0===e&&await this.dbInfo.add({version:1,createdAt:new Date,corruptionCount:0})}catch(e){throw console.error("Failed to initialize database:",e),e}}async getVersion(){var e;let t=await this.dbInfo.orderBy("id").last();return null!==(e=null==t?void 0:t.version)&&void 0!==e?e:1}async recordCorruption(){let e=await this.dbInfo.orderBy("id").last();e&&await this.dbInfo.update(e.id,{corruptionCount:e.corruptionCount+1})}async getStorageInfo(){try{var e,t,a;let r=(null===(e=navigator.storage)||void 0===e?void 0:e.estimate)?await navigator.storage.estimate():null,s=await Promise.all([this.articles.count(),this.feeds.count(),this.folders.count(),this.summaries.count(),this.pendingActions.count(),this.apiUsage.count()]);return{quota:null!==(t=null==r?void 0:r.quota)&&void 0!==t?t:0,usage:null!==(a=null==r?void 0:r.usage)&&void 0!==a?a:0,counts:{articles:s[0],feeds:s[1],folders:s[2],summaries:s[3],pendingActions:s[4],apiUsage:s[5]}}}catch(e){return console.error("Failed to get storage info:",e),null}}async vacuum(){let e=new Set((await this.feeds.toArray()).map(e=>e.id)),t=new Set((await this.articles.toArray()).map(e=>e.id));await this.articles.where("feedId").noneOf(Array.from(e)).delete(),await this.summaries.where("articleId").noneOf(Array.from(t)).delete();let a=new Date;a.setDate(a.getDate()-7),await this.pendingActions.where("timestamp").below(a).delete();let r=new Date;r.setDate(r.getDate()-30),await this.apiUsage.where("date").below(r.toISOString().split("T")[0]).delete()}async clearAllData(){await this.transaction("rw",this.tables,async()=>{await Promise.all([this.articles.clear(),this.feeds.clear(),this.folders.clear(),this.summaries.clear(),this.pendingActions.clear(),this.apiUsage.clear(),this.userPreferences.clear()])})}constructor(){super("ShayonNewsDB"),this.version(1).stores({articles:"id, feedId, publishedAt, isRead, [feedId+isRead], [feedId+publishedAt], createdAt, updatedAt",feeds:"id, folderId, title, isActive, lastFetchedAt, createdAt, updatedAt",folders:"id, parentId, title, sortOrder, createdAt, updatedAt",summaries:"id, articleId, generatedAt, model",pendingActions:"id, type, articleId, timestamp, syncAttempts",apiUsage:"++id, date, inoreaderCalls, claudeCalls",userPreferences:"++id, userId, version, updatedAt",dbInfo:"++id, version, createdAt"}),this.on("versionchange",()=>{console.warn("Database version changed by another tab. Reloading..."),window.location.reload()})}}let i=new s},9394:function(e,t,a){"use strict";a.d(t,{DatabaseMigrations:function(){return s}});var r=a(7777);class s{static setupMigrations(){r.db.version(2).stores({articles:"id, feedId, publishedAt, isRead, [feedId+isRead], [feedId+publishedAt], createdAt, updatedAt, extractedAt",feeds:"id, folderId, title, isActive, lastFetchedAt, createdAt, updatedAt, errorCount",folders:"id, parentId, title, sortOrder, createdAt, updatedAt",summaries:"id, articleId, generatedAt, model, version",pendingActions:"id, type, articleId, timestamp, syncAttempts",apiUsage:"++id, date, inoreaderCalls, claudeCalls, totalCost",userPreferences:"++id, userId, version, updatedAt",dbInfo:"++id, version, createdAt, lastMigrationAt"}).upgrade(async e=>{console.log("Migrating database to version 2...");let t=0;await e.table("articles").toCollection().modify(e=>{!e.extractedAt&&e.createdAt&&(e.extractedAt=e.createdAt,t++)}),await e.table("feeds").toCollection().modify(e=>{void 0===e.errorCount&&(e.errorCount=0,t++)}),await e.table("summaries").toCollection().modify(e=>{!e.version&&(e.version=1,t++)}),await e.table("apiUsage").toCollection().modify(e=>{void 0===e.totalCost&&(e.totalCost=0,t++)}),await e.table("dbInfo").toCollection().modify(e=>{e.lastMigrationAt=new Date}),console.log("Migration to v2 completed. Updated ".concat(t," records."))}),r.db.version(3).stores({articles:"id, feedId, publishedAt, isRead, [feedId+isRead], [feedId+publishedAt], createdAt, updatedAt, extractedAt, readingTime",tags:"id, name, color, createdAt",articleTags:"[articleId+tagId], articleId, tagId"}).upgrade(async e=>{console.log("Migrating database to version 3..."),await e.table("articles").toCollection().modify(e=>{if(!e.readingTime&&e.content){let t=e.content.split(/\s+/).length;e.readingTime=Math.max(1,Math.round(t/200))}}),console.log("Migration to v3 completed.")})}static async handleCorruptedDatabase(){try{console.warn("Attempting to recover from database corruption..."),await r.db.recordCorruption();let e=await this.exportRecoverableData();if(await r.db.close(),await r.db.delete(),await r.db.open(),e)return await this.importRecoveredData(e),console.log("Successfully recovered from database corruption"),!0;return console.log("Database recreated but no data could be recovered"),!0}catch(e){return console.error("Failed to recover from database corruption:",e),!1}}static async exportRecoverableData(){try{let e={};try{e.userPreferences=await r.db.userPreferences.toArray()}catch(e){console.warn("Could not recover user preferences")}try{e.feeds=await r.db.feeds.toArray()}catch(e){console.warn("Could not recover feeds")}try{let t=new Date;t.setDate(t.getDate()-7),e.articles=await r.db.articles.where("publishedAt").above(t).toArray()}catch(e){console.warn("Could not recover articles")}return Object.keys(e).length>0?e:null}catch(e){return console.error("Failed to export recoverable data:",e),null}}static async importRecoveredData(e){try{var t,a,s;(null===(t=e.userPreferences)||void 0===t?void 0:t.length)>0&&await r.db.userPreferences.bulkAdd(e.userPreferences),(null===(a=e.feeds)||void 0===a?void 0:a.length)>0&&await r.db.feeds.bulkAdd(e.feeds),(null===(s=e.articles)||void 0===s?void 0:s.length)>0&&await r.db.articles.bulkAdd(e.articles),console.log("Recovered data imported successfully")}catch(e){console.error("Failed to import recovered data:",e)}}static async validateDatabaseIntegrity(){let e=[],t=[];try{let a=await r.db.articles.toArray(),s=new Set(a.map(e=>e.id)),i=await r.db.summaries.where("articleId").noneOf(Array.from(s)).count();i>0&&(e.push("Found ".concat(i," orphaned summaries")),await r.db.summaries.where("articleId").noneOf(Array.from(s)).delete(),t.push("Cleaned up ".concat(i," orphaned summaries")));let n=await r.db.feeds.toArray(),l=new Set(n.map(e=>e.id)),o=await r.db.articles.where("feedId").noneOf(Array.from(l)).count();o>0&&(e.push("Found ".concat(o," articles with invalid feeds")),await r.db.articles.where("feedId").noneOf(Array.from(l)).delete(),t.push("Cleaned up ".concat(o," articles with invalid feeds")));let c=await r.db.articles.filter(e=>!(e.publishedAt instanceof Date)||isNaN(e.publishedAt.getTime())).count();return c>0&&(e.push("Found ".concat(c," articles with invalid dates")),await r.db.articles.filter(e=>!(e.publishedAt instanceof Date)||isNaN(e.publishedAt.getTime())).modify(e=>{e.publishedAt=e.createdAt||new Date}),t.push("Fixed ".concat(c," articles with invalid dates"))),{isValid:0===e.length,issues:e,fixedIssues:t}}catch(e){return console.error("Database validation failed:",e),{isValid:!1,issues:["Validation failed: ".concat(e)],fixedIssues:t}}}static async initializeDefaultPreferences(){try{let e=await r.db.userPreferences.count();if(0===e){let e={theme:"system",syncFrequency:6,maxArticles:500,autoFetchFullContent:!1,enableNotifications:!1,fontSize:"medium",readingWidth:"medium",version:1,updatedAt:new Date};await r.db.userPreferences.add(e),console.log("Initialized default user preferences")}}catch(e){console.error("Failed to initialize default preferences:",e)}}}s.setupMigrations()},6232:function(e,t,a){"use strict";a.d(t,{storageManager:function(){return i}});var r=a(7777);class s{async getStorageStats(){try{var e,t,a;let r=await (null===(e=navigator.storage)||void 0===e?void 0:e.estimate());if(!r)return null;let s=null!==(t=r.quota)&&void 0!==t?t:0,i=null!==(a=r.usage)&&void 0!==a?a:0,n=s>0?i/s:0;return{totalBytes:s,usedBytes:i,availableBytes:s-i,quotaPercentage:n,isNearLimit:n>=this.QUOTA_WARNING_THRESHOLD,isCritical:n>=this.QUOTA_CRITICAL_THRESHOLD}}catch(e){return console.error("Failed to get storage estimate:",e),null}}async requestPersistentStorage(){try{if("storage"in navigator&&"persist"in navigator.storage)return await navigator.storage.persist();return!1}catch(e){return console.error("Failed to request persistent storage:",e),!1}}async isPersistentStorageGranted(){try{if("storage"in navigator&&"persisted"in navigator.storage)return await navigator.storage.persisted();return!1}catch(e){return console.error("Failed to check persistent storage status:",e),!1}}async pruneOldArticles(){try{if(await r.db.articles.count()<=this.MAX_ARTICLES)return 0;this.MAX_ARTICLES;let e=await r.db.articles.orderBy("publishedAt").reverse().limit(this.MAX_ARTICLES).primaryKeys(),t=await r.db.transaction("rw",[r.db.articles,r.db.summaries],async()=>{let t=await r.db.articles.where("id").noneOf(e).and(e=>{var t;return!(null===(t=e.tags)||void 0===t?void 0:t.includes("favorite"))}).primaryKeys();return 0===t.length?0:(await Promise.all([r.db.articles.bulkDelete(t),r.db.summaries.where("articleId").anyOf(t).delete()]),t.length)});return console.log("Pruned ".concat(t," old articles")),t}catch(e){return console.error("Failed to prune old articles:",e),0}}async pruneOldApiUsage(){try{let e=new Date;e.setDate(e.getDate()-30);let t=e.toISOString().split("T")[0],a=await r.db.apiUsage.where("date").below(t).delete();return a>0&&console.log("Pruned ".concat(a," old API usage records")),a}catch(e){return console.error("Failed to prune old API usage:",e),0}}async cleanupOrphanedData(){try{await r.db.vacuum(),console.log("Cleanup completed")}catch(e){console.error("Failed to cleanup orphaned data:",e)}}async performMaintenanceCleanup(){let e=await this.getStorageStats();if(!(null==e?void 0:e.isNearLimit))return{articlesDeleted:0,apiRecordsDeleted:0,stats:e};let[t,a]=await Promise.all([this.pruneOldArticles(),this.pruneOldApiUsage()]);return await this.cleanupOrphanedData(),{articlesDeleted:t,apiRecordsDeleted:a,stats:await this.getStorageStats()}}async handleQuotaExceeded(){console.warn("Storage quota exceeded, attempting cleanup...");try{let e=await this.performMaintenanceCleanup();if(0===e.articlesDeleted&&0===e.apiRecordsDeleted){let e=await r.db.articles.count(),t=Math.floor(.7*this.MAX_ARTICLES);if(e>t){let a=e-t,s=await r.db.articles.orderBy("publishedAt").limit(a).primaryKeys();await r.db.transaction("rw",[r.db.articles,r.db.summaries],async()=>{await Promise.all([r.db.articles.bulkDelete(s),r.db.summaries.where("articleId").anyOf(s).delete()])}),console.log("Emergency cleanup: deleted ".concat(a," articles"))}}return!0}catch(e){return console.error("Failed to handle quota exceeded:",e),!1}}async checkStorageHealth(){let e=await this.getStorageStats();return e?e.isCritical?{isHealthy:!1,warning:"Storage is critically full (".concat(Math.round(100*e.quotaPercentage),"%). Some data may be automatically cleaned up."),stats:e}:e.isNearLimit?{isHealthy:!1,warning:"Storage is getting full (".concat(Math.round(100*e.quotaPercentage),"%). Consider clearing old data."),stats:e}:{isHealthy:!0,stats:e}:{isHealthy:!1,warning:"Unable to check storage status",stats:null}}constructor(){this.MAX_ARTICLES=500,this.QUOTA_WARNING_THRESHOLD=.8,this.QUOTA_CRITICAL_THRESHOLD=.95}}let i=new s},3448:function(e,t,a){"use strict";a.d(t,{cn:function(){return i}});var r=a(1994),s=a(3335);function i(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.m6)((0,r.W)(t))}}},function(e){e.O(0,[569,831,387,971,117,744],function(){return e(e.s=5804)}),_N_E=e.O()}]);