(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{2432:function(e,t,r){Promise.resolve().then(r.bind(r,6171))},7168:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(9205).Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},6865:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(9205).Z)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},2489:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(9205).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},6171:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return _}});var s=r(7437),a=r(2265),n=r(9376),l=r(9087),i=r(3135),c=r(619),d=r(5669),o=r(9205);let u=(0,o.Z)("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]),m=(0,o.Z)("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]),h=(0,o.Z)("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);var x=r(6215),f=r(1817),p=r(7168);function g(e){let{selectedFeedId:t,onFeedSelect:r}=e,o=(0,n.useRouter)(),{feeds:g,feedsWithCounts:v,totalUnreadCount:y,loadFeedHierarchy:b}=(0,l.useFeedStore)(),{isSyncing:j,lastSyncTime:N,performFullSync:w,syncError:k,syncProgress:S,syncMessage:C,rateLimit:A}=(0,i.i)(),{theme:R,setTheme:F}=(0,c.H)(),{readStatusFilter:E}=(0,d.useArticleStore)(),T=(0,a.useRef)(null),z=(0,a.useRef)(0);return(0,a.useEffect)(()=>{console.log("[SimpleFeedSidebar] Component mounted, calling loadFeedHierarchy...");let e=performance.now();b().then(()=>{console.log("[SimpleFeedSidebar] loadFeedHierarchy completed in ".concat((performance.now()-e).toFixed(2),"ms"))})},[b]),(0,a.useEffect)(()=>{if("true"===new URLSearchParams(window.location.search).get("sync")){let e=new URL(window.location.href);e.searchParams.delete("sync"),window.history.replaceState({},"",e.pathname)}},[]),(0,a.useEffect)(()=>{let e=T.current;e&&(z.current=e.scrollTop,requestAnimationFrame(()=>{e.scrollTop=z.current}))},[E]),(0,s.jsxs)("div",{className:"h-full border-r bg-background flex flex-col pt-[env(safe-area-inset-top)]",children:[(0,s.jsxs)("div",{className:"p-4 border-b",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold",children:"Feeds"}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("button",{onClick:()=>{let e=["light","dark","system"],t=(e.indexOf(R)+1)%e.length;F(e[t])},className:"p-2 rounded hover:bg-muted transition-colors","aria-label":"Current theme: ".concat(R),children:(()=>{switch(R){case"light":return(0,s.jsx)(u,{className:"h-4 w-4"});case"dark":return(0,s.jsx)(m,{className:"h-4 w-4"});default:return(0,s.jsx)(h,{className:"h-4 w-4"})}})()}),(0,s.jsx)("button",{onClick:()=>o.push("/fetch-stats"),className:"p-2 rounded hover:bg-muted transition-colors","aria-label":"View fetch statistics",children:(0,s.jsx)(x.Z,{className:"h-4 w-4"})}),(0,s.jsxs)("button",{onClick:w,disabled:j,className:"p-2 rounded hover:bg-muted disabled:opacity-50 relative","aria-label":j?"Syncing...":"Sync feeds",children:[j?(0,s.jsx)(f.Z,{className:"h-4 w-4 animate-spin"}):(0,s.jsx)(p.Z,{className:"h-4 w-4"}),j&&S>0&&(0,s.jsxs)("span",{className:"absolute -bottom-1 left-1/2 transform -translate-x-1/2 text-[10px] font-medium",children:[S,"%"]})]})]})]}),(0,s.jsxs)("div",{className:"text-sm text-muted-foreground",children:[y," unread articles"]})]}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto",ref:T,children:j&&0===g.size?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center h-full p-4",children:[(0,s.jsx)(f.Z,{className:"h-8 w-8 animate-spin text-primary mb-4"}),(0,s.jsx)("p",{className:"text-sm font-medium",children:C||"Syncing your feeds..."}),S>0&&(0,s.jsxs)("div",{className:"w-full max-w-xs mt-3",children:[(0,s.jsx)("div",{className:"h-2 bg-muted rounded-full overflow-hidden",children:(0,s.jsx)("div",{className:"h-full bg-primary transition-all duration-300",style:{width:"".concat(S,"%")}})}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground mt-1 text-center",children:[S,"%"]})]})]}):k&&0===g.size?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center h-full p-4",children:[(0,s.jsx)("p",{className:"text-sm text-destructive mb-2",children:"Failed to sync feeds"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mb-4",children:k}),(0,s.jsx)("button",{onClick:w,className:"px-3 py-1 text-sm bg-primary text-primary-foreground rounded hover:bg-primary/90",children:"Retry"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"p-3 cursor-pointer hover:bg-muted/50 ".concat(t?"":"bg-muted font-medium"),onClick:()=>r(null),children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{children:"All Articles"}),(0,s.jsx)("span",{className:"text-xs bg-primary/10 text-primary px-2 py-0.5 rounded-full",children:y})]})}),0===g.size&&!j&&(0,s.jsxs)("div",{className:"p-4 text-center",children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:"No feeds yet"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mb-4",children:"Click the Sync button to load your feeds from Inoreader"})]}),Array.from(g.values()).sort((e,t)=>String(e.title||"").localeCompare(String(t.title||""),void 0,{numeric:!0,sensitivity:"base"})).filter(e=>{if(t===e.id)return!0;if("unread"===E){let t=v.get(e.id);return((null==t?void 0:t.unreadCount)||0)>0}return!0}).map(e=>{let a=v.get(e.id),n=(null==a?void 0:a.unreadCount)||0,l=t===e.id,i=n>0;return(0,s.jsx)("div",{className:"p-3 cursor-pointer hover:bg-muted/50 transition-all ".concat(l?"bg-muted font-medium":""," ").concat(i||l?"":"opacity-35 hover:opacity-100"),onClick:()=>r(e.id),children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"truncate",children:String(e.title||"Untitled Feed")}),n>0&&(0,s.jsx)("span",{className:"text-xs bg-primary/10 text-primary px-2 py-0.5 rounded-full",children:n>999?"999+":n})]})},e.id)}),(0,s.jsxs)("div",{className:"p-3 text-xs text-muted-foreground space-y-1",children:[N&&(0,s.jsxs)("div",{children:["Last sync: ",(0,s.jsx)("span",{suppressHydrationWarning:!0,children:new Date(N).toLocaleTimeString()})]}),(0,s.jsxs)("div",{children:[g.size," feeds total"]}),A&&(0,s.jsxs)("div",{className:A.used>=.8*A.limit?"text-amber-600":"",children:["API usage: ",A.used,"/",A.limit," calls today",A.used>=.95*A.limit&&(0,s.jsx)("span",{className:"text-destructive",children:" (Warning: Near limit!)"})]})]})]})})]})}function v(e){if("string"==typeof e)return e.replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#039;/g,"'").replace(/&ldquo;/g,'"').replace(/&rdquo;/g,'"').replace(/&lsquo;/g,"'").replace(/&rsquo;/g,"'").replace(/&hellip;/g,"...").replace(/&mdash;/g,"—").replace(/&ndash;/g,"–").replace(/\s+/g," ").trim();if(null==e)return"";if("object"==typeof e&&"content"in e&&"string"==typeof e.content)return e.content;if("object"==typeof e)try{if("direction"in e&&"string"==typeof e.direction)return console.warn("Found object with direction property, likely corrupted InoreaderContent:",e),JSON.stringify(e);return console.warn("Found unexpected object type, returning empty string:",e),""}catch(e){return console.error("Error processing object data:",e),""}return String(e)}var y=r(6682),b=r(5258),j=r(7663);function N(e){let{feedId:t,folderId:r,onArticleClick:n,scrollContainerRef:l}=e,i=(0,a.useRef)(null),c=(0,a.useRef)(null),o=(0,a.useRef)(null),u=(0,a.useRef)(0),m=(0,a.useRef)(!1),h=(0,a.useRef)(!1),x=(0,a.useRef)(null),g=(0,a.useRef)(0),N=(0,a.useRef)(new Set),k=(0,a.useRef)(null),{articles:S,loadingArticles:C,loadingMore:A,articlesError:R,hasMore:F,summarizingArticles:E,loadArticles:T,loadMoreArticles:z,markAsRead:M,markMultipleAsRead:I,toggleStar:Z,refreshArticles:L,clearError:q,readStatusFilter:O}=(0,d.useArticleStore)();(0,a.useEffect)(()=>{N.current.clear(),k.current&&clearTimeout(k.current),T(t,r)},[t,r,T]);let _=(0,a.useCallback)(()=>{if(N.current.size>0){let e=Array.from(N.current);N.current.clear(),I(e)}},[I]);(0,a.useEffect)(()=>{N.current.clear(),k.current&&clearTimeout(k.current),/iPhone|iPad|iPod/i.test(navigator.userAgent);let e=e=>{let t=e.currentTarget,r=t.scrollTop,s=r>g.current;g.current=r,s&&t.querySelectorAll("[data-article-id]").forEach(e=>{let r=e.getBoundingClientRect(),s=t.getBoundingClientRect();if(r.bottom<s.top+10){let t=e.getAttribute("data-article-id"),r="true"===e.getAttribute("data-is-read");t&&!r&&N.current.add(t)}}),s&&N.current.size>0&&(k.current&&clearTimeout(k.current),k.current=setTimeout(_,500))},t=null==l?void 0:l.current;return t&&t.addEventListener("scroll",e,{passive:!0}),t&&(x.current=new IntersectionObserver(e=>{e.forEach(e=>{if(!e.isIntersecting&&e.boundingClientRect.bottom<0){let t=e.target,r=t.getAttribute("data-article-id"),s="true"===t.getAttribute("data-is-read");r&&!s&&N.current.add(r)}})},{root:t,rootMargin:"0px 0px -90% 0px",threshold:0})),()=>{t&&t.removeEventListener("scroll",e),x.current&&x.current.disconnect(),k.current&&clearTimeout(k.current),_()}},[O,_,l]),(0,a.useEffect)(()=>{if(!C&&S.size>0&&!h.current){let e=sessionStorage.getItem("articleListScroll");e&&(h.current=!0,requestAnimationFrame(()=>{let t=parseInt(e,10),r=null==l?void 0:l.current;r&&(r.scrollTop=t),sessionStorage.removeItem("articleListScroll")}))}},[C,S.size]),(0,a.useEffect)(()=>{h.current=!1},[t,r]),(0,a.useEffect)(()=>(i.current=new IntersectionObserver(e=>{let[t]=e;t.isIntersecting&&F&&!A&&z()},{root:(null==l?void 0:l.current)||null,rootMargin:"100px",threshold:.1}),c.current&&i.current&&i.current.observe(c.current),()=>{i.current&&i.current.disconnect()}),[F,A,z]);let D=(0,a.useCallback)(e=>{u.current=e.touches[0].clientY},[]),P=(0,a.useCallback)(e=>{let t=e.touches[0].clientY-u.current,r=null==l?void 0:l.current;r&&0===r.scrollTop&&t>0&&(m.current=!0)},[l]),H=(0,a.useCallback)(async()=>{let e=null==l?void 0:l.current;m.current&&e&&0===e.scrollTop&&await L(),m.current=!1},[L,l]),U=(0,a.useCallback)(async e=>{let t=null==l?void 0:l.current,r=t?t.scrollTop:0;sessionStorage.setItem("articleListScroll",r.toString()),e.isRead||await M(e.id),null==n||n(e.id)},[M,n,l]),W=e=>{if(E.has(e.id))return(0,s.jsxs)("div",{className:"mt-2 space-y-2 animate-pulse",children:[(0,s.jsx)("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded w-full"}),(0,s.jsx)("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded w-full"}),(0,s.jsx)("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded w-3/4"})]});if(e.summary)return(0,s.jsx)("div",{className:"mt-2 space-y-2",children:e.summary.split(/\n+/).filter(e=>e.trim()).map((e,t)=>(0,s.jsx)("p",{className:"text-sm text-gray-700 dark:text-gray-300 leading-relaxed",children:e.trim()},t))});if(e.fullContent){let t=v(e.fullContent);if(t)return(0,s.jsx)("p",{className:"text-sm text-muted-foreground line-clamp-4 mt-2 break-words",children:t})}let t=v(e.content);return t?(0,s.jsx)("p",{className:"text-sm text-muted-foreground line-clamp-4 mt-2 break-words",children:t}):(0,s.jsx)("p",{className:"text-sm text-muted-foreground italic mt-2",children:"No preview available"})},Y=e=>{try{return(0,y.Q)(new Date(e),{addSuffix:!0})}catch(t){return new Date(e).toLocaleDateString()}};return C&&0===S.size?(0,s.jsx)(w,{}):R?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center h-full p-8",children:[(0,s.jsx)("p",{className:"text-muted-foreground mb-4",children:R}),(0,s.jsx)("button",{onClick:q,className:"text-sm text-primary hover:underline",children:"Try again"})]}):0===S.size?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center h-full p-8",children:[(0,s.jsx)("p",{className:"text-muted-foreground",children:"No articles found"}),(0,s.jsxs)("button",{onClick:L,className:"mt-4 flex items-center gap-2 text-sm text-primary hover:underline",children:[(0,s.jsx)(p.Z,{className:"h-4 w-4"}),"Refresh"]})]}):(0,s.jsx)("div",{ref:o,className:"flex-1 overflow-hidden",onTouchStart:D,onTouchMove:P,onTouchEnd:H,children:(0,s.jsxs)("div",{className:"divide-y divide-border overflow-x-hidden article-list-container",children:[Array.from(S.values()).map(e=>{var t;return(0,s.jsxs)("article",{"data-article-id":e.id,"data-is-read":e.isRead,ref:t=>{t&&x.current&&!e.isRead&&x.current.observe(t)},className:"relative p-4 sm:p-6 cursor-pointer transition-all duration-300 hover:bg-muted/50 overflow-hidden ".concat(e.isRead?"opacity-70":""),onClick:()=>U(e),role:"button",tabIndex:0,onKeyDown:t=>{("Enter"===t.key||" "===t.key)&&(t.preventDefault(),U(e))},children:[(0,s.jsx)("div",{className:"absolute inset-0 sm:hidden","aria-hidden":"true"}),(0,s.jsxs)("div",{className:"relative space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-start gap-2",children:[(0,s.jsx)("h2",{className:"text-base sm:text-lg flex-1 ".concat(e.isRead?"font-normal text-muted-foreground":"font-semibold text-foreground"),children:e.title}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[e.summary&&(0,s.jsx)("span",{className:"text-yellow-500 text-sm",title:"AI Summary Available",children:"⚡"}),!e.summary&&!E.has(e.id)&&(0,s.jsx)(b.v,{articleId:e.id,hasSummary:!1,variant:"icon",size:"sm"}),(0,s.jsx)(j.d,{onToggleStar:()=>Z(e.id),isStarred:(null===(t=e.tags)||void 0===t?void 0:t.includes("starred"))||!1,size:"sm"})]})]}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-x-2 gap-y-1 text-xs sm:text-sm text-muted-foreground",children:[(0,s.jsx)("span",{className:"font-medium",children:e.feedTitle}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"•"}),(0,s.jsx)("time",{dateTime:e.publishedAt.toISOString(),suppressHydrationWarning:!0,children:Y(e.publishedAt)}),e.author&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"hidden sm:inline",children:"•"}),(0,s.jsx)("span",{className:"truncate max-w-[150px]",children:e.author})]})]}),(0,s.jsx)("div",{className:"text-sm overflow-hidden",children:W(e)})]})]},e.id)}),F&&(0,s.jsx)("div",{ref:c,className:"p-8 text-center",children:A&&(0,s.jsx)(f.Z,{className:"h-6 w-6 animate-spin mx-auto text-muted-foreground"})})]})})}function w(){return(0,s.jsx)("div",{className:"divide-y divide-border animate-pulse",children:[void 0,void 0,void 0,void 0,void 0].map((e,t)=>(0,s.jsxs)("div",{className:"p-4 sm:p-6 space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-start gap-2",children:[(0,s.jsx)("div",{className:"h-5 bg-muted rounded w-3/4"}),(0,s.jsx)("div",{className:"h-4 w-4 bg-muted rounded"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"h-3 bg-muted rounded w-24"}),(0,s.jsx)("div",{className:"h-3 bg-muted rounded w-20"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("div",{className:"h-3 bg-muted rounded w-full"}),(0,s.jsx)("div",{className:"h-3 bg-muted rounded w-full"}),(0,s.jsx)("div",{className:"h-3 bg-muted rounded w-3/4"})]})]},t))})}var k=r(875),S=r(791);function C(){let{readStatusFilter:e,setReadStatusFilter:t}=(0,d.useArticleStore)(),r=[{value:"unread",label:"Unread only",description:"Focus on new content"},{value:"read",label:"Read only",description:"Review previously read articles"},{value:"all",label:"All articles",description:"Complete view of all content"}],a=r.find(t=>t.value===e);return(0,s.jsxs)(S.fC,{children:[(0,s.jsx)(S.xz,{asChild:!0,children:(0,s.jsxs)("button",{className:"flex items-center gap-2 px-3 py-1.5 text-sm border rounded-md hover:bg-muted transition-colors","aria-label":"Current filter: ".concat(null==a?void 0:a.label,". Click to change filter"),children:[(0,s.jsx)("span",{children:null==a?void 0:a.label}),(0,s.jsx)(k.Z,{className:"h-4 w-4"})]})}),(0,s.jsx)(S.Uv,{children:(0,s.jsx)(S.VY,{className:"min-w-[200px] bg-background rounded-md shadow-md border p-1 z-50",align:"end",sideOffset:5,children:r.map(r=>(0,s.jsxs)(S.ck,{className:"\n                flex flex-col items-start px-3 py-2 text-sm rounded cursor-pointer\n                ".concat(e===r.value?"bg-primary text-primary-foreground":"hover:bg-muted","\n              "),onSelect:()=>t(r.value),children:[(0,s.jsx)("span",{className:"font-medium",children:r.label}),(0,s.jsx)("span",{className:"text-xs ".concat(e===r.value?"text-primary-foreground/80":"text-muted-foreground"),children:r.description})]},r.value))})})]})}var A=r(7205);class R{async getArticleCounts(e,t){let r="".concat(e||"all","-").concat(t||"all"),s=this.cache.get(r);if(s&&Date.now()-s.timestamp<this.CACHE_TTL)return s.counts;let a=await this.fetchCountsFromDatabase(e,t);return this.cache.set(r,{counts:a,timestamp:Date.now(),feedId:e,folderId:t}),a}async fetchCountsFromDatabase(e,t){try{let r=A.OQ.from("articles").select("*",{count:"exact",head:!0});if(e)r=r.eq("feed_id",e);else if(t){let{data:e}=await A.OQ.from("feeds").select("id").eq("folder_id",t),s=(null==e?void 0:e.map(e=>e.id))||[];if(0===s.length)return{total:0,unread:0,read:0};r=r.in("feed_id",s)}let{count:s}=await r,a=A.OQ.from("articles").select("*",{count:"exact",head:!0}).eq("is_read",!1);if(e)a=a.eq("feed_id",e);else if(t){let{data:e}=await A.OQ.from("feeds").select("id").eq("folder_id",t),r=(null==e?void 0:e.map(e=>e.id))||[];r.length>0&&(a=a.in("feed_id",r))}let{count:n}=await a;return{total:s||0,unread:n||0,read:(s||0)-(n||0)}}catch(e){return console.error("Failed to fetch article counts:",e),{total:0,unread:0,read:0}}}invalidateCache(e){if(e){let t=[];this.cache.forEach((r,s)=>{(s.includes(e)||s.startsWith("all-"))&&t.push(s)}),t.forEach(e=>this.cache.delete(e))}else this.cache.clear()}getCountDisplay(e,t){switch(t){case"unread":return"".concat(e.unread," unread articles");case"read":return"".concat(e.read," read articles");case"all":return"".concat(e.total," total articles (").concat(e.unread," unread)");default:return"".concat(e.total," articles")}}constructor(){this.cache=new Map,this.CACHE_TTL=3e5}}let F=(e,t,r)=>r?r.title:t?t.title:"Articles";new R;var E=r(2381),T=r(6865);let z=(0,o.Z)("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);var M=r(4438);function I(e){let{selectedFeedId:t,selectedFolderId:r,isMobile:n=!1,onMenuClick:i,menuIcon:c}=e,{readStatusFilter:o,markAllAsRead:u,refreshArticles:m}=(0,d.useArticleStore)(),{getFeed:h,getFolder:x}=(0,l.useFeedStore)(),[p,g]=(0,a.useState)({total:0,unread:0,read:0}),[v,y]=(0,a.useState)(!0),[b,j]=(0,a.useState)(!1),[N,w]=(0,a.useState)(!1),k=(0,a.useRef)(null),S=(0,a.useRef)(new R),A=t?h(t):void 0,I=r?x(r):void 0;(0,a.useEffect)(()=>{(async()=>{y(!0);try{let e=await S.current.getArticleCounts(t||void 0,r||void 0);g(e)}catch(e){console.error("Failed to fetch article counts:",e),g({total:0,unread:0,read:0})}finally{y(!1)}})()},[o,t,r]),(0,a.useEffect)(()=>(window.__articleCountManager=S.current,()=>{delete window.__articleCountManager}),[]);let[Z,L]=(0,a.useState)(!1);(0,a.useEffect)(()=>{L(!0)},[]);let q=Z?F(o,A,I):"Articles";(0,a.useEffect)(()=>()=>{k.current&&clearTimeout(k.current)},[]);let O=async()=>{if(t&&!b){if(!N){w(!0),k.current=setTimeout(()=>{w(!1)},3e3);return}k.current&&clearTimeout(k.current),w(!1),j(!0);try{await u(t),S.current.invalidateCache(t),await m();let e=await S.current.getArticleCounts(t,r||void 0);g(e),M.A.success("Marked all articles as read in ".concat((null==A?void 0:A.title)||"feed"))}catch(e){console.error("Failed to mark all as read:",e),M.A.error("Failed to mark all articles as read")}finally{j(!1)}}};return(0,s.jsxs)("header",{className:"border-b px-4 md:px-6 py-3 md:py-4 flex items-center justify-between gap-3 pwa-safe-area-top",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[n&&i&&(0,s.jsx)("button",{onClick:i,className:"p-2 hover:bg-muted rounded-lg flex-shrink-0","aria-label":"Toggle sidebar",children:c}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("h1",{className:"text-lg sm:text-xl md:text-2xl font-semibold break-words",children:q}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:!Z||v?"Loading counts...":S.current.getCountDisplay(p,o)})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 flex-shrink-0",children:[t&&p.unread>0&&(0,s.jsx)(E.z,{variant:N?"destructive":"outline",size:"sm",onClick:O,disabled:b,className:N?"gap-1.5 bg-red-500/20 hover:bg-red-500/30 text-red-600 dark:text-red-400 border-red-500/50":"gap-1.5",title:N?"Click again to confirm":"Mark all articles in this feed as read",children:b?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(f.Z,{className:"h-3.5 w-3.5 animate-spin"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"Marking..."})]}):N?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(T.Z,{className:"h-3.5 w-3.5"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"Confirm?"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(z,{className:"h-3.5 w-3.5"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"Mark All Read"})]})}),(0,s.jsx)(C,{})]})]})}class Z extends a.Component{static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("ErrorBoundary caught an error:",e,t)}render(){if(this.state.hasError){var e;return this.props.fallback||(0,s.jsxs)("div",{className:"p-4 text-center",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-destructive mb-2",children:"Something went wrong"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:(null===(e=this.state.error)||void 0===e?void 0:e.message)||"An unexpected error occurred"}),(0,s.jsx)("button",{onClick:()=>this.setState({hasError:!1}),className:"px-4 py-2 bg-primary text-primary-foreground rounded hover:bg-primary/90",children:"Try again"})]})}return this.props.children}constructor(e){super(e),this.state={hasError:!1}}}var L=r(2489);let q=(0,o.Z)("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);var O=r(265);function _(){let e=(0,n.useRouter)();!function(){let e=(0,d.useArticleStore)(e=>e.setReadStatusFilter);(0,a.useEffect)(()=>{let t=localStorage.getItem("readStatusFilter");("all"===t||"unread"===t||"read"===t)&&e(t)},[e])}();let t=(0,a.useRef)(0),r=(0,a.useRef)(null);(0,a.useRef)(null);let[l,i]=(0,a.useState)(()=>{{let e=sessionStorage.getItem("articleListFilter");return"null"===e?null:e}}),[c,o]=(0,a.useState)(!1),[u,m]=(0,a.useState)(!1),h=/iPhone|iPad|iPod/i.test(navigator.userAgent),x=(0,a.useRef)(null);return(0,a.useEffect)(()=>{let e=!1,s=s=>{e||(window.requestAnimationFrame(()=>{let a=s.target.scrollTop,n=a-t.current;r.current&&(n>0&&a>50?r.current.style.transform="translateY(-100%)":n<0?r.current.style.transform="translateY(0)":a<5&&(r.current.style.transform="translateY(0)"),h&&m(a>300),t.current=a,e=!1)}),e=!0)},a=x.current;return a&&a.addEventListener("scroll",s,{passive:!0}),()=>{a&&a.removeEventListener("scroll",s)}},[h]),(0,s.jsxs)("div",{className:"flex h-screen bg-background relative w-full overflow-hidden",children:[c&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 z-40 md:hidden",onClick:()=>o(!1)}),(0,s.jsx)("div",{className:"\n        fixed md:relative inset-y-0 left-0 z-50\n        transform ".concat(c?"translate-x-0":"-translate-x-full","\n        md:translate-x-0 transition-transform duration-200 ease-in-out\n        w-[280px] md:w-80 h-full\n      "),children:(0,s.jsx)(Z,{fallback:(0,s.jsx)("div",{className:"h-full border-r bg-muted/10 p-4",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Feed sidebar error"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-2",children:"Data synced successfully"})]})}),children:(0,s.jsx)(g,{selectedFeedId:l,onFeedSelect:e=>{i(e),sessionStorage.setItem("articleListFilter",e||"null"),window.innerWidth<768&&o(!1)},onClose:()=>o(!1)})})}),(0,s.jsxs)("div",{className:"flex-1 flex flex-col min-w-0 h-full overflow-hidden",children:[(0,s.jsx)("div",{ref:r,className:"fixed top-0 left-0 right-0 md:left-80 z-30 bg-background border-b transition-transform duration-300 ease-in-out",style:{transform:"translateY(0)"},children:(0,s.jsx)(I,{selectedFeedId:l,selectedFolderId:null,isMobile:!0,onMenuClick:()=>o(!c),menuIcon:c?(0,s.jsx)(L.Z,{className:"h-5 w-5"}):(0,s.jsx)(q,{className:"h-5 w-5"})})}),(0,s.jsxs)("div",{ref:x,className:"flex-1 pt-[73px] overflow-y-auto ios-scroll-container relative",children:[(0,s.jsx)(N,{feedId:l||void 0,onArticleClick:t=>{e.push("/article/".concat(encodeURIComponent(t)))},scrollContainerRef:x}),h&&u&&(0,s.jsx)("button",{onClick:()=>{x.current&&x.current.scrollTo({top:0,behavior:"smooth"})},className:"liquid-glass-btn","aria-label":"Scroll to top",children:(0,s.jsx)(O.Z,{className:"h-5 w-5"})})]})]})]})}},7663:function(e,t,r){"use strict";r.d(t,{d:function(){return l}});var s=r(7437),a=r(6595),n=r(1637);function l(e){let{onToggleStar:t,isStarred:r,size:l="sm",disabled:i=!1}=e;return(0,s.jsx)(n.K,{icon:a.Z,onPress:t,size:l,active:r,activeClassName:"fill-yellow-500 text-yellow-500",label:r?"Unstar":"Star",disabled:i})}},5258:function(e,t,r){"use strict";r.d(t,{v:function(){return m}});var s=r(7437),a=r(2265),n=r(9076),l=r(2023),i=r(1817),c=r(5669),d=r(3448),o=r(4784),u=r(1637);function m(e){let{articleId:t,hasSummary:r,variant:m="full",size:h="sm",className:x,onSuccess:f}=e,[p,g]=(0,a.useState)(!1),[v,y]=(0,a.useState)(null),{generateSummary:b}=(0,c.useArticleStore)(),j=async()=>{g(!0),y(null);try{await b(t,r),null==f||f()}catch(e){y(e instanceof Error?e.message:"Failed to generate summary"),console.error("Summary generation error:",e)}finally{g(!1)}};return"icon"===m?(0,s.jsx)(u.K,{icon:r?n.Z:l.Z,onPress:j,size:h,active:!1,label:r?"Regenerate summary":"Generate AI summary",disabled:p,loading:p,loadingIcon:i.Z,className:x}):(0,s.jsx)(o.M,{onPress:j,disabled:p,variant:"default",size:"sm",className:(0,d.cn)("bg-blue-600 hover:bg-blue-700 active:bg-blue-800",x),children:p?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.Z,{className:"h-4 w-4 animate-spin"}),"Generating..."]}):r?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.Z,{className:"h-4 w-4"}),"Re-summarize"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.Z,{className:"h-4 w-4"}),"Summarize"]})})}},1637:function(e,t,r){"use strict";r.d(t,{K:function(){return i}});var s=r(7437);r(2265);var a=r(4784),n=r(3448);let l={sm:"h-4 w-4",md:"h-5 w-5",lg:"h-6 w-6"};function i(e){let{icon:t,onPress:r,size:i="sm",active:c=!1,activeClassName:d,label:o,title:u,disabled:m=!1,loading:h=!1,loadingIcon:x,className:f}=e,p=l[i],g=h&&x?x:t;return(0,s.jsx)(a.M,{variant:"ghost",size:"icon",onPress:r,disabled:m||h,className:(0,n.cn)("p-1 hover:bg-muted rounded",f),"aria-label":o,title:u||o,children:(0,s.jsx)(g,{className:(0,n.cn)(p,h&&"animate-spin",c&&d?d:c?"text-primary":"text-muted-foreground")})})}},4784:function(e,t,r){"use strict";r.d(t,{M:function(){return l}});var s=r(7437),a=r(2265),n=r(2381);let l=a.forwardRef((e,t)=>{let{onPress:r,onClick:l,children:i,...c}=e,d=(0,a.useRef)(!1);return(0,s.jsx)(n.z,{ref:t,...c,onClick:e=>{if(e.stopPropagation(),d.current){e.preventDefault(),d.current=!1;return}l?l(e):r&&r()},onTouchStart:()=>{d.current=!0},onTouchEnd:e=>{e.preventDefault(),e.stopPropagation(),r?r():l&&l(e),d.current=!1},style:{...c.style,WebkitTouchCallout:"none",WebkitUserSelect:"none",touchAction:"manipulation"},children:i})});l.displayName="IOSButton"},619:function(e,t,r){"use strict";r.d(t,{H:function(){return n}});var s=r(3011),a=r(6885);let n=(0,s.U)()((0,a.tJ)((e,t)=>({theme:"system",setTheme:t=>e({theme:t}),isSidebarOpen:!1,setSidebarOpen:t=>e({isSidebarOpen:t}),toggleSidebar:()=>e(e=>({isSidebarOpen:!e.isSidebarOpen})),isArticleOpen:!1,selectedArticleId:null,setSelectedArticle:t=>e({selectedArticleId:t,isArticleOpen:null!==t}),isLoading:!1,setLoading:t=>e({isLoading:t}),notification:null,showNotification:(t,r)=>e({notification:{message:t,type:r,visible:!0}}),hideNotification:()=>e({notification:null})}),{name:"ui-store",partialize:e=>({theme:e.theme})}))}},function(e){e.O(0,[569,580,850,541,458,438,87,978,971,117,744],function(){return e(e.s=2432)}),_N_E=e.O()}]);