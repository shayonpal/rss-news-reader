(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[241],{3687:function(e,t,a){Promise.resolve().then(a.bind(a,1808))},1808:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return U}});var r=a(7437),s=a(2265),n=a(9376),l=a(5669),i=a(9087),o=a(4784),c=a(2660),d=a(1533),u=a(8919),m=a(6362),f=a(6215),x=a(2451),h=a(407),g=a(265),p=a(6682),y=a(3448),b=a(7835),v=a.n(b),j=a(5258),w=a(7663),N=a(2135),k=a(875);function S(e){let{summary:t,className:a,collapsible:n=!1,defaultExpanded:l=!0}=e,[i,o]=(0,s.useState)(l);return(0,r.jsxs)("div",{className:(0,y.cn)("bg-gray-100 dark:bg-gray-800 rounded-lg mb-6",a),children:[(0,r.jsxs)("button",{onClick:()=>n&&o(!i),disabled:!n,className:(0,y.cn)("w-full px-4 py-3 flex items-center justify-between text-left",n&&"hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"),children:[(0,r.jsx)("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Summary"}),n&&(i?(0,r.jsx)(N.Z,{className:"h-4 w-4 text-gray-500"}):(0,r.jsx)(k.Z,{className:"h-4 w-4 text-gray-500"}))]}),i&&(0,r.jsx)("div",{className:"px-4 pb-4",children:(0,r.jsx)("div",{className:"text-sm text-gray-700 dark:text-gray-300 leading-relaxed space-y-3",children:t.split(/\n+/).filter(e=>e.trim()).map((e,t)=>(0,r.jsx)("p",{children:e.trim()},t))})})]})}var R=a(4064),F=a(2735),Z=a(1817),A=a(9322),z=a(1637);function C(e){let{articleId:t,hasFullContent:a=!1,variant:n="icon",size:l="sm",className:i,onSuccess:c,onRevert:d}=e,[u,m]=(0,s.useState)(!1),[f,x]=(0,s.useState)(null),h=async()=>{if(!u){m(!0),x(null);try{let e=await fetch("/reader/api/articles/".concat(t,"/fetch-content"),{method:"POST"}),a=await e.json();if(!e.ok)throw console.error("Fetch content error:",{status:e.status,data:a,articleId:t}),Error(a.message||a.details||"Failed to fetch content");a.success&&a.content&&(null==c||c(a.content))}catch(e){console.error("Failed to fetch content:",e),x(e instanceof Error?e.message:"Failed to fetch content")}finally{m(!1)}}},g=()=>{a&&d?d():h()};return"icon"===n?(0,r.jsx)(z.K,{icon:a?R.Z:F.Z,onPress:g,size:l,active:!1,label:a?"Revert to RSS content":"Fetch full content",disabled:u,loading:u,loadingIcon:Z.Z,className:i}):(0,r.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,r.jsx)(o.M,{onPress:g,disabled:u,variant:"outline",size:"lg",className:(0,y.cn)("gap-2 px-6 py-3 text-base font-medium min-w-[200px]",i),children:u?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Z.Z,{className:"h-4 w-4 animate-spin"}),a?"Reverting...":"Fetching full content..."]}):a?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(R.Z,{className:"h-4 w-4"}),"Revert to RSS Content"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(F.Z,{className:"h-4 w-4"}),"Fetch Full Content"]})}),f&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm text-red-600 dark:text-red-400",children:[(0,r.jsx)(A.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{children:f})]})]})}var T=a(791),E=a(401),P=a(519);let _=T.fC,I=T.xz;T.ZA,T.Uv,T.Tr,T.Ee,s.forwardRef((e,t)=>{let{className:a,inset:s,children:n,...l}=e;return(0,r.jsxs)(T.fF,{ref:t,className:(0,y.cn)("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",s&&"pl-8",a),...l,children:[n,(0,r.jsx)(h.Z,{className:"ml-auto h-4 w-4"})]})}).displayName=T.fF.displayName,s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(T.tu,{ref:t,className:(0,y.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...s})}).displayName=T.tu.displayName;let L=s.forwardRef((e,t)=>{let{className:a,sideOffset:s=4,...n}=e;return(0,r.jsx)(T.Uv,{children:(0,r.jsx)(T.VY,{ref:t,sideOffset:s,className:(0,y.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...n})})});L.displayName=T.VY.displayName;let M=s.forwardRef((e,t)=>{let{className:a,inset:s,...n}=e;return(0,r.jsx)(T.ck,{ref:t,className:(0,y.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s&&"pl-8",a),...n})});M.displayName=T.ck.displayName,s.forwardRef((e,t)=>{let{className:a,children:s,checked:n,...l}=e;return(0,r.jsxs)(T.oC,{ref:t,className:(0,y.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:n,...l,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(T.wU,{children:(0,r.jsx)(E.Z,{className:"h-4 w-4"})})}),s]})}).displayName=T.oC.displayName,s.forwardRef((e,t)=>{let{className:a,children:s,...n}=e;return(0,r.jsxs)(T.Rk,{ref:t,className:(0,y.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...n,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(T.wU,{children:(0,r.jsx)(P.Z,{className:"h-2 w-2 fill-current"})})}),s]})}).displayName=T.Rk.displayName,s.forwardRef((e,t)=>{let{className:a,inset:s,...n}=e;return(0,r.jsx)(T.__,{ref:t,className:(0,y.cn)("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",a),...n})}).displayName=T.__.displayName;let O=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(T.Z0,{ref:t,className:(0,y.cn)("-mx-1 my-1 h-px bg-muted",a),...s})});function D(e){var t;let{article:a,feed:b,feedTitle:N,onToggleStar:k,onNavigate:R,onBack:F}=e,Z=(0,n.useRouter)(),A=(0,s.useRef)(null),z=(0,s.useRef)(null),T=(0,s.useRef)(0),[E,P]=(0,s.useState)(null),[D,U]=(0,s.useState)(null),[Y,q]=(0,s.useState)(a),{getArticle:W}=(0,l.useArticleStore)(),{updateFeedPartialContent:G}=(0,i.useFeedStore)(),[K,B]=(0,s.useState)(!1),[V,X]=(0,s.useState)(!1),H=/iPhone|iPad|iPod/i.test(navigator.userAgent);(0,s.useEffect)(()=>{q(a)},[a]);let Q=async()=>{let e=await W(a.id);e&&q(e)},J=async e=>{q({...Y,fullContent:e,hasFullContent:!0});let t=await W(a.id);t&&q(t)},$=()=>{q({...Y,fullContent:void 0,hasFullContent:!1})},ee=(Y.fullContent||Y.content).replace(/<a\s+([^>]*?)>/gi,(e,t)=>{let a=/target\s*=\s*["'][^"']*["']/i.test(t),r=/rel\s*=\s*["'][^"']*["']/i.test(t),s=t;return a?s=s.replace(/target\s*=\s*["'][^"']*["']/i,'target="_blank"'):s+=' target="_blank"',r?s=s.replace(/rel\s*=\s*["']([^"']*)["']/i,(e,t)=>{let a=new Set(t.split(/\s+/));return a.add("noopener"),a.add("noreferrer"),'rel="'.concat(Array.from(a).join(" "),'"')}):s+=' rel="noopener noreferrer"',"<a ".concat(s,">")}),et=v().sanitize(ee,{ALLOWED_TAGS:["p","a","img","h1","h2","h3","h4","h5","h6","ul","ol","li","blockquote","pre","code","em","strong","br","figure","figcaption","iframe","video"],ALLOWED_ATTR:["href","src","alt","title","width","height","target","rel","class","id","allowfullscreen","frameborder"],ALLOW_DATA_ATTR:!1,ADD_TAGS:["a"],ADD_ATTR:["target","rel"]});(0,s.useEffect)(()=>{let e=e=>{"ArrowLeft"===e.key?R("prev"):"ArrowRight"===e.key?R("next"):"Escape"===e.key&&F()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[R,F]),(0,s.useEffect)(()=>{let e=!1,t=()=>{e||(window.requestAnimationFrame(()=>{let t=window.scrollY,a=t-T.current;z.current&&(a>0&&t>50?z.current.style.transform="translateY(-100%)":a<0?z.current.style.transform="translateY(0)":t<5&&(z.current.style.transform="translateY(0)"),H&&X(t>300),T.current=t,e=!1)}),e=!0)};return window.addEventListener("scroll",t,{passive:!0}),()=>{window.removeEventListener("scroll",t)}},[H]);let ea=async()=>{if(navigator.share&&Y.url)try{await navigator.share({title:Y.title,text:Y.summary||"",url:Y.url})}catch(e){}else if(Y.url)try{await navigator.clipboard.writeText(Y.url)}catch(e){}},er=async()=>{if(b&&a.feedId){B(!0);try{await G(a.feedId,!b.isPartialContent)}catch(e){}finally{B(!1)}}};return(0,r.jsxs)("div",{className:"min-h-screen bg-white dark:bg-gray-900 w-full overflow-x-hidden",onTouchStart:e=>{U(null),P(e.targetTouches[0].clientX)},onTouchMove:e=>{U(e.targetTouches[0].clientX)},onTouchEnd:()=>{if(!E||!D)return;let e=E-D;e>50?R("next"):e<-50&&R("prev")},children:[(0,r.jsx)("header",{ref:z,className:"fixed top-0 left-0 right-0 z-10 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 transition-transform duration-300 ease-in-out pwa-safe-area-top",style:{transform:"translateY(0)"},children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex items-center justify-between",children:[(0,r.jsx)(o.M,{variant:"ghost",size:"icon",onPress:F,"aria-label":"Back to list",className:"hover:bg-gray-100 dark:hover:bg-gray-800 active:bg-gray-200 dark:active:bg-gray-700",children:(0,r.jsx)(c.Z,{className:"h-5 w-5"})}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(w.d,{onToggleStar:k,isStarred:(null===(t=Y.tags)||void 0===t?void 0:t.includes("starred"))||!1,size:"md"}),(0,r.jsx)(j.v,{articleId:Y.id,hasSummary:!!Y.summary,variant:"icon",size:"md",onSuccess:Q}),(0,r.jsx)(C,{articleId:Y.id,hasFullContent:Y.hasFullContent,variant:"icon",size:"md",onSuccess:J,onRevert:$}),(0,r.jsxs)(_,{children:[(0,r.jsx)(I,{asChild:!0,children:(0,r.jsx)(o.M,{variant:"ghost",size:"icon","aria-label":"More options",className:"hover:bg-gray-100 dark:hover:bg-gray-800 active:bg-gray-200 dark:active:bg-gray-700",children:(0,r.jsx)(d.Z,{className:"h-5 w-5"})})}),(0,r.jsxs)(L,{align:"end",className:"w-48",children:[b&&(0,r.jsxs)(M,{onSelect:er,disabled:K,className:"relative",children:[(0,r.jsx)("span",{className:(0,y.cn)("mr-2 text-base transition-opacity duration-200",K&&"opacity-50"),children:b.isPartialContent?"☑":"☐"}),(0,r.jsx)("span",{className:(0,y.cn)("transition-opacity duration-200",K&&"opacity-50"),children:"Partial Feed"}),K&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-gray-300 border-t-gray-600 dark:border-gray-600 dark:border-t-gray-300"})})]}),(0,r.jsxs)(M,{onSelect:ea,children:[(0,r.jsx)(u.Z,{className:"mr-2 h-4 w-4"}),"Share"]}),Y.url&&(0,r.jsxs)(M,{onSelect:()=>window.open(Y.url,"_blank","noopener,noreferrer"),children:[(0,r.jsx)(m.Z,{className:"mr-2 h-4 w-4"}),"Open Original"]}),(0,r.jsx)(O,{}),(0,r.jsxs)(M,{onSelect:()=>Z.push("/fetch-stats"),children:[(0,r.jsx)(f.Z,{className:"mr-2 h-4 w-4"}),"Fetch Stats"]})]})]})]})]})}),(0,r.jsx)("div",{className:"h-[60px] pwa-safe-area-top"}),(0,r.jsxs)("article",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8",children:[(0,r.jsxs)("div",{className:"mb-6 sm:mb-8",children:[(0,r.jsx)("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-bold text-gray-900 dark:text-gray-100 mb-3 sm:mb-4 leading-tight",children:Y.title}),(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[(0,r.jsx)("span",{className:"font-medium",children:N}),(0,r.jsx)("span",{children:"•"}),Y.author&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{children:Y.author}),(0,r.jsx)("span",{children:"•"})]}),(0,r.jsx)("time",{dateTime:Y.publishedAt.toISOString(),children:(0,p.Q)(Y.publishedAt,{addSuffix:!0})})]})]}),Y.summary&&(0,r.jsx)(S,{summary:Y.summary,collapsible:!0,defaultExpanded:!0}),(0,r.jsx)("div",{ref:A,className:"prose prose-base sm:prose-lg dark:prose-invert max-w-none prose-headings:font-bold prose-a:text-blue-600 dark:prose-a:text-blue-400 prose-a:underline prose-img:rounded-lg prose-img:shadow-md prose-img:max-w-full prose-img:h-auto prose-blockquote:border-l-4 prose-blockquote:border-gray-300 dark:prose-blockquote:border-gray-700 prose-code:bg-gray-100 dark:prose-code:bg-gray-800 prose-code:rounded prose-code:px-1 prose-pre:bg-gray-100 dark:prose-pre:bg-gray-800 prose-pre:overflow-x-auto [&>*]:break-words",style:{touchAction:"manipulation"},dangerouslySetInnerHTML:{__html:et}}),(0,r.jsx)("div",{className:"mt-8 mb-8 flex justify-center",children:(0,r.jsx)(C,{articleId:Y.id,hasFullContent:Y.hasFullContent,variant:"button",onSuccess:J,onRevert:$})})]}),(0,r.jsx)("footer",{className:"fixed bottom-0 left-0 right-0 z-10 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-800",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex items-center justify-between",children:[(0,r.jsxs)(o.M,{variant:"ghost",size:"sm",onPress:()=>R("prev"),"aria-label":"Previous article",className:"flex items-center gap-2 hover:bg-gray-100 dark:hover:bg-gray-800 active:bg-gray-200 dark:active:bg-gray-700",children:[(0,r.jsx)(x.Z,{className:"h-4 w-4"}),"Previous"]}),(0,r.jsxs)(o.M,{variant:"ghost",size:"sm",onPress:()=>R("next"),"aria-label":"Next article",className:"flex items-center gap-2 hover:bg-gray-100 dark:hover:bg-gray-800 active:bg-gray-200 dark:active:bg-gray-700",children:["Next",(0,r.jsx)(h.Z,{className:"h-4 w-4"})]})]})}),(0,r.jsx)("div",{className:"h-[60px]"}),H&&V&&(0,r.jsx)("button",{onClick:()=>{window.scrollTo({top:0,behavior:"smooth"})},className:"liquid-glass-btn","aria-label":"Scroll to top",children:(0,r.jsx)(g.Z,{className:"h-5 w-5"})})]})}function U(){let e=(0,n.useParams)(),t=(0,n.useRouter)(),a=e.id?decodeURIComponent(e.id):"",{articles:o,getArticle:c,markAsRead:d,toggleStar:u}=(0,l.useArticleStore)(),{feeds:m}=(0,i.useFeedStore)(),[f,x]=(0,s.useState)(null),[h,g]=(0,s.useState)(!0);(0,s.useEffect)(()=>{(async()=>{try{let e=await c(a);e?(x(e),e.isRead||await d(a)):(0,n.notFound)()}catch(e){console.error("Error loading article:",e),t.push("/")}finally{g(!1)}})()},[a,c,d,t]);let p=async()=>{if(f){await u(f.id);let e=await c(f.id);e&&x(e)}},y=async e=>{let r=Array.from(o.values()),s=r.findIndex(e=>e.id===a);if(-1===s)return;let n="next"===e?s+1:s-1;n<0?n=r.length-1:n>=r.length&&(n=0);let l=r[n];l&&t.push("/article/".concat(encodeURIComponent(l.id)))};if(h)return(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-gray-900 dark:border-gray-100"})});if(!f)return null;let b=m.get(f.feedId||"");return(0,r.jsx)(D,{article:f,feed:b,feedTitle:(null==b?void 0:b.title)||"Unknown Feed",onToggleStar:p,onNavigate:y,onBack:()=>{t.push("/")}})}O.displayName=T.Z0.displayName},7663:function(e,t,a){"use strict";a.d(t,{d:function(){return l}});var r=a(7437),s=a(6595),n=a(1637);function l(e){let{onToggleStar:t,isStarred:a,size:l="sm",disabled:i=!1}=e;return(0,r.jsx)(n.K,{icon:s.Z,onPress:t,size:l,active:a,activeClassName:"fill-yellow-500 text-yellow-500",label:a?"Unstar":"Star",disabled:i})}},5258:function(e,t,a){"use strict";a.d(t,{v:function(){return m}});var r=a(7437),s=a(2265),n=a(9076),l=a(2023),i=a(1817),o=a(5669),c=a(3448),d=a(4784),u=a(1637);function m(e){let{articleId:t,hasSummary:a,variant:m="full",size:f="sm",className:x,onSuccess:h}=e,[g,p]=(0,s.useState)(!1),[y,b]=(0,s.useState)(null),{generateSummary:v}=(0,o.useArticleStore)(),j=async()=>{p(!0),b(null);try{await v(t,a),null==h||h()}catch(e){b(e instanceof Error?e.message:"Failed to generate summary"),console.error("Summary generation error:",e)}finally{p(!1)}};return"icon"===m?(0,r.jsx)(u.K,{icon:a?n.Z:l.Z,onPress:j,size:f,active:!1,label:a?"Regenerate summary":"Generate AI summary",disabled:g,loading:g,loadingIcon:i.Z,className:x}):(0,r.jsx)(d.M,{onPress:j,disabled:g,variant:"default",size:"sm",className:(0,c.cn)("bg-blue-600 hover:bg-blue-700 active:bg-blue-800",x),children:g?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.Z,{className:"h-4 w-4 animate-spin"}),"Generating..."]}):a?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.Z,{className:"h-4 w-4"}),"Re-summarize"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.Z,{className:"h-4 w-4"}),"Summarize"]})})}},1637:function(e,t,a){"use strict";a.d(t,{K:function(){return i}});var r=a(7437);a(2265);var s=a(4784),n=a(3448);let l={sm:"h-4 w-4",md:"h-5 w-5",lg:"h-6 w-6"};function i(e){let{icon:t,onPress:a,size:i="sm",active:o=!1,activeClassName:c,label:d,title:u,disabled:m=!1,loading:f=!1,loadingIcon:x,className:h}=e,g=l[i],p=f&&x?x:t;return(0,r.jsx)(s.M,{variant:"ghost",size:"icon",onPress:a,disabled:m||f,className:(0,n.cn)("p-1 hover:bg-muted rounded",h),"aria-label":d,title:u||d,children:(0,r.jsx)(p,{className:(0,n.cn)(g,f&&"animate-spin",o&&c?c:o?"text-primary":"text-muted-foreground")})})}},4784:function(e,t,a){"use strict";a.d(t,{M:function(){return l}});var r=a(7437),s=a(2265),n=a(2381);let l=s.forwardRef((e,t)=>{let{onPress:a,onClick:l,children:i,...o}=e,c=(0,s.useRef)(!1);return(0,r.jsx)(n.z,{ref:t,...o,onClick:e=>{if(e.stopPropagation(),c.current){e.preventDefault(),c.current=!1;return}l?l(e):a&&a()},onTouchStart:()=>{c.current=!0},onTouchEnd:e=>{e.preventDefault(),e.stopPropagation(),a?a():l&&l(e),c.current=!1},style:{...o.style,WebkitTouchCallout:"none",WebkitUserSelect:"none",touchAction:"manipulation"},children:i})});l.displayName="IOSButton"}},function(e){e.O(0,[569,580,850,541,458,848,87,978,971,117,744],function(){return e(e.s=3687)}),_N_E=e.O()}]);