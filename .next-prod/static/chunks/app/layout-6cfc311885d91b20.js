(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{9152:function(e,t,s){Promise.resolve().then(s.t.bind(s,9974,23)),Promise.resolve().then(s.bind(s,4438)),Promise.resolve().then(s.t.bind(s,2778,23)),Promise.resolve().then(s.bind(s,7314)),Promise.resolve().then(s.bind(s,2664)),Promise.resolve().then(s.bind(s,3519)),Promise.resolve().then(s.bind(s,2513))},7314:function(e,t,s){"use strict";s.d(t,{RecoveryProvider:function(){return U}});var a=s(7437),r=s(2265),n=s(5966),o=s(6580);class i{async discoverLegacyDatabases(){this.updateProgress("discovery","Scanning for legacy databases...",0);let e=[];try{for(let t of(await indexedDB.databases()))if(t.name&&this.isRssReaderDatabase(t.name))try{let s=await this.inspectLegacyDatabase(t.name);s&&e.push(s)}catch(e){console.warn("Failed to inspect database ".concat(t.name,":"),e)}return this.updateProgress("discovery","Found ".concat(e.length," legacy databases"),100),e}catch(e){return console.error("Failed to discover legacy databases:",e),this.updateProgress("discovery","Failed to discover databases",0,[e instanceof Error?e.message:"Unknown error"]),[]}}isRssReaderDatabase(e){return["ShayonNewsDB","RSSReader","NewsReader","FeedReader","InoreaderDB","rss-news-reader"].some(t=>e.toLowerCase().includes(t.toLowerCase()))}async inspectLegacyDatabase(e){try{let t=new n.ZP(e);await t.open();let s=t.tables.map(e=>e.name),a={};for(let e of t.tables)try{a[e.name]=await e.count()}catch(t){console.warn("Failed to count records in ".concat(e.name,":"),t),a[e.name]=0}let r=this.estimateDatabaseSize(a);return t.close(),{name:e,version:t.verno,estimatedSize:r,lastModified:new Date,tables:s,recordCounts:a}}catch(t){return console.error("Failed to inspect database ".concat(e,":"),t),null}}estimateDatabaseSize(e){let t={articles:2e3,feeds:500,folders:200,users:1e3,summaries:5e3,pendingActions:100,apiUsage:50,userPreferences:1e3},s=0;for(let[a,r]of Object.entries(e))s+=r*(t[a]||500);return s}async extractFromLegacyDatabase(e){this.updateProgress("extraction","Extracting data from ".concat(e,"..."),0);let t={users:[],feeds:[],articles:[],folders:[]};try{let s=new n.ZP(e);await s.open();let a=s.tables.map(e=>e.name),r=0;for(let e of a)try{let n=s.table(e),o=await n.toArray();switch(e){case"articles":t.articles=o.map(this.mapToLegacyArticle);break;case"feeds":t.feeds=o.map(this.mapToLegacyFeed);break;case"folders":t.folders=o.map(this.mapToLegacyFolder)}r++,this.updateProgress("extraction","Extracted ".concat(e),r/a.length*100)}catch(t){console.warn("Failed to extract from table ".concat(e,":"),t),this.updateProgress("extraction","Failed to extract ".concat(e),0,[t instanceof Error?t.message:"Unknown error"])}return 0===t.users.length&&t.users.push({id:"legacy-user",email:"legacy@migration.local",inoreader_id:void 0,preferences:{},created_at:new Date().toISOString(),updated_at:new Date().toISOString()}),s.close(),this.updateProgress("extraction","Extracted ".concat(t.articles.length," articles, ").concat(t.feeds.length," feeds"),100),t}catch(t){throw console.error("Failed to extract from database ".concat(e,":"),t),this.updateProgress("extraction","Extraction failed",0,[t instanceof Error?t.message:"Unknown error"]),t}}mapToLegacyArticle(e){var t,s,a,r;return{id:e.id||"legacy-article-".concat(Date.now(),"-").concat(Math.random()),feed_id:e.feedId||e.feed_id||"unknown-feed",inoreader_id:e.inoreaderItemId||e.inoreader_id||e.id,title:e.title||"Untitled Article",content:e.content||e.summary||"",url:e.url||e.link||"",published_at:e.publishedAt||e.published_at||new Date().toISOString(),is_read:null!==(s=null!==(t=e.isRead)&&void 0!==t?t:e.is_read)&&void 0!==s&&s,is_starred:null!==(r=null!==(a=e.isStarred)&&void 0!==a?a:e.is_starred)&&void 0!==r&&r,author:e.author||"",summary:e.summary||"",created_at:e.createdAt||e.created_at||new Date().toISOString(),updated_at:e.updatedAt||e.updated_at||new Date().toISOString()}}mapToLegacyFeed(e){return{id:e.id||"legacy-feed-".concat(Date.now(),"-").concat(Math.random()),user_id:e.userId||e.user_id||"legacy-user",inoreader_id:e.inoreaderFeedId||e.inoreader_id||e.id,title:e.title||"Untitled Feed",url:e.url||e.feedUrl||"",folder_id:e.folderId||e.folder_id||null,unread_count:e.unreadCount||e.unread_count||0,icon_url:e.iconUrl||e.icon_url||"",created_at:e.createdAt||e.created_at||new Date().toISOString(),updated_at:e.updatedAt||e.updated_at||new Date().toISOString()}}mapToLegacyFolder(e){return{id:e.id||"legacy-folder-".concat(Date.now(),"-").concat(Math.random()),user_id:e.userId||e.user_id||"legacy-user",inoreader_id:e.inoreaderFolderId||e.inoreader_id||e.id,name:e.title||e.name||"Untitled Folder",parent_id:e.parentId||e.parent_id||null,created_at:e.createdAt||e.created_at||new Date().toISOString()}}async uploadToSupabase(e){this.updateProgress("upload","Uploading data to Supabase...",0);let t=e.users.length+e.feeds.length+e.articles.length+e.folders.length,s=0;try{e.users.length>0&&(await this.batchUpload("users",e.users,50),s+=e.users.length,this.updateProgress("upload","Uploaded users",s/t*100)),e.folders.length>0&&(await this.batchUpload("folders",e.folders,50),s+=e.folders.length,this.updateProgress("upload","Uploaded folders",s/t*100)),e.feeds.length>0&&(await this.batchUpload("feeds",e.feeds,50),s+=e.feeds.length,this.updateProgress("upload","Uploaded feeds",s/t*100)),e.articles.length>0&&(await this.batchUpload("articles",e.articles,25),s+=e.articles.length,this.updateProgress("upload","Uploaded articles",s/t*100)),this.updateProgress("upload","Upload completed successfully",100)}catch(e){throw console.error("Failed to upload to Supabase:",e),this.updateProgress("upload","Upload failed",0,[e instanceof Error?e.message:"Unknown error"]),e}}async batchUpload(e,t,s){for(let a=0;a<t.length;a+=s){let r=t.slice(a,a+s);try{let{error:t}=await this.supabase.from(e).upsert(r,{onConflict:"inoreader_id"});if(t)throw console.error("Failed to upload batch to ".concat(e,":"),t),Error("Failed to upload batch to ".concat(e,": ").concat(t.message));await new Promise(e=>setTimeout(e,100))}catch(t){throw console.error("Batch upload failed for ".concat(e,":"),t),t}}}async verifyMigration(e){this.updateProgress("verification","Verifying migration...",0);try{let[t,s,a,r]=await Promise.all([this.supabase.from("users").select("*",{count:"exact",head:!0}),this.supabase.from("feeds").select("*",{count:"exact",head:!0}),this.supabase.from("articles").select("*",{count:"exact",head:!0}),this.supabase.from("folders").select("*",{count:"exact",head:!0})]),n={users:(t.count||0)>=e.users.length,feeds:(s.count||0)>=e.feeds.length,articles:(a.count||0)>=e.articles.length,folders:(r.count||0)>=e.folders.length},o=Object.values(n).every(e=>e);return this.updateProgress("verification",o?"Migration verified successfully":"Migration verification failed",100,o?[]:["Record counts do not match expected values"]),o}catch(e){return console.error("Failed to verify migration:",e),this.updateProgress("verification","Verification failed",0,[e instanceof Error?e.message:"Unknown error"]),!1}}async cleanupLegacyDatabases(e){this.updateProgress("cleanup","Cleaning up legacy databases...",0);let t=0;for(let s of e)try{await new Promise((e,t)=>{let a=indexedDB.deleteDatabase(s);a.onsuccess=()=>e(),a.onerror=()=>t(a.error),a.onblocked=()=>{console.warn("Database ".concat(s," is blocked from deletion")),e()}}),t++,this.updateProgress("cleanup","Cleaned up ".concat(s),t/e.length*100)}catch(e){console.warn("Failed to cleanup database ".concat(s,":"),e),this.updateProgress("cleanup","Failed to cleanup ".concat(s),0,[e instanceof Error?e.message:"Unknown error"])}this.updateProgress("cleanup","Cleanup completed (".concat(t,"/").concat(e.length," databases)"),100)}async performMigration(e){let t=Date.now(),s={success:!1,migratedData:{users:0,feeds:0,articles:0,folders:0},errors:[],duration:0};try{let t={users:[],feeds:[],articles:[],folders:[]};for(let a of e)try{let e=await this.extractFromLegacyDatabase(a.name);t.users.push(...e.users),t.feeds.push(...e.feeds),t.articles.push(...e.articles),t.folders.push(...e.folders)}catch(e){s.errors.push("Failed to extract from ".concat(a.name,": ").concat(e instanceof Error?e.message:"Unknown error"))}t.users=this.removeDuplicates(t.users,"id"),t.feeds=this.removeDuplicates(t.feeds,"inoreader_id"),t.articles=this.removeDuplicates(t.articles,"inoreader_id"),t.folders=this.removeDuplicates(t.folders,"inoreader_id"),await this.uploadToSupabase(t),await this.verifyMigration(t)?(s.success=!0,s.migratedData={users:t.users.length,feeds:t.feeds.length,articles:t.articles.length,folders:t.folders.length}):s.errors.push("Migration verification failed")}catch(e){s.errors.push("Migration failed: ".concat(e instanceof Error?e.message:"Unknown error"))}return s.duration=Date.now()-t,s}removeDuplicates(e,t){let s=new Set;return e.filter(e=>{let a=e[t];return!s.has(a)&&(s.add(a),!0)})}updateProgress(e,t,s){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];this.progressCallback&&this.progressCallback({phase:e,currentStep:t,progress:s,totalRecords:0,processedRecords:0,errors:a})}constructor(e,t,s){this.supabase=(0,o.eI)(e,t),this.progressCallback=s}}function c(e){return new i("https://rgfxyraamghqnechkppg.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJnZnh5cmFhbWdocW5lY2hrcHBnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI2ODg5NzAsImV4cCI6MjA2ODI2NDk3MH0.hqoXq2YAs6cc96d0baVjZWVdmDW0qytCIHjA-YffSdk",e)}var d=s(2381),l=s(9027),u=s(2489),m=s(3448);let h=l.fC;l.xz;let f=l.h_;l.x8;let p=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.aV,{ref:t,className:(0,m.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r})});p.displayName=l.aV.displayName;let g=r.forwardRef((e,t)=>{let{className:s,children:r,...n}=e;return(0,a.jsxs)(f,{children:[(0,a.jsx)(p,{}),(0,a.jsxs)(l.VY,{ref:t,className:(0,m.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...n,children:[r,(0,a.jsxs)(l.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(u.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});g.displayName=l.VY.displayName;let x=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,m.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...s})};x.displayName="DialogHeader";let v=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.Dx,{ref:t,className:(0,m.cn)("text-lg font-semibold leading-none tracking-tight",s),...r})});v.displayName=l.Dx.displayName;let y=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.dk,{ref:t,className:(0,m.cn)("text-sm text-muted-foreground",s),...r})});y.displayName=l.dk.displayName;var b=s(610);let w=r.forwardRef((e,t)=>{let{className:s,value:r,...n}=e;return(0,a.jsx)(b.fC,{ref:t,className:(0,m.cn)("relative h-2 w-full overflow-hidden rounded-full bg-secondary",s),...n,children:(0,a.jsx)(b.z$,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(r||0),"%)")}})})});w.displayName=b.fC.displayName;let j=(0,s(535).j)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function N(e){let{className:t,variant:s,...r}=e;return(0,a.jsx)("div",{className:(0,m.cn)(j({variant:s}),t),...r})}var S=s(3247),D=s(2735),k=s(7689),_=s(8906),I=s(8930),C=s(91),P=s(4428),F=s(1723),E=s(1671),L=s(9322);function M(e){let{open:t,onClose:s,onSuccess:n}=e,[o,i]=(0,r.useState)("discovery"),[l,u]=(0,r.useState)([]),[m,f]=(0,r.useState)(new Set),[p,b]=(0,r.useState)(null),[j,M]=(0,r.useState)(null),[U,A]=(0,r.useState)(null),[R,z]=(0,r.useState)(!1);(0,r.useEffect)(()=>{t&&"discovery"===o&&O()},[t,o]);let O=async()=>{z(!0),A(null);try{let e=c(e=>{b(e)}),t=await e.discoverLegacyDatabases();u(t),t.length>0?(f(new Set(t.map(e=>e.name))),i("confirm")):(i("complete"),M({success:!0,migratedData:{users:0,feeds:0,articles:0,folders:0},errors:[],duration:0}))}catch(e){A(e instanceof Error?e.message:"Failed to discover databases")}finally{z(!1)}},Z=e=>{let t=new Set(m);t.has(e)?t.delete(e):t.add(e),f(t)},T=async()=>{if(0!==m.size){z(!0),A(null),i("migrate");try{let e=c(e=>{b(e)}),t=l.filter(e=>m.has(e.name)),s=await e.performMigration(t);M(s),s.success&&n(s),i("complete")}catch(e){A(e instanceof Error?e.message:"Migration failed")}finally{z(!1)}}},W=e=>{if(0===e)return"0 B";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB"][t]},B=e=>{switch(e){case"discovery":return(0,a.jsx)(S.Z,{className:"w-4 h-4"});case"extraction":return(0,a.jsx)(D.Z,{className:"w-4 h-4"});case"upload":return(0,a.jsx)(k.Z,{className:"w-4 h-4"});case"verification":return(0,a.jsx)(_.Z,{className:"w-4 h-4"});case"cleanup":return(0,a.jsx)(I.Z,{className:"w-4 h-4"});default:return(0,a.jsx)(C.Z,{className:"w-4 h-4"})}};return(0,a.jsx)(h,{open:t,onOpenChange:s,children:(0,a.jsxs)(g,{className:"max-w-2xl",children:[(0,a.jsxs)(x,{children:[(0,a.jsxs)(v,{className:"flex items-center gap-2",children:[(0,a.jsx)(C.Z,{className:"w-5 h-5"}),"Data Recovery"]}),(0,a.jsx)(y,{children:"Recover your articles and feeds from previous sessions"})]}),"discovery"===o&&(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(S.Z,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground animate-pulse"}),(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Scanning for Legacy Data"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Looking for existing RSS reader data in your browser..."}),p&&(0,a.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[B(p.phase),(0,a.jsx)("span",{className:"text-sm",children:p.currentStep})]}),(0,a.jsx)(w,{value:p.progress,className:"w-full"})]})]})}),"confirm"===o&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Found Legacy Data"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Select which databases to recover data from:"})]}),(0,a.jsx)("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:l.map(e=>(0,a.jsx)("div",{className:"p-4 border rounded-lg cursor-pointer transition-colors ".concat(m.has(e.name)?"border-primary bg-primary/5":"border-border hover:border-primary/50"),onClick:()=>Z(e.name),children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)(C.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"font-medium",children:e.name}),(0,a.jsxs)(N,{variant:"secondary",className:"text-xs",children:["v",e.version]})]}),(0,a.jsxs)("div",{className:"text-sm text-muted-foreground space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(P.Z,{className:"w-3 h-3"}),(0,a.jsx)("span",{children:W(e.estimatedSize)})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(F.Z,{className:"w-3 h-3"}),(0,a.jsx)("span",{children:e.lastModified.toLocaleDateString()})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4 text-xs",children:[e.recordCounts.articles&&(0,a.jsxs)("span",{children:[e.recordCounts.articles," articles"]}),e.recordCounts.feeds&&(0,a.jsxs)("span",{children:[e.recordCounts.feeds," feeds"]}),e.recordCounts.folders&&(0,a.jsxs)("span",{children:[e.recordCounts.folders," folders"]})]})]})]}),(0,a.jsx)("div",{className:"ml-4",children:(0,a.jsx)("div",{className:"w-4 h-4 rounded border-2 flex items-center justify-center ".concat(m.has(e.name)?"bg-primary border-primary":"border-border"),children:m.has(e.name)&&(0,a.jsx)(E.Z,{className:"w-3 h-3 text-primary-foreground"})})})]})},e.name))}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)(d.z,{variant:"outline",onClick:s,children:"Cancel"}),(0,a.jsxs)(d.z,{onClick:T,disabled:0===m.size,children:["Recover Data (",m.size," database",1!==m.size?"s":"",")"]})]})]}),"migrate"===o&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"text-center py-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 mx-auto mb-4 border-2 border-primary rounded-full flex items-center justify-center",children:p&&B(p.phase)}),(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Migrating Data"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"This may take a few minutes..."})]}),p&&(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium capitalize",children:p.phase}),(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:[Math.round(p.progress),"%"]})]}),(0,a.jsx)(w,{value:p.progress,className:"w-full"}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground text-center",children:p.currentStep}),p.errors.length>0&&(0,a.jsx)("div",{className:"space-y-1",children:p.errors.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-destructive",children:[(0,a.jsx)(L.Z,{className:"w-3 h-3"}),e]},t))})]})]}),"complete"===o&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"text-center py-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 mx-auto mb-4 rounded-full flex items-center justify-center ".concat((null==j?void 0:j.success)?"bg-green-100 text-green-600":"bg-red-100 text-red-600"),children:(null==j?void 0:j.success)?(0,a.jsx)(E.Z,{className:"w-6 h-6"}):(0,a.jsx)(L.Z,{className:"w-6 h-6"})}),(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:(null==j?void 0:j.success)?"Migration Complete!":"Migration Failed"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:(null==j?void 0:j.success)?"Your data has been successfully recovered and migrated.":"There was an error during the migration process."})]}),j&&(0,a.jsxs)("div",{className:"space-y-3",children:[j.success&&(0,a.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[(0,a.jsx)("h4",{className:"font-semibold text-green-800 mb-2",children:"Migration Summary"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-green-600",children:"Users:"})," ",j.migratedData.users]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-green-600",children:"Feeds:"})," ",j.migratedData.feeds]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-green-600",children:"Articles:"})," ",j.migratedData.articles]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-green-600",children:"Folders:"})," ",j.migratedData.folders]})]}),(0,a.jsxs)("div",{className:"mt-2 text-sm text-green-600",children:["Completed in ",(e=>{let t=Math.floor(e/1e3),s=Math.floor(t/60),a=Math.floor(s/60);return a>0?"".concat(a,"h ").concat(s%60,"m ").concat(t%60,"s"):s>0?"".concat(s,"m ").concat(t%60,"s"):"".concat(t,"s")})(j.duration)]})]}),j.errors.length>0&&(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,a.jsx)("h4",{className:"font-semibold text-red-800 mb-2",children:"Errors"}),(0,a.jsx)("div",{className:"space-y-1",children:j.errors.map((e,t)=>(0,a.jsxs)("div",{className:"text-sm text-red-600",children:["• ",e]},t))})]})]}),U&&(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-red-800",children:[(0,a.jsx)(L.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"font-semibold",children:"Error"})]}),(0,a.jsx)("p",{className:"text-red-600 text-sm mt-1",children:U})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[!(null==j?void 0:j.success)&&(0,a.jsx)(d.z,{variant:"outline",onClick:()=>i("discovery"),children:"Try Again"}),(0,a.jsx)(d.z,{onClick:s,className:"ml-auto",children:(null==j?void 0:j.success)?"Continue":"Close"})]})]})]})})}function U(e){let{children:t}=e,{shouldShowRecovery:s,isChecking:n,handleRecoverySuccess:o,handleRecoveryClose:i}=function(){let[e,t]=(0,r.useState)(!1),[s,a]=(0,r.useState)(!0),[n,o]=(0,r.useState)([]);(0,r.useEffect)(()=>{i()},[]);let i=async()=>{try{if(localStorage.getItem("legacy-recovery-seen")){a(!1);return}let e=c(),s=await e.discoverLegacyDatabases();o(s);let r=s.some(e=>(e.recordCounts.articles||0)>0||(e.recordCounts.feeds||0)>0);t(r)}catch(e){console.error("Failed to check for legacy data:",e)}finally{a(!1)}},d=()=>{localStorage.setItem("legacy-recovery-seen","true"),t(!1)};return{shouldShowRecovery:e,isChecking:s,legacyDatabases:n,handleRecoverySuccess:e=>{d(),console.log("Recovery completed successfully:",e)},handleRecoveryClose:()=>{d()},checkForLegacyData:i}}();return(0,a.jsxs)(a.Fragment,{children:[t,!n&&(0,a.jsx)(M,{open:s,onClose:i,onSuccess:o})]})}},2664:function(e,t,s){"use strict";s.d(t,{PWADetector:function(){return r}});var a=s(2265);function r(){return(0,a.useEffect)(()=>{window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone||document.referrer.includes("android-app://")?document.documentElement.classList.add("pwa-standalone"):document.documentElement.classList.remove("pwa-standalone")},[]),null}},3519:function(e,t,s){"use strict";s.d(t,{PWAProvider:function(){return r}});var a=s(2265);function r(){return(0,a.useEffect)(()=>{"serviceWorker"in navigator&&window.addEventListener("load",async()=>{try{let e=await navigator.serviceWorker.register("/sw.js");return e.addEventListener("updatefound",()=>{let t=e.installing;t&&t.addEventListener("statechange",()=>{"installed"===t.state&&navigator.serviceWorker.controller&&confirm("A new version is available. Reload to update?")&&(t.postMessage({type:"SKIP_WAITING"}),window.location.reload())})}),navigator.serviceWorker.addEventListener("controllerchange",()=>{window.location.reload()}),console.log("Service Worker registered successfully"),e}catch(e){console.error("Service Worker registration failed:",e)}})},[]),null}},2513:function(e,t,s){"use strict";s.d(t,{ThemeProvider:function(){return n}});var a=s(2265),r=s(619);function n(){let e=(0,r.H)(e=>e.theme);return(0,a.useEffect)(()=>{let t=window.document.documentElement;if(t.classList.remove("light","dark"),"system"===e){let e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";t.classList.add(e)}else t.classList.add(e)},[e]),(0,a.useEffect)(()=>{let t=window.matchMedia("(prefers-color-scheme: dark)"),s=()=>{if("system"===e){let e=window.document.documentElement;e.classList.remove("light","dark"),e.classList.add(t.matches?"dark":"light")}};return t.addEventListener("change",s),()=>t.removeEventListener("change",s)},[e]),null}},2381:function(e,t,s){"use strict";s.d(t,{z:function(){return d}});var a=s(7437),r=s(2265),n=s(7053),o=s(535),i=s(3448);let c=(0,o.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),d=r.forwardRef((e,t)=>{let{className:s,variant:r,size:o,asChild:d=!1,...l}=e,u=d?n.g7:"button";return(0,a.jsx)(u,{className:(0,i.cn)(c({variant:r,size:o,className:s})),ref:t,type:l.type||"button",...l,style:{WebkitTapHighlightColor:"transparent",touchAction:"manipulation",...l.style}})});d.displayName="Button"},619:function(e,t,s){"use strict";s.d(t,{H:function(){return n}});var a=s(3011),r=s(6885);let n=(0,a.U)()((0,r.tJ)((e,t)=>({theme:"system",setTheme:t=>e({theme:t}),isSidebarOpen:!1,setSidebarOpen:t=>e({isSidebarOpen:t}),toggleSidebar:()=>e(e=>({isSidebarOpen:!e.isSidebarOpen})),isArticleOpen:!1,selectedArticleId:null,setSelectedArticle:t=>e({selectedArticleId:t,isArticleOpen:null!==t}),isLoading:!1,setLoading:t=>e({isLoading:t}),notification:null,showNotification:(t,s)=>e({notification:{message:t,type:s,visible:!0}}),hideNotification:()=>e({notification:null})}),{name:"ui-store",partialize:e=>({theme:e.theme})}))},3448:function(e,t,s){"use strict";s.d(t,{cn:function(){return n}});var a=s(1994),r=s(3335);function n(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.m6)((0,a.W)(t))}},2778:function(){}},function(e){e.O(0,[635,569,580,850,831,438,468,971,117,744],function(){return e(e.s=9152)}),_N_E=e.O()}]);