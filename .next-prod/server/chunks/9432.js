"use strict";exports.id=9432,exports.ids=[9432],exports.modules={3344:(e,t,r)=>{r.d(t,{OQ:()=>n});var a=r(1952);let i="https://rgfxyraamghqnechkppg.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJnZnh5cmFhbWdocW5lY2hrcHBnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI2ODg5NzAsImV4cCI6MjA2ODI2NDk3MH0.hqoXq2YAs6cc96d0baVjZWVdmDW0qytCIHjA-YffSdk";if(!i||!l)throw Error("Missing Supabase environment variables");console.log("[Supabase] Initializing client...");let o=performance.now(),n=(0,a.eI)(i,l,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},db:{schema:"public"}});console.log(`[Supabase] Client initialized in ${(performance.now()-o).toFixed(2)}ms`)},6551:(e,t,r)=>{r.r(t),r.d(t,{useArticleStore:()=>n});var a=r(8408),i=r(3344),l=r(8172);let o=()=>"unread",n=(0,a.U)((e,t)=>({articles:new Map,loadingArticles:!1,articlesError:null,summarizingArticles:new Set,selectedFeedId:null,selectedFolderId:null,selectedArticleId:null,readStatusFilter:o(),filter:"all",hasMore:!0,loadingMore:!1,loadArticles:async(r,a)=>{e({loadingArticles:!0,articlesError:null});try{let l=i.OQ.from("articles").select(`
          *,
          feed:feeds(*)
        `).order("published_at",{ascending:!1});if(r)l=l.eq("feed_id",r);else if(a){let{data:e}=await i.OQ.from("feeds").select("id").eq("folder_id",a),t=e?.map(e=>e.id)||[];t.length>0&&(l=l.in("feed_id",t))}let o=t().readStatusFilter;"unread"===o?l=l.eq("is_read",!1):"read"===o&&(l=l.eq("is_read",!0));let n=t().filter;"starred"===n&&(l=l.eq("is_starred",!0)),l=l.limit(50);let{data:s,error:d}=await l;if(d)throw d;let c=new Map;s?.forEach(e=>{c.set(e.id,{id:e.id,feedId:e.feed_id||"",title:e.title||"Untitled",content:e.content||"",url:e.url||"",tags:e.is_starred?["starred"]:[],publishedAt:new Date(e.published_at||Date.now()),authorName:e.author||"",isRead:e.is_read||!1,createdAt:new Date(e.created_at||Date.now()),updatedAt:new Date(e.updated_at||Date.now()),inoreaderItemId:e.inoreader_id,fullContentUrl:e.url,hasFullContent:e.has_full_content||!1,fullContent:e.full_content||void 0,summary:e.ai_summary||void 0,isPartial:!1,feedTitle:e.feed?.title||""})}),e({articles:c,loadingArticles:!1,hasMore:50===(s?.length||0),selectedFeedId:r||null,selectedFolderId:a||null})}catch(t){console.error("Failed to load articles:",t),e({loadingArticles:!1,articlesError:`Failed to load articles: ${t}`})}},loadMoreArticles:async()=>{let{loadingMore:r,hasMore:a,articles:l,selectedFeedId:o,selectedFolderId:n,readStatusFilter:s,filter:d}=t();if(!r&&a){e({loadingMore:!0});try{let t=Array.from(l.values()),r=t[t.length-1]?.publishedAt;if(!r){e({loadingMore:!1,hasMore:!1});return}let a=i.OQ.from("articles").select(`
          *,
          feed:feeds(*)
        `).order("published_at",{ascending:!1}).lt("published_at",r.toISOString());if(o)a=a.eq("feed_id",o);else if(n){let{data:e}=await i.OQ.from("feeds").select("id").eq("folder_id",n),t=e?.map(e=>e.id)||[];t.length>0&&(a=a.in("feed_id",t))}"unread"===s?a=a.eq("is_read",!1):"read"===s&&(a=a.eq("is_read",!0)),"starred"===d&&(a=a.eq("is_starred",!0)),a=a.limit(50);let{data:c,error:u}=await a;if(u)throw u;let m=new Map(l);c?.forEach(e=>{m.set(e.id,{id:e.id,feedId:e.feed_id||"",title:e.title||"Untitled",content:e.content||"",url:e.url||"",tags:e.is_starred?["starred"]:[],publishedAt:new Date(e.published_at||Date.now()),authorName:e.author||"",isRead:e.is_read||!1,createdAt:new Date(e.created_at||Date.now()),updatedAt:new Date(e.updated_at||Date.now()),inoreaderItemId:e.inoreader_id,fullContentUrl:e.url,hasFullContent:e.has_full_content||!1,fullContent:e.full_content||void 0,summary:e.ai_summary||void 0,isPartial:!1,feedTitle:e.feed?.title||""})}),e({articles:m,loadingMore:!1,hasMore:50===(c?.length||0)})}catch(t){console.error("Failed to load more articles:",t),e({loadingMore:!1})}}},getArticle:async r=>{try{let{data:a,error:l}=await i.OQ.from("articles").select("*").eq("id",r).single();if(l)throw l;if(a){let i={id:a.id,feedId:a.feed_id||"",title:a.title||"Untitled",content:a.content||"",url:a.url||"",tags:a.is_starred?["starred"]:[],publishedAt:new Date(a.published_at||Date.now()),authorName:a.author||"",isRead:a.is_read||!1,createdAt:new Date(a.created_at||Date.now()),updatedAt:new Date(a.updated_at||Date.now()),inoreaderItemId:a.inoreader_id,fullContentUrl:a.url,hasFullContent:a.has_full_content||!1,fullContent:a.full_content||void 0,summary:a.ai_summary||void 0,isPartial:!1,feedTitle:a.feed?.title||""},{articles:l}=t(),o=new Map(l);return o.set(r,i),e({articles:o}),i}return null}catch(e){return console.error("Failed to get article:",e),null}},markAsRead:async r=>{try{let{articles:a}=t(),o=a.get(r);if(!o||o.isRead)return;let n=new Date().toISOString(),{error:s}=await i.OQ.from("articles").update({is_read:!0,last_local_update:n,updated_at:n}).eq("id",r);if(s)throw s;if(o.inoreaderItemId){let{error:e}=await i.OQ.rpc("add_to_sync_queue",{p_article_id:r,p_inoreader_id:o.inoreaderItemId,p_action_type:"read"});e&&console.error("Failed to add to sync queue:",e)}let d=new Map(a);d.set(r,{...o,isRead:!0}),e({articles:d});let c=l.i.getState();navigator.onLine||c.addToQueue({type:"mark_read",articleId:r,maxRetries:3})}catch(e){console.error("Failed to mark as read:",e)}},markMultipleAsRead:async r=>{if(0!==r.length)try{let{articles:a}=t(),l=new Date().toISOString(),o=r.filter(e=>{let t=a.get(e);return t&&!t.isRead});if(0===o.length)return;let{error:n}=await i.OQ.from("articles").update({is_read:!0,last_local_update:l,updated_at:l}).in("id",o);if(n)throw n;let s=o.map(e=>{let t=a.get(e);return t?.inoreaderItemId?{article_id:e,inoreader_id:t.inoreaderItemId,action_type:"read"}:null}).filter(Boolean);if(s.length>0){for(let e of s)if(e){let{error:t}=await i.OQ.rpc("add_to_sync_queue",{p_article_id:e.article_id,p_inoreader_id:e.inoreader_id,p_action_type:e.action_type});t&&console.error("Failed to add to sync queue:",t)}}let d=new Map(a);o.forEach(e=>{let t=a.get(e);t&&d.set(e,{...t,isRead:!0})}),e({articles:d}),console.log(`Marked ${o.length} articles as read`)}catch(e){console.error("Failed to mark multiple as read:",e)}},markAsUnread:async r=>{try{let{articles:a}=t(),o=a.get(r);if(!o||!o.isRead)return;let n=new Date().toISOString(),{error:s}=await i.OQ.from("articles").update({is_read:!1,last_local_update:n,updated_at:n}).eq("id",r);if(s)throw s;if(o.inoreaderItemId){let{error:e}=await i.OQ.rpc("add_to_sync_queue",{p_article_id:r,p_inoreader_id:o.inoreaderItemId,p_action_type:"unread"});e&&console.error("Failed to add to sync queue:",e)}let d=new Map(a);d.set(r,{...o,isRead:!1}),e({articles:d});let c=l.i.getState();navigator.onLine||c.addToQueue({type:"mark_unread",articleId:r,maxRetries:3})}catch(e){console.error("Failed to mark as unread:",e)}},toggleStar:async r=>{try{let{articles:a}=t(),o=a.get(r);if(!o)return;let n=o.tags||[],s=n.includes("starred"),d=s?n.filter(e=>"starred"!==e):[...n,"starred"],c=new Date().toISOString(),{error:u}=await i.OQ.from("articles").update({is_starred:!s,last_local_update:c,updated_at:c}).eq("id",r);if(u)throw u;if(o.inoreaderItemId){let{error:e}=await i.OQ.rpc("add_to_sync_queue",{p_article_id:r,p_inoreader_id:o.inoreaderItemId,p_action_type:s?"unstar":"star"});e&&console.error("Failed to add to sync queue:",e)}let m=new Map(a);m.set(r,{...o,tags:d}),e({articles:m});let f=l.i.getState();navigator.onLine||f.addToQueue({type:s?"unstar":"star",articleId:r,maxRetries:3})}catch(e){console.error("Failed to toggle star:",e)}},generateSummary:async(r,a=!1)=>{let{summarizingArticles:i}=t(),l=new Set(i);l.add(r),e({summarizingArticles:l});try{let i=await fetch(`/reader/api/articles/${r}/summarize`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({regenerate:a})});if(!i.ok){let e=await i.json();throw Error(e.message||"Failed to generate summary")}let l=await i.json(),{articles:o}=t(),n=o.get(r);if(n){let t=new Map(o);t.set(r,{...n,summary:l.summary}),e({articles:t})}return{id:r,articleId:r,content:l.summary,wordCount:l.summary.split(" ").length,generatedAt:new Date,model:l.model||"claude-sonnet-4-20250514",isRegenerated:a}}catch(e){throw console.error("Failed to generate summary:",e),e}finally{let{summarizingArticles:a}=t(),i=new Set(a);i.delete(r),e({summarizingArticles:i})}},getSummary:async e=>{try{let{data:t,error:r}=await i.OQ.from("articles").select("ai_summary").eq("id",e).single();if(r)throw r;if(t?.ai_summary)return{id:e,articleId:e,content:t.ai_summary,wordCount:t.ai_summary.split(" ").length,generatedAt:new Date,model:"claude-sonnet-4-20250514",isRegenerated:!1};return null}catch(e){return console.error("Failed to get summary:",e),null}},markAllAsRead:async r=>{try{let{articles:a}=t(),l=new Date().toISOString(),o=[];if(Array.from(a.entries()).forEach(([e,t])=>{t.isRead||r&&t.feedId!==r||o.push(e)}),0===o.length){console.log("No unread articles to mark");return}let{error:n}=await i.OQ.from("articles").update({is_read:!0,last_local_update:l,updated_at:l}).in("id",o);if(n)throw n;for(let e of o){let t=a.get(e);if(t?.inoreaderItemId){let{error:r}=await i.OQ.rpc("add_to_sync_queue",{p_article_id:e,p_inoreader_id:t.inoreaderItemId,p_action_type:"read"});r&&console.error("Failed to add to sync queue:",r)}}let s=new Map(a);o.forEach(e=>{let t=s.get(e);t&&s.set(e,{...t,isRead:!0})}),e({articles:s}),console.log(`Marked ${o.length} articles as read in local database and queued for sync`)}catch(e){throw console.error("Failed to mark all as read:",e),e}},refreshArticles:async()=>{let{selectedFeedId:e,selectedFolderId:r}=t();await t().loadArticles(e||void 0,r||void 0)},setSelectedFeed:t=>e({selectedFeedId:t,selectedFolderId:null}),setSelectedFolder:t=>e({selectedFolderId:t,selectedFeedId:null}),setSelectedArticle:t=>e({selectedArticleId:t}),setFilter:r=>{e({filter:r}),t().refreshArticles()},setReadStatusFilter:r=>{e({readStatusFilter:r}),t().refreshArticles()},clearError:()=>e({articlesError:null}),getArticleCount:()=>{let{readStatusFilter:e}=t(),r=Array.from(t().articles.values()),a=r.length,i=r.filter(e=>!e.isRead).length;return"unread"===e?{total:i,unread:i}:"read"===e?{total:a-i,unread:0}:{total:a,unread:i}}}))},8172:(e,t,r)=>{r.d(t,{i:()=>l});var a=r(8408),i=r(5251);r(3344);let l=(0,a.U)()((0,i.tJ)((e,t)=>({lastSyncTime:null,isSyncing:!1,syncError:null,syncProgress:0,syncMessage:null,rateLimit:null,actionQueue:[],setLastSyncTime:t=>e({lastSyncTime:t}),setSyncing:t=>e({isSyncing:t}),setSyncError:t=>e({syncError:t}),setSyncProgress:t=>e({syncProgress:t}),setSyncMessage:t=>e({syncMessage:t}),setRateLimit:t=>e({rateLimit:t}),addToQueue:t=>{let r={...t,id:Math.random().toString(36).substr(2,9),timestamp:Date.now(),retryCount:0};e(e=>({actionQueue:[...e.actionQueue,r]}))},removeFromQueue:t=>{e(e=>({actionQueue:e.actionQueue.filter(e=>e.id!==t)}))},incrementRetryCount:t=>{e(e=>({actionQueue:e.actionQueue.map(e=>e.id===t?{...e,retryCount:e.retryCount+1}:e)}))},clearQueue:()=>e({actionQueue:[]}),processQueue:async()=>{let{actionQueue:e,removeFromQueue:r,incrementRetryCount:a}=t();if(0!==e.length&&navigator.onLine)for(let t of(console.log(`Processing ${e.length} queued actions`),e))try{r(t.id),console.log(`Successfully processed action: ${t.type} for article ${t.articleId}`)}catch(e){console.error(`Failed to process action ${t.id}:`,e),t.retryCount<t.maxRetries?a(t.id):(console.warn(`Max retries reached for action ${t.id}, removing from queue`),r(t.id))}},performFullSync:async()=>{let{setSyncing:e,setSyncError:a,setLastSyncTime:i,setSyncProgress:l,setSyncMessage:o,setRateLimit:n,processQueue:s}=t();e(!0),a(null),l(0),o("Starting sync...");try{await s(),console.log("Starting server sync...");let e=Date.now(),t=await fetch("/reader/api/sync",{method:"POST",headers:{"Content-Type":"application/json"}});if(!t.ok){let e=await t.json();if(429===t.status&&"rate_limit_exceeded"===e.error){let t=e.limit?` (${e.used}/${e.limit} calls used today)`:"";throw Error(`API rate limit exceeded${t}. Try again tomorrow.`)}throw Error(e.message||"Failed to start sync")}let{syncId:a,rateLimit:d}=await t.json();console.log("Sync started with ID:",a),d&&(n(d),console.log(`API usage: ${d.used}/${d.limit} calls today`),d.used>=.8*d.limit&&console.warn(`Warning: Approaching API rate limit (${d.remaining} calls remaining)`));let c=!1,u=0;for(;!c&&u<60;){await new Promise(e=>setTimeout(e,2e3));let e=await fetch(`/reader/api/sync/status/${a}`);if(e.ok){let t=await e.json();if(console.log(`Sync progress: ${t.progress}% - ${t.message||"Processing..."}`),l(t.progress||0),o(t.message||"Processing..."),"completed"===t.status)c=!0,console.log("Sync completed successfully");else if("failed"===t.status)throw Error(t.error||"Sync failed")}u++}if(!c)throw Error("Sync timeout - took too long to complete");let m=await r.e(2149).then(r.bind(r,2149)).then(e=>e.useFeedStore.getState()),f=await Promise.resolve().then(r.bind(r,6551)).then(e=>e.useArticleStore.getState());await Promise.all([m.loadFeedHierarchy(),f.refreshArticles()]);let g=Date.now();i(Date.now()),l(100),o("Sync completed!"),console.log(`Server sync completed in ${((g-e)/1e3).toFixed(1)}s`),setTimeout(()=>{l(0),o(null)},2e3)}catch(e){a(e instanceof Error?e.message:"Unknown sync error"),l(0),o(null),console.error("Sync failed:",e)}finally{e(!1)}}}),{name:"sync-store",partialize:e=>({lastSyncTime:e.lastSyncTime,actionQueue:e.actionQueue,rateLimit:e.rateLimit})}))}};