"use strict";(()=>{var e={};e.id=3313,e.ids=[3313],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4770:e=>{e.exports=require("crypto")},641:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>k,requestAsyncStorage:()=>p,routeModule:()=>d,serverHooks:()=>x,staticGenerationAsyncStorage:()=>h});var a={};r.r(a),r.d(a,{GET:()=>u});var o=r(9303),n=r(8716),s=r(670),i=r(7070),c=r(4483),l=r(2557);async function u(e){try{let t=e.nextUrl.searchParams,r=t.get("code"),a=t.get("state"),o=t.get("error"),n=e.headers.get("host")||"localhost:3000",s=e.headers.get("x-forwarded-proto")||"http",u=`${s}://${n}`;if(o){let e=t.get("error_description");return console.error("OAuth error:",o,e),i.NextResponse.redirect(new URL(`/?error=${encodeURIComponent(o)}`,u))}let d=e.cookies.get("oauth_state")?.value||null;if(!(0,c.YB)(a,d))return console.error("Invalid OAuth state"),i.NextResponse.redirect(new URL("/?error=invalid_state",u));if(!r)return i.NextResponse.redirect(new URL("/?error=missing_code",u));let p=await fetch(l.x.tokenUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"authorization_code",code:r,client_id:l.x.clientId,client_secret:l.x.clientSecret,redirect_uri:l.x.redirectUri})});if(!p.ok){let e=await p.text();return console.error("Token exchange failed:",e),i.NextResponse.redirect(new URL("/?error=token_exchange_failed",u))}let h=await p.json();Date.now(),h.expires_in;let x=i.NextResponse.redirect(new URL("/reader",u));x.cookies.set("access_token",h.access_token,{httpOnly:!0,secure:!0,sameSite:"lax",path:"/",maxAge:31536e3}),x.cookies.set("refresh_token",h.refresh_token,{httpOnly:!0,secure:!0,sameSite:"lax",path:"/",maxAge:2592e3});let w=Date.now()+31536e6;return x.cookies.set("token_expires_at",w.toString(),{httpOnly:!0,secure:!0,sameSite:"lax",path:"/",maxAge:31536e3}),x.cookies.delete("oauth_state"),x}catch(t){return console.error("OAuth callback error:",t),i.NextResponse.redirect(new URL("/?error=callback_failed",e.url))}}let d=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/auth/callback/inoreader/route",pathname:"/api/auth/callback/inoreader",filename:"route",bundlePath:"app/api/auth/callback/inoreader/route"},resolvedPagePath:"/Users/shayon/DevProjects/rss-news-reader/src/app/api/auth/callback/inoreader/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:p,staticGenerationAsyncStorage:h,serverHooks:x}=d,w="/api/auth/callback/inoreader/route";function k(){return(0,s.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:h})}},2557:(e,t,r)=>{r.d(t,{x:()=>a});let a={clientId:"1000002449",clientSecret:process.env.INOREADER_CLIENT_SECRET,redirectUri:"http://localhost:8080/auth/callback",scope:"read write",authUrl:"https://www.inoreader.com/oauth2/auth",tokenUrl:"https://www.inoreader.com/oauth2/token"}},4483:(e,t,r)=>{r.d(t,{Oh:()=>i,YB:()=>s,cp:()=>n});var a=r(4770),o=r.n(a);function n(){return o().randomBytes(32).toString("base64url")}function s(e,t){return!!e&&!!t&&e===t}function i(e){let t=new URLSearchParams({client_id:"1000002449",redirect_uri:"http://localhost:8080/auth/callback",response_type:"code",scope:"read write",state:e});return`https://www.inoreader.com/oauth2/auth?${t.toString()}`}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[9276,5972],()=>r(641));module.exports=a})();