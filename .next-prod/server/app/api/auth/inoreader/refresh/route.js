"use strict";(()=>{var e={};e.id=2540,e.ids=[2540],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7500:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>k,patchFetch:()=>f,requestAsyncStorage:()=>p,routeModule:()=>h,serverHooks:()=>d,staticGenerationAsyncStorage:()=>l});var o={};r.r(o),r.d(o,{POST:()=>u});var s=r(9303),a=r(8716),n=r(670),i=r(7070),c=r(2557);async function u(e){try{let t=e.cookies.get("refresh_token")?.value;if(!t)return i.NextResponse.json({error:"No refresh token found"},{status:401});let r=await fetch(c.x.tokenUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"refresh_token",refresh_token:t,client_id:c.x.clientId,client_secret:c.x.clientSecret})});if(!r.ok){let e=await r.text();console.error("Token refresh failed:",e);let t=i.NextResponse.json({error:"Token refresh failed"},{status:401});return t.cookies.delete("access_token"),t.cookies.delete("refresh_token"),t.cookies.delete("token_expires_at"),t}let o=await r.json(),s=Date.now()+31536e6,a=i.NextResponse.json({success:!0});return a.cookies.set("access_token",o.access_token,{httpOnly:!0,secure:!0,sameSite:"lax",path:"/",maxAge:31536e3}),o.refresh_token&&a.cookies.set("refresh_token",o.refresh_token,{httpOnly:!0,secure:!0,sameSite:"lax",path:"/",maxAge:2592e3}),a.cookies.set("token_expires_at",s.toString(),{httpOnly:!0,secure:!0,sameSite:"lax",path:"/",maxAge:31536e3}),a}catch(e){return console.error("Token refresh error:",e),i.NextResponse.json({error:"Failed to refresh token"},{status:500})}}let h=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/auth/inoreader/refresh/route",pathname:"/api/auth/inoreader/refresh",filename:"route",bundlePath:"app/api/auth/inoreader/refresh/route"},resolvedPagePath:"/Users/shayon/DevProjects/rss-news-reader/src/app/api/auth/inoreader/refresh/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:p,staticGenerationAsyncStorage:l,serverHooks:d}=h,k="/api/auth/inoreader/refresh/route";function f(){return(0,n.patchFetch)({serverHooks:d,staticGenerationAsyncStorage:l})}},2557:(e,t,r)=>{r.d(t,{x:()=>o});let o={clientId:"1000002449",clientSecret:process.env.INOREADER_CLIENT_SECRET,redirectUri:"http://localhost:8080/auth/callback",scope:"read write",authUrl:"https://www.inoreader.com/oauth2/auth",tokenUrl:"https://www.inoreader.com/oauth2/token"}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[9276,5972],()=>r(7500));module.exports=o})();