"use strict";(()=>{var e={};e.id=2291,e.ids=[2291],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},4293:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>f,patchFetch:()=>T,requestAsyncStorage:()=>g,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>p});var r={};s.r(r),s.d(r,{GET:()=>h});var a=s(9303),o=s(8716),i=s(670),n=s(7070);class l{constructor(){this.DAILY_LIMIT=100,this.STORAGE_KEY="inoreader_api_usage",this.usage=this.loadUsage(),this.checkReset()}loadUsage(){return{date:"",calls:0,resetTime:0}}saveUsage(){}getNextResetTime(){let e=new Date;return e.setUTCHours(24,0,0,0),e.getTime()}checkReset(){let e=new Date().toDateString();(this.usage.date!==e||Date.now()>=this.usage.resetTime)&&(this.usage={date:e,calls:0,resetTime:this.getNextResetTime()},this.saveUsage())}canMakeCall(){return this.checkReset(),this.usage.calls<this.DAILY_LIMIT}recordCall(){this.checkReset(),this.usage.calls++,this.saveUsage()}getUsageStats(){this.checkReset();let e=Math.max(0,this.DAILY_LIMIT-this.usage.calls),t=this.usage.calls/this.DAILY_LIMIT*100;return{used:this.usage.calls,remaining:e,total:this.DAILY_LIMIT,percentage:Math.round(t),resetTime:new Date(this.usage.resetTime),canMakeCall:this.canMakeCall(),isWarningLevel:t>=80,isCriticalLevel:t>=95}}getTimeUntilReset(){return this.checkReset(),Math.max(0,this.usage.resetTime-Date.now())}getFormattedTimeUntilReset(){let e=this.getTimeUntilReset(),t=Math.floor(e/36e5),s=Math.floor(e%36e5/6e4);return t>0?`${t}h ${s}m`:`${s}m`}reset(){this.usage={date:new Date().toDateString(),calls:0,resetTime:this.getNextResetTime()},this.saveUsage()}}let u=new l;var c=s(3867);async function h(e){let t=e.nextUrl.searchParams.get("trigger")||"unknown";if(!u.canMakeCall()){console.log("Rate limit exceeded for user-info request");let e=u.getUsageStats();return n.NextResponse.json({error:"Rate limit exceeded",retryAfter:u.getFormattedTimeUntilReset(),usage:e},{status:429})}try{let s=e.cookies.get("access_token")?.value;if(console.log("User-info request - has access token:",!!s),!s)return console.log("No access token found in cookies"),n.NextResponse.json({error:"Not authenticated"},{status:401});console.log("Making request to Inoreader user-info API..."),(0,c.W)("/reader/api/0/user-info",t,"GET");let r=await fetch("https://www.inoreader.com/reader/api/0/user-info",{headers:{Authorization:`Bearer ${s}`,AppId:"1000002449",AppKey:process.env.INOREADER_CLIENT_SECRET,"User-Agent":"Shayons-News/1.0"}});if(console.log("Inoreader response status:",r.status),!r.ok){let e=await r.text();if(console.error("Inoreader API error response:",e),401===r.status)return n.NextResponse.json({error:"Token expired"},{status:401});throw Error(`Inoreader API error: ${r.status} ${e}`)}let a=await r.json();return console.log("Successfully fetched user info:",a.userName),u.recordCall(),n.NextResponse.json(a)}catch(e){return console.error("User info API error:",e),n.NextResponse.json({error:"Failed to fetch user info"},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/inoreader/user-info/route",pathname:"/api/inoreader/user-info",filename:"route",bundlePath:"app/api/inoreader/user-info/route"},resolvedPagePath:"/Users/shayon/DevProjects/rss-news-reader/src/app/api/inoreader/user-info/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:g,staticGenerationAsyncStorage:p,serverHooks:m}=d,f="/api/inoreader/user-info/route";function T(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:p})}},3867:(e,t,s)=>{s.d(t,{W:()=>i});var r=s(2048),a=s(5315),o=s.n(a);function i(e,t,s="GET"){let a={timestamp:new Date().toISOString(),endpoint:e,trigger:t,method:s},i=o().join(process.cwd(),"logs","inoreader-api-calls.jsonl"),n=JSON.stringify(a)+"\n";r.promises.appendFile(i,n,"utf8").catch(e=>{console.error("Failed to log API call:",e)})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[9276,5972],()=>s(4293));module.exports=r})();