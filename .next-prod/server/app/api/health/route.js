(()=>{var e={};e.id=8829,e.ids=[8829],e.modules={399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4770:e=>{"use strict";e.exports=require("crypto")},7702:e=>{"use strict";e.exports=require("events")},629:e=>{"use strict";e.exports=require("fs/promises")},2615:e=>{"use strict";e.exports=require("http")},8791:e=>{"use strict";e.exports=require("https")},8216:e=>{"use strict";e.exports=require("net")},5315:e=>{"use strict";e.exports=require("path")},8621:e=>{"use strict";e.exports=require("punycode")},6162:e=>{"use strict";e.exports=require("stream")},2452:e=>{"use strict";e.exports=require("tls")},7360:e=>{"use strict";e.exports=require("url")},1568:e=>{"use strict";e.exports=require("zlib")},8359:()=>{},3739:()=>{},3901:(e,t,a)=>{"use strict";a.r(t),a.d(t,{originalPathname:()=>l,patchFetch:()=>p,requestAsyncStorage:()=>c,routeModule:()=>o,serverHooks:()=>h,staticGenerationAsyncStorage:()=>u});var s=a(9303),r=a(8716),n=a(670),i=a(9822);let o=new s.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/health/route",pathname:"/api/health",filename:"route",bundlePath:"app/api/health/route"},resolvedPagePath:"/Users/shayon/DevProjects/rss-news-reader/src/app/api/health/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:c,staticGenerationAsyncStorage:u,serverHooks:h}=o,l="/api/health/route";function p(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:u})}},9822:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GET:()=>i,dynamic:()=>n});var s=a(7070),r=a(2778);let n="force-dynamic";async function i(e){try{let t=new URL(e.url);if("true"===t.searchParams.get("ping"))return s.NextResponse.json({status:"ok",timestamp:new Date});let a=await r.e.checkHealth(),n=200;return"unhealthy"===a.status?n=503:"degraded"===a.status&&(n=200),s.NextResponse.json(a,{status:n})}catch(t){console.error("Health check endpoint error:",t);let{AppHealthCheck:e}=await Promise.resolve().then(a.bind(a,2778));return e.logError(`Health check endpoint error: ${t instanceof Error?t.message:"Unknown error"}`),s.NextResponse.json({status:"unhealthy",service:"rss-reader-app",uptime:0,lastActivity:new Date().toISOString(),errorCount:1,dependencies:{database:"unknown",oauth:"unknown"},performance:{avgSyncTime:0,avgDbQueryTime:0,avgApiCallTime:0},error:t instanceof Error?t.message:"Health check failed"},{status:503})}}},2778:(e,t,a)=>{"use strict";a.d(t,{AppHealthCheck:()=>l,e:()=>p});var s=a(843),r=a(629),n=a.n(r),i=a(5315),o=a.n(i);let c=Date.now(),u=[],h={dbQueries:[],apiCalls:[],syncOperations:[]};class l{constructor(){this.supabase=(0,s.eI)("https://rgfxyraamghqnechkppg.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY)}static getInstance(){return l.instance||(l.instance=new l),l.instance}async checkHealth(){let e=[],t=await this.checkDatabase();e.push(t);let a=await this.checkOAuthTokens();e.push(a);let s=this.calculateOverallStatus(e),r=Date.now()-36e5,n=u.filter(e=>e.timestamp>r).length,i=Math.floor((Date.now()-c)/1e3),o=this.calculateAverage(h.dbQueries),l=this.calculateAverage(h.apiCalls),p=this.calculateAverage(h.syncOperations);return await this.logHealthCheck({timestamp:new Date().toISOString(),service:"rss-reader-app",status:s,uptime:i,errorCount:n,performance:{avgDbQueryTime:o,avgApiCallTime:l,avgSyncTime:p}}),{status:s,service:"rss-reader-app",uptime:i,lastActivity:new Date().toISOString(),errorCount:n,dependencies:{database:t.status,oauth:a.status},performance:{avgDbQueryTime:o,avgApiCallTime:l,avgSyncTime:p},details:{services:e}}}async checkDatabase(){let e=[];try{let t=Date.now(),{data:a,error:s}=await this.supabase.from("system_config").select("key").limit(1).single(),r=Date.now()-t;this.trackPerformance("dbQueries",r),s?e.push({name:"connectivity",status:"unhealthy",message:"Database connection failed",duration:r,error:s.message}):(e.push({name:"connectivity",status:"healthy",message:"Database connection successful",duration:r}),r>1e3?e.push({name:"performance",status:"unhealthy",message:`Database response very slow: ${r}ms`,duration:r}):r>300?e.push({name:"performance",status:"degraded",message:`Database response slow: ${r}ms`,duration:r}):e.push({name:"performance",status:"healthy",message:`Database response time: ${r}ms`,duration:r}))}catch(t){e.push({name:"connectivity",status:"unhealthy",message:"Database check failed",error:t instanceof Error?t.message:"Unknown error"})}let t=this.calculateServiceStatus(e);return{name:"database",displayName:"Supabase Database",status:t,lastCheck:new Date,message:this.getServiceMessage("database",t),checks:e}}async checkOAuthTokens(){let e=[];try{let t=o().join(process.env.HOME||"/Users/shayon",".rss-reader","tokens.json");if(await n().access(t).then(()=>!0).catch(()=>!1)){let a=await n().readFile(t,"utf-8");if(JSON.parse(a).encrypted){let a=await n().stat(t),s=Date.now()-a.mtime.getTime(),r=Math.max(0,365-Math.floor(s/864e5));r<30?e.push({name:"token-validity",status:"degraded",message:`OAuth tokens may be expiring soon (approx ${r} days left)`}):e.push({name:"token-validity",status:"healthy",message:`OAuth tokens valid (approx ${r} days remaining)`})}else e.push({name:"token-file",status:"unhealthy",message:"OAuth tokens not properly encrypted"})}else e.push({name:"token-file",status:"unhealthy",message:"OAuth token file not found"})}catch(t){e.push({name:"oauth",status:"unhealthy",message:"OAuth check failed",error:t instanceof Error?t.message:"Unknown error"})}let t=this.calculateServiceStatus(e);return{name:"oauth",displayName:"OAuth Authentication",status:t,lastCheck:new Date,message:this.getServiceMessage("oauth",t),checks:e}}calculateOverallStatus(e){let t=e.map(e=>e.status);return t.includes("unhealthy")?"unhealthy":t.includes("degraded")?"degraded":"healthy"}calculateServiceStatus(e){let t=e.map(e=>e.status);return t.includes("unhealthy")?"unhealthy":t.includes("degraded")?"degraded":"healthy"}getServiceMessage(e,t){return({healthy:`${e} is operating normally`,degraded:`${e} is experiencing minor issues`,unhealthy:`${e} is experiencing major issues`,unknown:`${e} status cannot be determined`})[t]}trackPerformance(e,t){let a=h[e];a.push(t),a.length>100&&a.shift()}calculateAverage(e){return 0===e.length?0:Math.round(e.reduce((e,t)=>e+t,0)/e.length)}async logHealthCheck(e){try{let t=o().join(process.cwd(),"logs","health-checks.jsonl");await n().mkdir(o().dirname(t),{recursive:!0}),await n().appendFile(t,JSON.stringify(e)+"\n")}catch(e){console.error("Failed to log health check:",e)}}static logError(e){u.push({timestamp:Date.now(),error:e});let t=Date.now()-36e5;for(;u.length>0&&u[0].timestamp<t;)u.shift()}static trackMetric(e,t){l.getInstance().trackPerformance(e,t)}}let p=l.getInstance()}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[9276,5972,843],()=>a(3901));module.exports=s})();